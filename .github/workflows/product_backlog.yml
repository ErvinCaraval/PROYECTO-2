name: üöÄ Crear Backlog y Sprints del Proyecto

on:
  workflow_dispatch: # Permite ejecutar este workflow manualmente desde la pesta√±a Actions

# Define el token con permisos de escritura para crear issues y milestones
permissions:
  contents: read
  issues: write

jobs:
  setup-project-backlog:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Crear Milestones para los Sprints
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh milestone create "Sprint Backend (7-15 Octubre)" --description "Infraestructura completa. Todas las APIs y funcionalidades de backend deben estar listas." --due-date "2024-10-15"
          gh milestone create "Sprint Frontend (16-21 Octubre)" --description "Implementaci√≥n de UI/UX usando las APIs del backend ya terminadas." --due-date "2024-10-21"
      
      - name: 2. Crear Issues del Sprint Backend
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # US1: Registro de preferencia de accesibilidad (Backend)
          gh issue create \
            --title "[BE] US1: Registro de preferencia de accesibilidad" \
            --body "**Como** un nuevo jugador,
          **Quiero** poder indicar durante el registro si tengo dificultades visuales,
          **Para que** el juego pueda activar autom√°ticamente las funcionalidades de accesibilidad para m√≠.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El formulario de registro debe incluir un checkbox o toggle con la etiqueta \"Tengo dificultades visuales\".
          - ‚úÖ El backend debe poder almacenar esta preferencia en el documento del usuario en Firebase (ej. \`visualDifficulty: boolean\`).
          - ‚úÖ El valor por defecto para esta preferencia debe ser \`false\` si el usuario no lo marca." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Backend (7-15 Octubre)"

          # US5: Almacenamiento del historial de interacciones de voz (Backend)
          gh issue create \
            --title "[BE] US5: Almacenamiento del historial de interacciones de voz" \
            --body "**Como** usuario del modo de voz,
          **Quiero** que mis interacciones de voz se almacenen en un historial,
          **Para que** pueda revisar mi actividad y los administradores puedan analizar patrones de uso.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El backend debe registrar cada interacci√≥n de voz exitosa en una nueva colecci√≥n de Firebase (ej. \`voiceInteractions\`).
          - ‚úÖ Cada registro debe incluir el \`userId\`, \`questionId\`, la respuesta dada, el timestamp y la duraci√≥n.
          - ‚úÖ Se debe crear un endpoint API seguro (\`GET /api/voice-interactions/:userId\`) para que los usuarios puedan recuperar su propio historial.
          - ‚úÖ Los datos deben almacenarse de forma segura y cumplir con las pol√≠ticas de privacidad." \
            --label "Prioridad: Media" \
            --milestone "Sprint Backend (7-15 Octubre)"
            
          # US7: Configuraci√≥n administrativa de accesibilidad (Backend)
          gh issue create \
            --title "[BE] US7: Configuraci√≥n administrativa de accesibilidad" \
            --body "**Como** administrador de la plataforma,
          **Quiero** tener un panel para configurar los ajustes de accesibilidad y monitorear su uso,
          **Para que** pueda gestionar la funcionalidad y entender su adopci√≥n.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El panel de administraci√≥n debe tener una nueva secci√≥n para \"Ajustes de Accesibilidad\".
          - ‚úÖ Los administradores deben poder habilitar o deshabilitar globalmente el modo de voz.
          - ‚úÖ El backend debe proporcionar un endpoint que devuelva estad√≠sticas agregadas (ej. n√∫mero de usuarios con el modo activado, interacciones de voz por d√≠a)." \
            --label "Prioridad: Baja" \
            --milestone "Sprint Backend (7-15 Octubre)"

          # US8: Integraci√≥n del modo de voz con el juego (Backend)
          gh issue create \
            --title "[BE] US8: Compatibilidad WebSocket con modo de voz" \
            --body "**Como** desarrollador del backend,
          **Quiero** asegurar que el modo de voz se integre sin problemas con el sistema de juego multijugador,
          **Para que** la funcionalidad de accesibilidad no interrumpa ni degrade la experiencia de juego en tiempo real.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El servidor de WebSocket debe ser capaz de recibir y procesar eventos relacionados con el modo de voz (ej. \`voiceResponse\`).
          - ‚úÖ Las pruebas de estr√©s deben confirmar que el rendimiento del servidor WebSocket no se degrada m√°s de un 5% al manejar eventos de voz." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Backend (7-15 Octubre)"

          # US9: Procesamiento y validaci√≥n de respuestas por voz (Backend)
          gh issue create \
            --title "[BE] US9: Procesamiento y validaci√≥n de respuestas por voz" \
            --body "**Como** usuario del modo de voz,
          **Quiero** que el sistema procese y valide mis respuestas habladas,
          **Para que** pueda participar en el juego usando solo mi voz.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ Se debe crear un nuevo endpoint en el backend (\`POST /api/voice-responses/validate\`) que reciba la transcripci√≥n de la respuesta de voz.
          - ‚úÖ El backend debe implementar una l√≥gica para validar la respuesta (ej. \"A\", \"B\", \"Primera opci√≥n\") contra la respuesta correcta de la pregunta actual.
          - ‚úÖ La interacci√≥n debe registrarse en el historial de interacciones de voz (\`voiceInteractions\`)." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Backend (7-15 Octubre)"

      - name: 3. Crear Issues del Sprint Frontend
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # US2: Activaci√≥n autom√°tica del modo de voz
          gh issue create \
            --title "[FE] US2: Activaci√≥n autom√°tica del modo de voz" \
            --body "**Como** un usuario con dificultades visuales,
          **Quiero** que el modo de voz se active autom√°ticamente cuando inicio sesi√≥n,
          **Para que** no tenga que buscar y activar la opci√≥n manualmente.
          
          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ Al iniciar sesi√≥n, el frontend debe verificar la preferencia \`visualDifficulty\` del usuario.
          - ‚úÖ Si es \`true\`, el modo de voz debe activarse autom√°ticamente en toda la aplicaci√≥n.
          - ‚úÖ El estado del modo de voz debe persistir mientras el usuario navega por el sitio.
          - ‚úÖ El usuario debe poder deshabilitar manualmente el modo de voz si lo desea." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Frontend (16-21 Octubre)"

          # US3: Lectura de preguntas mediante Text-to-Speech
          gh issue create \
            --title "[FE] US3: Lectura de preguntas mediante Text-to-Speech (TTS)" \
            --body "**Como** usuario del modo de voz,
          **Quiero** que el sistema lea en voz alta las preguntas y las opciones de respuesta,
          **Para que** pueda entender el contenido del juego sin necesidad de verlo.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ Cuando se muestra una nueva pregunta, el texto de la pregunta y cada una de las opciones deben ser le√≠dos autom√°ticamente usando la Web Speech API.
          - ‚úÖ El usuario debe poder pausar y reanudar la lectura de audio.
          - ‚úÖ La lectura debe ser clara y a una velocidad comprensible." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Frontend (16-21 Octubre)"

          # US4: Configuraci√≥n de ajustes de voz
          gh issue create \
            --title "[FE] US4: Configuraci√≥n de ajustes de voz" \
            --body "**Como** usuario del modo de voz,
          **Quiero** poder configurar los ajustes de la voz (tipo, velocidad y volumen),
          **Para que** pueda personalizar la experiencia de audio a mi gusto.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ Debe haber un panel de ajustes de accesibilidad accesible para el usuario.
          - ‚úÖ El usuario debe poder elegir entre las voces disponibles en su navegador.
          - ‚úÖ El usuario debe poder ajustar la velocidad de la voz (ej. de 0.5x a 2x).
          - ‚úÖ Los ajustes seleccionados deben guardarse en el \`localStorage\` del navegador para persistir entre sesiones." \
            --label "Prioridad: Media" \
            --milestone "Sprint Frontend (16-21 Octubre)"

          # US6: Sistema de tutorial de audio
          gh issue create \
            --title "[FE] US6: Sistema de tutorial de audio" \
            --body "**Como** un nuevo usuario con dificultades visuales,
          **Quiero** recibir un tutorial de audio que me gu√≠e a trav√©s de las funcionalidades clave del juego,
          **Para que** pueda aprender a jugar sin asistencia visual.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El tutorial de audio debe ofrecerse autom√°ticamente a los usuarios que se registran con la opci√≥n de dificultad visual activada.
          - ‚úÖ El tutorial debe cubrir c√≥mo navegar, c√≥mo se leen las preguntas y c√≥mo responder por voz.
          - ‚úÖ El usuario debe poder omitir el tutorial o volver a escucharlo m√°s tarde desde el panel de ajustes." \
            --label "Prioridad: Media" \
            --milestone "Sprint Frontend (16-21 Octubre)"
          
          # US9: Reconocimiento de respuestas por voz (Frontend)
          gh issue create \
            --title "[FE] US9: Reconocimiento de respuestas por voz" \
            --body "**Como** usuario del modo de voz,
          **Quiero** poder responder a las preguntas usando comandos de voz,
          **Para que** pueda participar plenamente en el juego sin usar el mouse o el teclado.

          ---
          ### **Criterios de Aceptaci√≥n:**
          - ‚úÖ El sistema debe usar la Web Speech API para escuchar y transcribir los comandos de voz del usuario.
          - ‚úÖ El sistema debe ser capaz de reconocer respuestas clave como \"A\", \"B\", \"C\", \"D\", \"Primera opci√≥n\", \"Segunda opci√≥n\", etc.
          - ‚úÖ Debe haber una retroalimentaci√≥n visual y auditiva para confirmar que la respuesta de voz fue recibida.
          - ‚úÖ La transcripci√≥n de la respuesta debe enviarse al endpoint del backend para su validaci√≥n." \
            --label "Prioridad: Alta" \
            --milestone "Sprint Frontend (16-21 Octubre)"
