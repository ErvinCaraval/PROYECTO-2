name: üöÄ Crear Backlog y Sprints - BrainBlitz Vision Computacional

on:
  workflow_dispatch: # Permite ejecutar este workflow manualmente desde la pesta√±a Actions

# Define el token con permisos de escritura
permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  setup-vision-backlog:
    runs-on: ubuntu-latest
    steps:
      # PASO 1: Descarga el c√≥digo del repositorio
      - name: Checkout repository
        uses: actions/checkout@v4

      # PASO 2: Crea el proyecto si no existe y obtiene su n√∫mero autom√°ticamente
      - name: Crear Proyecto de GitHub si no existe
        id: project_setup
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          PROJECT_NAME="BrainBlitz - Computer Vision Backlog"
          PROJECT_NUMBER=$(gh project list --owner "@me" --format json | jq -r ".projects[] | select(.title == \"$PROJECT_NAME\") | .number")
          
          if [ -z "$PROJECT_NUMBER" ]; then
            echo "Proyecto '$PROJECT_NAME' no encontrado. Cre√°ndolo ahora..."
            # Crear proyecto sin description (flag no soportado)
            PROJECT_URL=$(gh project create --owner "@me" --title "$PROJECT_NAME")
            PROJECT_NUMBER=$(echo "$PROJECT_URL" | rev | cut -d'/' -f1 | rev)
            echo "Proyecto creado con el n√∫mero: $PROJECT_NUMBER"
          else
            echo "Proyecto '$PROJECT_NAME' ya existe con el n√∫mero: $PROJECT_NUMBER"
          fi
          echo "PROJECT_NUMBER=$PROJECT_NUMBER" >> $GITHUB_OUTPUT

      # PASO 3: Crea las Etiquetas de Prioridad y IA si no existen
      - name: Crear Etiquetas si no existen
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          echo "Creando etiquetas de prioridad..."
          gh label create "Prioridad: Alta" --color "D93F0B" --description "Tarea cr√≠tica y bloqueante." || echo "La etiqueta 'Prioridad: Alta' ya existe."
          gh label create "Prioridad: Media" --color "FBCA04" --description "Tarea importante pero no urgente." || echo "La etiqueta 'Prioridad: Media' ya existe."
          gh label create "Prioridad: Baja" --color "0E8A16" --description "Tarea menor o mejora deseable." || echo "La etiqueta 'Prioridad: Baja' ya existe."
          
          echo "Creando etiquetas de tecnolog√≠a..."
          gh label create "Tecnolog√≠a: Azure" --color "0078D4" --description "Usa servicios de Azure" || echo "La etiqueta 'Tecnolog√≠a: Azure' ya existe."
          gh label create "Tecnolog√≠a: DeepFace" --color "6F42C1" --description "Usa DeepFace para reconocimiento facial" || echo "La etiqueta 'Tecnolog√≠a: DeepFace' ya existe."
          gh label create "Tecnolog√≠a: Firebase" --color "FF6D01" --description "Integraci√≥n con Firebase" || echo "La etiqueta 'Tecnolog√≠a: Firebase' ya existe."
          gh label create "IA: Visi√≥n Computacional" --color "00B294" --description "Implementa visi√≥n computacional" || echo "La etiqueta 'IA: Visi√≥n Computacional' ya existe."

      # PASO 4: Crea los Milestones (Sprints) solo si no existen
      - name: Crear Milestones para Sprints
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
          GH_REPO: ${{ github.repository }}
        run: |
          # --- Sprint 1: Autenticaci√≥n y Extracci√≥n ---
          MILESTONE_SPRINT1_TITLE="Sprint 1: Autenticaci√≥n y Extracci√≥n (17-19 Noviembre)"
          if gh api /repos/${GH_REPO}/milestones --paginate -q ".[] | select(.title == \"$MILESTONE_SPRINT1_TITLE\")" | grep -qF "$MILESTONE_SPRINT1_TITLE"; then
            echo "Milestone '$MILESTONE_SPRINT1_TITLE' ya existe. Omitiendo."
          else
            echo "Creando milestone '$MILESTONE_SPRINT1_TITLE'..."
            gh api --method POST -H "Accept: application/vnd.github+json" "/repos/${GH_REPO}/milestones" \
              -f title="$MILESTONE_SPRINT1_TITLE" \
              -f description='Implementar OCR y Reconocimiento Facial. Total: 21 Story Points' \
              -f due_on='2025-11-19T23:59:59Z'
          fi

          # --- Sprint 2: An√°lisis Visual Avanzado ---
          MILESTONE_SPRINT2_TITLE="Sprint 2: An√°lisis Visual Avanzado (20-24 Noviembre)"
          if gh api /repos/${GH_REPO}/milestones --paginate -q ".[] | select(.title == \"$MILESTONE_SPRINT2_TITLE\")" | grep -qF "$MILESTONE_SPRINT2_TITLE"; then
            echo "Milestone '$MILESTONE_SPRINT2_TITLE' ya existe. Omitiendo."
          else
            echo "Creando milestone '$MILESTONE_SPRINT2_TITLE'..."
            gh api --method POST -H "Accept: application/vnd.github+json" "/repos/${GH_REPO}/milestones" \
              -f title="$MILESTONE_SPRINT2_TITLE" \
              -f description='Implementar an√°lisis de im√°genes y detecci√≥n de objetos. Total: 20 Story Points' \
              -f due_on='2025-11-24T23:59:59Z'
          fi

          # --- Release 1.0 ---
          MILESTONE_RELEASE_TITLE="Release 1.0: Computer Vision Foundation (24 Noviembre)"
          if gh api /repos/${GH_REPO}/milestones --paginate -q ".[] | select(.title == \"$MILESTONE_RELEASE_TITLE\")" | grep -qF "$MILESTONE_RELEASE_TITLE"; then
            echo "Milestone '$MILESTONE_RELEASE_TITLE' ya existe. Omitiendo."
          else
            echo "Creando milestone '$MILESTONE_RELEASE_TITLE'..."
            gh api --method POST -H "Accept: application/vnd.github+json" "/repos/${GH_REPO}/milestones" \
              -f title="$MILESTONE_RELEASE_TITLE" \
              -f description='Lanzamiento con todas las funcionalidades de visi√≥n computacional' \
              -f due_on='2025-11-24T23:59:59Z'
          fi

      # PASO 5: Crea todos los Issues de Visi√≥n Computacional
      - name: Crear Issues de Visi√≥n Computacional
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
          PROJECT_NUMBER: ${{ steps.project_setup.outputs.PROJECT_NUMBER }}
        run: |
          create_and_add_to_project() {
            local title="$1"
            local body="$2"
            local labels="$3"
            local milestone="$4"
            
            ISSUE_URL=$(gh issue list --state all --search "in:title \"$title\"" --json url -q ".[0].url")

            if [ -n "$ISSUE_URL" ]; then
              echo "Issue '$title' ya existe. Omitiendo creaci√≥n."
            else
              echo "Creando issue '$title'..."
              ISSUE_URL=$(gh issue create --title "$title" --body "$body" --label "$labels" --milestone "$milestone")
            fi

            if [ -n "$ISSUE_URL" ]; then
                echo "A√±adiendo issue $ISSUE_URL al proyecto ${{ env.PROJECT_NUMBER }}..."
                PROJECT_ID=$(gh project view ${{ env.PROJECT_NUMBER }} --owner "@me" --format json | jq -r '.id')
                CONTENT_ID=$(gh issue view $ISSUE_URL --json id | jq -r '.id')

                ITEM_ID=$(gh api graphql -f query='
                  mutation($project:ID!, $content:ID!) {
                    addProjectV2ItemById(input: {projectId: $project, contentId: $content}) {
                      item { id }
                    }
                  }
                ' -f project="$PROJECT_ID" -f content="$CONTENT_ID" | jq -r '.data.addProjectV2ItemById.item.id')

                # Intentar mover a la columna Todo (si existe)
                TODO_COLUMN_ID="f75ad846"
                STATUS_FIELD_ID="PVTSSF_lAHOCfyr_s4BFLg_zg2l7HM"
                
                # Verificar si la columna existe antes de intentar mover
                gh api graphql -f query="
                  mutation {
                    updateProjectV2ItemFieldValue(input: {
                      projectId: \"$PROJECT_ID\",
                      itemId: \"$ITEM_ID\",
                      fieldId: \"$STATUS_FIELD_ID\",
                      value: {singleSelectOptionId: \"$TODO_COLUMN_ID\"}
                    }) {
                      projectV2Item { id }
                    }
                  }
                " || echo "No se pudo mover la issue a la columna 'Todo'. Puede que el campo no exista."
            fi
          }

          # ===============================================
          # ==         SPRINT 1: AUTENTICACI√ìN Y EXTRACCI√ìN
          # ===============================================

          create_and_add_to_project \
            "HU-VC2: [BE] OCR - Extracci√≥n de Texto de Im√°genes" \
            "**üìÖ Fecha Objetivo:** Lunes 17 Noviembre 2025  
            **üî¢ Estimaci√≥n:** 8 Story Points  
            **üéØ Prioridad:** Media  
            **ü§ñ Requiere IA:** ‚úÖ S√≠ (Azure Computer Vision OCR)

            ### Contexto
            Los usuarios y administradores de BrainBlitz necesitan una forma de convertir im√°genes con texto (pantallas, documentos, carteles, capturas) en texto editable para generar preguntas autom√°ticamente o procesar contenido visual.

            ### Objetivo
            Implementar un sistema de reconocimiento √≥ptico de caracteres (OCR) que permita extraer texto de im√°genes subidas por usuarios o administradores, facilitando la creaci√≥n de preguntas y el procesamiento de contenido visual.

            ### Criterios de Aceptaci√≥n

            **1. Configuraci√≥n de Azure:**
            - ‚úÖ Cuenta Azure con Computer Vision habilitado
            - ‚úÖ API Key de Azure Computer Vision disponible
            - ‚úÖ Variables de entorno configuradas en .env

            **2. Endpoint Backend:**
            - ‚úÖ Ruta \`POST /api/vision/extract-text\` en \`backend-v1/routes/vision.routes.js\`
            - ‚úÖ Controlador \`visionController.js\` con m√©todo \`extractText\`
            - ‚úÖ Middleware de autenticaci√≥n \`authenticate.js\`
            - ‚úÖ Validaci√≥n de imagen en Base64 o archivo

            **3. Integraci√≥n con Azure OCR:**
            - ‚úÖ POST a \`https://{endpoint}/vision/v3.2/read/analyze\`
            - ‚úÖ Manejo de procesamiento as√≠ncrono de Azure (analyze ‚Üí get results)
            - ‚úÖ Extracci√≥n de todas las l√≠neas de texto de la respuesta

            **4. Frontend:**
            - ‚úÖ Componente \`OCRQuestionCreator.jsx\` con subida de imagen
            - ‚úÖ Preview de imagen subida
            - ‚úÖ Bot√≥n \"Extraer Texto\" ‚Üí llamada a \`/api/vision/extract-text\`
            - ‚úÖ Textarea editable con texto extra√≠do
            - ‚úÖ Integraci√≥n con \`AIQuestionGenerator.jsx\`

            **5. Pruebas:**
            - ‚úÖ Prueba unitaria de funci√≥n de extracci√≥n
            - ‚úÖ Prueba de integraci√≥n del endpoint completo
            - ‚úÖ Prueba manual con JPG, PNG, PDF

            ### Tecnolog√≠as
            - Azure Computer Vision OCR
            - Node.js
            - Express
            - React
            - Base64 encoding

            ### Dependencias
            - Configuraci√≥n de Azure Computer Vision
            - Variables: \`AZURE_COMPUTER_VISION_KEY\`, \`AZURE_COMPUTER_VISION_ENDPOINT\`" \
            "Prioridad: Media,IA: Visi√≥n Computacional,Tecnolog√≠a: Azure" "Sprint 1: Autenticaci√≥n y Extracci√≥n (17-19 Noviembre)"

          create_and_add_to_project \
            "HU-VC1: [BE] Reconocimiento Facial para Login y Registro" \
            "**üìÖ Fecha Objetivo:** Martes 18 Noviembre 2025  
            **üî¢ Estimaci√≥n:** 13 Story Points  
            **üéØ Prioridad:** Alta  
            **ü§ñ Requiere IA:** ‚úÖ S√≠ (DeepFace + VGG-Face)

            ### Contexto
            Los usuarios de BrainBlitz necesitan una forma segura y moderna de autenticarse sin depender √∫nicamente de contrase√±as. Se requiere implementar autenticaci√≥n biom√©trica mediante reconocimiento facial.

            ### Objetivo
            Permitir que los usuarios se registren e inicien sesi√≥n usando reconocimiento facial como m√©todo de autenticaci√≥n alternativo o principal, mejorando la seguridad y la experiencia de usuario.

            ### Criterios de Aceptaci√≥n

            **1. Registro Facial:**
            - ‚úÖ Endpoint \`POST /api/face/register\` que acepta imagen Base64 y token Firebase
            - ‚úÖ Validaci√≥n de rostro visible usando DeepFace
            - ‚úÖ Generaci√≥n de embeddings faciales con modelo VGG-Face
            - ‚úÖ Almacenamiento de embeddings en Firestore asociados al userId
            - ‚úÖ Prevenci√≥n de duplicados (un usuario = un registro facial)

            **2. Login Facial:**
            - ‚úÖ Endpoint \`POST /api/face/login\` que acepta imagen Base64 y email
            - ‚úÖ B√∫squeda de usuario por email en Firebase Auth
            - ‚úÖ Comparaci√≥n facial con embedding almacenado
            - ‚úÖ Umbral de confianza m√≠nimo (ej: 0.7)
            - ‚úÖ Generaci√≥n de token personalizado de Firebase si verificaci√≥n exitosa

            **3. Frontend - Registro Facial:**
            - ‚úÖ Componente \`FaceRegister.jsx\` con vista previa de c√°mara en tiempo real
            - ‚úÖ Captura de foto del rostro
            - ‚úÖ Conversi√≥n a Base64
            - ‚úÖ Env√≠o al endpoint \`/api/face/register\`
            - ‚úÖ Indicador visual cuando se detecta un rostro

            **4. Frontend - Login Facial:**
            - ‚úÖ Componente \`FaceLogin.jsx\` con campo de email y vista previa de c√°mara
            - ‚úÖ Captura de foto y env√≠o al endpoint \`/api/face/login\`
            - ‚úÖ Integraci√≥n con \`AuthContext\`
            - ‚úÖ Redirecci√≥n a p√°gina principal despu√©s de login exitoso

            **5. Microservicio Facial:**
            - ‚úÖ Servicio \`facial-service\` con DeepFace desplegado en Azure Container Instances
            - ‚úÖ Health check: \`GET /health\` responde correctamente
            - ‚úÖ Configuraci√≥n de URL en \`.env\` como \`DEEPFACE_SERVICE_URL\`

            **6. Seguridad:**
            - ‚úÖ Registro facial requiere token Firebase v√°lido
            - ‚úÖ Rate limiting en endpoints para prevenir ataques
            - ‚úÖ Almacenamiento seguro de embeddings en Firestore

            ### Tecnolog√≠as
            - DeepFace
            - VGG-Face (modelo de embeddings)
            - Azure Container Instances
            - Firebase Auth
            - React
            - getUserMedia API

            ### Dependencias
            - Microservicio facial desplegado
            - Firebase Auth configurado
            - Azure Container Instances" \
            "Prioridad: Alta,IA: Visi√≥n Computacional,Tecnolog√≠a: DeepFace,Tecnolog√≠a: Firebase" "Sprint 1: Autenticaci√≥n y Extracci√≥n (17-19 Noviembre)"

          # ===============================================
          # ==         SPRINT 2: AN√ÅLISIS VISUAL AVANZADO
          # ===============================================

          create_and_add_to_project \
            "HU-VC3: [BE] An√°lisis Inteligente de Im√°genes" \
            "**üìÖ Fecha Objetivo:** Jueves 20 Noviembre 2025  
            **üî¢ Estimaci√≥n:** 10 Story Points  
            **üéØ Prioridad:** Media  
            **ü§ñ Requiere IA:** ‚úÖ S√≠ (Azure Computer Vision Analyze)

            ### Contexto
            Los usuarios y administradores de BrainBlitz necesitan generar preguntas autom√°ticamente a partir de im√°genes. Se requiere un sistema que analice im√°genes y genere descripciones, tags y categor√≠as autom√°ticamente.

            ### Objetivo
            Implementar un sistema de an√°lisis inteligente de im√°genes que genere descripciones autom√°ticas, tags, categor√≠as y metadatos de im√°genes, permitiendo crear preguntas de trivia basadas en contenido visual de forma autom√°tica.

            ### Criterios de Aceptaci√≥n

            **1. Endpoint Backend:**
            - ‚úÖ Ruta \`POST /api/vision/analyze-image\` en \`backend-v1/routes/vision.routes.js\`
            - ‚úÖ M√©todo \`analyzeImage\` en \`visionController.js\`
            - ‚úÖ Autenticaci√≥n requerida
            - ‚úÖ Validaci√≥n de imagen Base64 o archivo, m√°ximo 4MB

            **2. Integraci√≥n con Azure Analyze Image:**
            - ‚úÖ POST a \`https://{endpoint}/vision/v3.2/analyze?visualFeatures=Description,Tags,Categories,Objects,Color\`
            - ‚úÖ Procesamiento correcto de respuesta JSON
            - ‚úÖ Extracci√≥n de: descripci√≥n, tags, categor√≠as, objetos y colores

            **3. Respuesta del Endpoint:**
            - ‚úÖ Objeto JSON estructurado con descripci√≥n, tags, categor√≠as, objetos y colores
            - ‚úÖ Niveles de confianza incluidos
            - ‚úÖ Tags y categor√≠as ordenados por confianza descendente

            **4. Frontend:**
            - ‚úÖ Componente \`ImageAnalysisQuestionCreator.jsx\` con subida de imagen
            - ‚úÖ Preview de imagen
            - ‚úÖ Bot√≥n \"Analizar Imagen\" ‚Üí llamada a \`/api/vision/analyze-image\`
            - ‚úÖ Resultados en secciones: Descripci√≥n, Tags, Categor√≠as, Objetos
            - ‚úÖ Bot√≥n \"Generar Pregunta desde An√°lisis\"

            **5. Generaci√≥n Autom√°tica de Preguntas:**
            - ‚úÖ Usa descripci√≥n como base para pregunta
            - ‚úÖ Usa tags para sugerir categor√≠a
            - ‚úÖ Pre-llena campo: \"¬øQu√© se muestra en esta imagen?\"
            - ‚úÖ Sugiere opciones basadas en tags y objetos

            **6. Pruebas:**
            - ‚úÖ Prueba unitaria con imagen de prueba
            - ‚úÖ Prueba de integraci√≥n del endpoint
            - ‚úÖ Prueba con im√°genes de arte, geograf√≠a, objetos, personas

            ### Tecnolog√≠as
            - Azure Computer Vision Analyze Image
            - Node.js
            - Express
            - React

            ### Dependencias
            - Azure Computer Vision configurado
            - Variables: \`AZURE_COMPUTER_VISION_KEY\`, \`AZURE_COMPUTER_VISION_ENDPOINT\`" \
            "Prioridad: Media,IA: Visi√≥n Computacional,Tecnolog√≠a: Azure" "Sprint 2: An√°lisis Visual Avanzado (20-24 Noviembre)"

          create_and_add_to_project \
            "HU-VC4: [BE] Detecci√≥n de Objetos en Im√°genes" \
            "**üìÖ Fecha Objetivo:** Viernes 21 Noviembre 2025  
            **üî¢ Estimaci√≥n:** 10 Story Points  
            **üéØ Prioridad:** Media  
            **ü§ñ Requiere IA:** ‚úÖ S√≠ (Azure Computer Vision Object Detection)

            ### Contexto
            Los usuarios de BrainBlitz necesitan crear preguntas visuales donde se identifiquen objetos espec√≠ficos en im√°genes. Actualmente, no existe funcionalidad para detectar y localizar objetos en im√°genes.

            ### Objetivo
            Implementar un sistema de detecci√≥n de objetos que identifique y localice objetos espec√≠ficos dentro de im√°genes, permitiendo crear preguntas interactivas basadas en la detecci√≥n de objetos.

            ### Criterios de Aceptaci√≥n

            **1. Endpoint Backend:**
            - ‚úÖ Ruta \`POST /api/vision/detect-objects\` en \`backend-v1/routes/vision.routes.js\`
            - ‚úÖ M√©todo \`detectObjects\` en \`visionController.js\`
            - ‚úÖ Autenticaci√≥n requerida
            - ‚úÖ Validaci√≥n de imagen Base64 o archivo, m√°ximo 4MB

            **2. Integraci√≥n con Azure Object Detection:**
            - ‚úÖ POST a \`https://{endpoint}/vision/v3.2/detect\`
            - ‚úÖ Procesamiento de respuesta JSON con objetos detectados
            - ‚úÖ Lista de objetos con nombre, confianza, bounding box y √°rea

            **3. Frontend - Visualizaci√≥n:**
            - ‚úÖ Componente \`ObjectDetectionQuestionCreator.jsx\` con subida de imagen
            - ‚úÖ Preview de imagen con bounding boxes dibujados sobre objetos
            - ‚úÖ Lista de objetos con nombre y nivel de confianza
            - ‚úÖ Funcionalidades interactivas (hover sobre objeto ‚Üí resalta bounding box)

            **4. Frontend - Generaci√≥n de Preguntas:**
            - ‚úÖ Bot√≥n \"Crear Pregunta de Objetos\"
            - ‚úÖ Genera: \"¬øQu√© objeto aparece en esta imagen?\" o \"¬øCu√°ntos [objeto] hay?\"
            - ‚úÖ Usa objetos detectados como opciones
            - ‚úÖ Marca objeto con mayor confianza como correcto

            **5. Tipos de Preguntas:**
            - ‚úÖ Preguntas de identificaci√≥n: \"¬øQu√© objeto es este?\"
            - ‚úÖ Preguntas de conteo: \"¬øCu√°ntos [objeto] hay en la imagen?\"
            - ‚úÖ Sistema cuenta objetos del mismo tipo
            - ‚úÖ Genera opciones num√©ricas (0, 1, 2, 3, 4+)

            **6. Pruebas:**
            - ‚úÖ Prueba unitaria con imagen de prueba
            - ‚úÖ Prueba de integraci√≥n del endpoint
            - ‚úÖ Verificaci√≥n de detecci√≥n de m√∫ltiples objetos
            - ‚úÖ Verificaci√≥n de precisi√≥n en bounding boxes

            ### Tecnolog√≠as
            - Azure Computer Vision Object Detection
            - Node.js
            - Express
            - React
            - Canvas API (para dibujar bounding boxes)

            ### Dependencias
            - Azure Computer Vision configurado
            - Variables: \`AZURE_COMPUTER_VISION_KEY\`, \`AZURE_COMPUTER_VISION_ENDPOINT\`" \
            "Prioridad: Media,IA: Visi√≥n Computacional,Tecnolog√≠a: Azure" "Sprint 2: An√°lisis Visual Avanzado (20-24 Noviembre)"

      # PASO 6: Crea y Vincula las Ramas para cada Issue de Visi√≥n Computacional
      - name: Crear Ramas para HUs de Visi√≥n Computacional
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
        run: |
          MAIN_BRANCH_SHA=$(git rev-parse main)
          gh issue list --state open --json number,title | jq -c '.[]' | while read issue; do
            ISSUE_NUMBER=$(echo $issue | jq -r '.number')
            ISSUE_TITLE=$(echo $issue | jq -r '.title')
            BRANCH_TITLE=$(echo "$ISSUE_TITLE" | iconv -t ascii//TRANSLIT | sed -E 's/\[(BE|FE)\] //g' | sed -E 's/HU-VC[0-9]+: //g' | sed -E 's/[^a-zA-Z0-9]+/-/g' | sed -E 's/^-+\|-+$//g' | tr '[:upper:]' '[:lower:]')
            BRANCH_NAME="hu-vc${ISSUE_NUMBER}-${BRANCH_TITLE}"

            if git ls-remote --heads origin "$BRANCH_NAME" | grep -q "$BRANCH_NAME"; then
              echo "La rama '$BRANCH_NAME' ya existe."
            else
              echo "Creando rama '$BRANCH_NAME'..."
              gh api repos/${{ github.repository }}/git/refs --method POST -f ref="refs/heads/${BRANCH_NAME}" -f sha="$MAIN_BRANCH_SHA"
              # Comenta en la issue para vincular la rama
              gh issue comment $ISSUE_NUMBER --body "üöÄ **Rama de trabajo creada para esta HU de Visi√≥n Computacional:** \`$BRANCH_NAME\`

              **Para comenzar a trabajar:**
              \`\`\`bash
              git fetch origin
              git checkout $BRANCH_NAME
              \`\`\`

              **Recuerda:** Esta HU implementa servicios de IA (Azure Computer Vision/DeepFace) - aseg√∫rate de tener las variables de entorno configuradas."
            fi
          done
