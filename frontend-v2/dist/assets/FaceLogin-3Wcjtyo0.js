import{r as t,b as V,j as e,s as A,e as B}from"./index-B7SNj0r6.js";import{B as h}from"./Button-BAFGbEtv.js";import{I as $}from"./Input-D9M14c8m.js";import{A as x}from"./Alert-CmJLF0tw.js";import{F as O,o as U,a as R,g as C}from"./imageOptimizer-C7-BxCaI.js";import"./clsx-B-dksMZM.js";import"./index-B9PUOGrg.js";function H(){const[d,k]=t.useState(""),[f,o]=t.useState(""),[v,m]=t.useState(""),[c,j]=t.useState(!1),[w,i]=t.useState(""),[b,u]=t.useState(null),[N,p]=t.useState(null),[y,g]=t.useState("email"),[z,q]=t.useState(!1),E=V(),S=async a=>{try{i("Optimizando imagen...");const s=z?await U(a):await R(a,200,200,.3),n=C(a),l=C(s),r=Math.round((1-l/n)*100);console.log(`‚úì Imagen optimizada: ${n}KB ‚Üí ${l}KB (${r}% reducci√≥n)`),u(s),p(s),i("")}catch(s){console.error("Error optimizando imagen, usando original:",s),u(a),p(a),i("")}},F=()=>{u(null),p(null),o(""),m("")},I=a=>{if(a.preventDefault(),!d){o("Por favor, ingresa tu email");return}o(""),g("capture")},T=async()=>{if(!b){o("Por favor, captura una foto primero");return}if(!d){o("Email requerido"),g("email");return}j(!0),i("Enviando imagen..."),o(""),m("");try{const a=typeof window<"u"&&window.ENV?.VITE_API_URL||"https://backend-v1-latest.onrender.com/api";i("Verificando rostro...");const s=JSON.stringify({image:b,email:d});console.log(`Tama√±o del payload: ${(s.length/1024).toFixed(2)}KB`);const n=await fetch(`${a}/face/login`,{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip, deflate"},body:s,priority:"high"}),l=n.headers.get("content-type");if(!l||!l.includes("application/json")){const P=await n.text();throw console.error("Respuesta no es JSON:",P.substring(0,200)),new Error(`El servidor devolvi√≥ un error. Verifica que el backend est√© corriendo en ${a}`)}const r=await n.json();if(!n.ok)throw new Error(r.error||"Error en el login facial");if(r.success&&r.verified)if(r.customToken)i("Autenticando..."),await A(B,r.customToken),m("¬°Login facial exitoso! Redirigiendo..."),setTimeout(()=>{E("/dashboard")},1e3);else throw new Error("No se recibi√≥ token de autenticaci√≥n");else throw new Error(r.error||"Las caras no coinciden. Acceso denegado.")}catch(a){o(a.message||"Error al verificar la cara. Por favor, intenta de nuevo."),console.error("Error en login facial:",a)}finally{j(!1),i("")}},L=()=>{g("email"),u(null),p(null),o(""),m("")};return e.jsx("div",{className:"container min-h-screen px-4 py-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"üîê Login Facial"}),e.jsx("p",{className:"text-white/70 mt-2",children:"Inicia sesi√≥n usando reconocimiento facial"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-6",children:[f&&e.jsx(x,{intent:"error",className:"mb-4",children:f}),v&&e.jsx(x,{intent:"success",className:"mb-4",children:v}),w&&e.jsxs(x,{intent:"info",className:"mb-4",children:["‚è≥ ",w]}),y==="email"?e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx($,{id:"email",type:"email",placeholder:"t√∫@correo.com",value:d,onChange:a=>k(a.target.value),required:!0,disabled:c})]}),e.jsx(h,{type:"submit",size:"lg",disabled:c,className:"w-full",children:"Continuar con Login Facial"})]}):e.jsx("div",{className:"space-y-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",children:e.jsx("img",{src:N,alt:"Foto capturada",className:"w-full h-auto max-h-[480px] mx-auto"})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(h,{onClick:F,variant:"outline",disabled:c,size:"lg",children:"üîÑ Tomar Otra Foto"}),e.jsx(h,{onClick:T,disabled:c,size:"lg",children:c?"‚è≥ Verificando...":"‚úÖ Verificar y Login"})]})]}):e.jsx(O,{onCapture:S,onCancel:L,disabled:c,buttonText:"üì∑ Capturar Foto",showCancel:!0})}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:y==="email"&&e.jsx(h,{onClick:()=>E("/login"),variant:"ghost",size:"sm",children:"‚Üê Volver a Login Normal"})})]})]})})}export{H as default};
//# sourceMappingURL=FaceLogin-3Wcjtyo0.js.map
