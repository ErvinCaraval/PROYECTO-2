import{r as t,b as B,j as e,s as $,e as A}from"./index-CRb7qZFo.js";import{B as h}from"./Button-7Y13wYfL.js";import{I as O}from"./Input-QI7jrzu-.js";import{A as x}from"./Alert-Cb-iS52y.js";import{F as V,o as U,a as q,g as E}from"./imageOptimizer-BsLdWxYT.js";function G(){const[d,z]=t.useState(""),[f,o]=t.useState(""),[v,m]=t.useState(""),[l,j]=t.useState(!1),[b,i]=t.useState(""),[w,u]=t.useState(null),[N,p]=t.useState(null),[y,g]=t.useState("email"),[S,K]=t.useState(!1),C=B(),k=async a=>{try{i("Optimizando imagen...");const s=S?await U(a):await q(a,200,200,.3),n=E(a),c=E(s),r=Math.round((1-c/n)*100);console.log(`‚úì Imagen optimizada: ${n}KB ‚Üí ${c}KB (${r}% reducci√≥n)`),u(s),p(s),i("")}catch(s){console.error("Error optimizando imagen, usando original:",s),u(a),p(a),i("")}},F=()=>{u(null),p(null),o(""),m("")},T=a=>{if(a.preventDefault(),!d){o("Por favor, ingresa tu email");return}o(""),g("capture")},I=async()=>{if(!w){o("Por favor, captura una foto primero");return}if(!d){o("Email requerido"),g("email");return}j(!0),i("Enviando imagen..."),o(""),m("");try{const a="http://localhost:5000/api";i("Verificando rostro...");const s=JSON.stringify({image:w,email:d});console.log(`Tama√±o del payload: ${(s.length/1024).toFixed(2)}KB`);const n=await fetch(`${a}/face/login`,{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip, deflate"},body:s,priority:"high"}),c=n.headers.get("content-type");if(!c||!c.includes("application/json")){const P=await n.text();throw console.error("Respuesta no es JSON:",P.substring(0,200)),new Error(`El servidor devolvi√≥ un error. Verifica que el backend est√© corriendo en ${a}`)}const r=await n.json();if(!n.ok)throw new Error(r.error||"Error en el login facial");if(r.success&&r.verified)if(r.customToken)i("Autenticando..."),await $(A,r.customToken),m("¬°Login facial exitoso! Redirigiendo..."),setTimeout(()=>{C("/dashboard")},1e3);else throw new Error("No se recibi√≥ token de autenticaci√≥n");else throw new Error(r.error||"Las caras no coinciden. Acceso denegado.")}catch(a){o(a.message||"Error al verificar la cara. Por favor, intenta de nuevo."),console.error("Error en login facial:",a)}finally{j(!1),i("")}},L=()=>{g("email"),u(null),p(null),o(""),m("")};return e.jsx("div",{className:"container min-h-screen px-4 py-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"üîê Login Facial"}),e.jsx("p",{className:"text-white/70 mt-2",children:"Inicia sesi√≥n usando reconocimiento facial"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-6",children:[f&&e.jsx(x,{intent:"error",className:"mb-4",children:f}),v&&e.jsx(x,{intent:"success",className:"mb-4",children:v}),b&&e.jsxs(x,{intent:"info",className:"mb-4",children:["‚è≥ ",b]}),y==="email"?e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(O,{id:"email",type:"email",placeholder:"t√∫@correo.com",value:d,onChange:a=>z(a.target.value),required:!0,disabled:l})]}),e.jsx(h,{type:"submit",size:"lg",disabled:l,className:"w-full",children:"Continuar con Login Facial"})]}):e.jsx("div",{className:"space-y-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",children:e.jsx("img",{src:N,alt:"Foto capturada",className:"w-full h-auto max-h-[480px] mx-auto"})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(h,{onClick:F,variant:"outline",disabled:l,size:"lg",children:"üîÑ Tomar Otra Foto"}),e.jsx(h,{onClick:I,disabled:l,size:"lg",children:l?"‚è≥ Verificando...":"‚úÖ Verificar y Login"})]})]}):e.jsx(V,{onCapture:k,onCancel:L,disabled:l,buttonText:"üì∑ Capturar Foto",showCancel:!0})}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:y==="email"&&e.jsx(h,{onClick:()=>C("/login"),variant:"ghost",size:"sm",children:"‚Üê Volver a Login Normal"})})]})]})})}export{G as default};
//# sourceMappingURL=FaceLogin-B1gIUAwV.js.map
