{"version":3,"file":"OCRQuestionCapture-tYTHYRD8.js","sources":["../../src/components/OCRQuestionCapture.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\nimport Spinner from './ui/Spinner';\n\nconst OCRQuestionCapture = ({ topics, onQuestionExtracted, onCancel }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [mode, setMode] = useState(null); // 'upload' only\n  const [selectedTopic, setSelectedTopic] = useState(topics[0] || '');\n  const [imageFile, setImageFile] = useState(null);\n  const [imagePreview, setImagePreview] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const [processedQuestion, setProcessedQuestion] = useState(null);\n  const [manualQuestion, setManualQuestion] = useState({ pregunta: '', opciones: { a: '', b: '', c: '', d: '' } });\n  const [correctAnswerIndex, setCorrectAnswerIndex] = useState(0); // Track which option is correct\n  const [savedQuestions, setSavedQuestions] = useState([]); // Track saved questions\n  const fileInputRef = useRef(null);\n\n  const apiBase = import.meta.env.VITE_API_URL;\n\n  /**\n   * Handle file selection from input\n   */\n  const handleFileSelect = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!['image/jpeg', 'image/png', 'image/jpg'].includes(file.type)) {\n      setError('Por favor selecciona una imagen (PNG, JPG, JPEG)');\n      return;\n    }\n\n    // Validate file size (max 10MB for OCR)\n    if (file.size > 10 * 1024 * 1024) {\n      setError('La imagen es demasiado grande. M√°ximo 10MB');\n      return;\n    }\n\n    setImageFile(file);\n    setError('');\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      setImagePreview(e.target.result);\n    };\n    reader.readAsDataURL(file);\n\n    // Announce to voice\n    if (isVoiceModeEnabled) {\n      speak(`Imagen seleccionada: ${file.name}. Presiona procesar para extraer la pregunta.`, { force: true });\n    }\n  };\n\n\n\n  /**\n   * Process image using OCR\n   */\n  const processImage = async () => {\n    if (!imageFile) {\n      setError('Por favor selecciona o captura una imagen');\n      return;\n    }\n\n    if (!apiBase) {\n      setError('Error de configuraci√≥n: URL del API no definida');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSuccessMessage('');\n\n    try {\n      // Convert file to base64\n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        const base64Image = e.target.result;\n\n        try {\n          const response = await fetch(`${apiBase}/ocr/process-image`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              imageBase64: base64Image,\n              mimeType: imageFile.type || 'image/jpeg',\n              language: 'es'\n            })\n          });\n\n          const data = await response.json();\n\n          if (data.success) {\n            // Check if OCR detection was successful or partial\n            const hasQuestion = data.pregunta && !data.pregunta.includes('no detectada');\n            const detectedOptions = Object.values(data.opciones || {}).filter(opt => opt && !opt.includes('no detectada'));\n            \n            if (!hasQuestion || detectedOptions.length === 0) {\n              // Partial detection - show warning but allow manual completion\n              setProcessedQuestion({\n                pregunta: data.pregunta || '',\n                opciones: data.opciones || { a: '', b: '', c: '', d: '' }\n              });\n              setSuccessMessage('‚ö†Ô∏è Detecci√≥n parcial. Por favor completa los campos vac√≠os manualmente.');\n              \n              if (isVoiceModeEnabled) {\n                speak('Extracci√≥n parcial. Por favor completa la pregunta y las opciones manualmente.', { force: true });\n              }\n            } else {\n              // Full or mostly successful detection\n              setProcessedQuestion({\n                pregunta: data.pregunta,\n                opciones: data.opciones\n              });\n              setSuccessMessage('‚úÖ Pregunta extra√≠da correctamente');\n\n              if (isVoiceModeEnabled) {\n                speak(`Pregunta detectada: ${data.pregunta}`, { force: true });\n              }\n            }\n          } else {\n            setError(data.error || 'Error procesando la imagen');\n          }\n        } catch (err) {\n          setError(`Error al procesar la imagen: ${err.message}`);\n        } finally {\n          setLoading(false);\n        }\n      };\n\n      reader.readAsDataURL(imageFile);\n    } catch (err) {\n      setError(`Error: ${err.message}`);\n      setLoading(false);\n    }\n  };\n\n  /**\n   * Confirm and submit the extracted question\n   */\n  const confirmQuestion = async () => {\n    // Validation: check if we have a pregunta and at least 2 options\n    const pregunta = processedQuestion.pregunta?.trim();\n    const opciones = processedQuestion.opciones;\n    const optionsArray = [\n      opciones.a?.trim() || '',\n      opciones.b?.trim() || '',\n      opciones.c?.trim() || '',\n      opciones.d?.trim() || ''\n    ].filter(o => o);\n    \n    const hasAtLeastTwoOptions = optionsArray.length >= 2;\n\n    if (!pregunta) {\n      setError('Por favor escribe la pregunta');\n      return;\n    }\n\n    if (!hasAtLeastTwoOptions) {\n      setError('Por favor completa al menos 2 opciones de respuesta');\n      return;\n    }\n\n    if (!selectedTopic) {\n      setError('Por favor selecciona un tema');\n      return;\n    }\n\n    // Validate that correctAnswerIndex is within bounds\n    if (correctAnswerIndex < 0 || correctAnswerIndex >= optionsArray.length) {\n      setError('Por favor selecciona cu√°l opci√≥n es correcta');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    // Create question payload\n    const questionPayload = {\n      text: pregunta,\n      options: optionsArray,\n      correctAnswerIndex: correctAnswerIndex,\n      category: selectedTopic,\n      explanation: ''\n    };\n\n    try {\n      if (onQuestionExtracted) {\n        // Wait for the callback to complete\n        await onQuestionExtracted(questionPayload);\n        \n        // Show success message\n        setSuccessMessage('‚úÖ Pregunta guardada exitosamente');\n        \n        // Add to local saved questions list\n        setSavedQuestions([...savedQuestions, questionPayload]);\n        \n        // Reset form after a short delay to show the success message\n        // Mantener modal abierto para agregar m√°s preguntas\n        setTimeout(() => {\n          setImageFile(null);\n          setImagePreview(null);\n          setProcessedQuestion(null);\n          setMode(null);\n          setCorrectAnswerIndex(0);\n          setSuccessMessage('');\n        }, 2000);\n      }\n    } catch (err) {\n      setError(`Error al guardar la pregunta: ${err.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /**\n   * Reset form\n   */\n  const resetForm = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    setProcessedQuestion(null);\n    setMode(null);\n    setCorrectAnswerIndex(0);\n    stopCamera();\n    setError('');\n    setSuccessMessage('');\n  };\n\n  useEffect(() => {\n  if (isVoiceModeEnabled && !mode && !imageFile) {\n    // Don't include 'speak' in dependencies to avoid infinite loops\n    speak('Formulario de captura de pregunta. Selecciona una imagen o toma una foto.', { force: true });\n  }\n}, [isVoiceModeEnabled, mode, imageFile]);\n\n\n  return (\n    <div className=\"grid gap-4 p-4\">\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end mb-3 -mt-1\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              await speak('Captura de pregunta. Puedes subir una imagen o tomar una foto desde la c√°mara. La aplicaci√≥n extraer√° autom√°ticamente el texto y las opciones.', {\n                force: true\n              });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n      {/* Show counter of saved questions at top when returning to image selection */}\n      {savedQuestions.length > 0 && !processedQuestion && (\n        <div className=\"p-3 bg-gradient-to-r from-green-500/20 to-green-500/10 rounded-lg border border-green-400/30\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div>\n              <p className=\"text-sm font-semibold text-white\">\n                ‚úÖ {savedQuestions.length} pregunta{savedQuestions.length !== 1 ? 's' : ''} guardada{savedQuestions.length !== 1 ? 's' : ''}\n              </p>\n              <p className=\"text-xs text-green-300 mt-1\">üí° Puedes agregar m√°s o finalizar</p>\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={() => setMode('upload')}\n              onFocus={() => isVoiceModeEnabled && speak('Subir otra imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Subir otra imagen', { force: true })}\n            >\n              üì∑ Otra imagen\n            </Button>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={onCancel}\n              onFocus={() => isVoiceModeEnabled && speak('Finalizar y cerrar', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Finalizar y cerrar', { force: true })}\n            >\n              ‚úì Finalizar\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Mode selection */}\n      {!mode && !imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Crear pregunta</h3>\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <Button\n              onClick={() => setMode('upload')}\n              size=\"lg\"\n              onFocus={() => isVoiceModeEnabled && speak('Subir imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Subir imagen', { force: true })}\n            >\n              üì± Subir imagen\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Upload mode */}\n      {mode === 'upload' && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Subir imagen</h3>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/jpeg,image/png,image/jpg\"\n            onChange={handleFileSelect}\n            className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white\"\n          />\n        </div>\n      )}\n\n      {/* Image preview and processing */}\n      {imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Vista previa</h3>\n          {imagePreview && (\n            <img\n              src={imagePreview}\n              alt=\"Preview\"\n              className=\"w-full max-h-96 rounded-xl object-contain border-2 border-white/10\"\n            />\n          )}\n          <div className=\"flex gap-3\">\n            <Button\n              onClick={processImage}\n              disabled={loading}\n              size=\"lg\"\n              onFocus={() => isVoiceModeEnabled && speak('Procesar imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Procesar imagen', { force: true })}\n            >\n              {loading ? <Spinner size=\"sm\" /> : '‚ö° Procesar'}\n            </Button>\n            <Button\n              variant=\"secondary\"\n              onClick={resetForm}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Seleccionar otra imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Seleccionar otra imagen', { force: true })}\n            >\n              Cambiar imagen\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Processed question display and confirmation */}\n      {processedQuestion && (\n        <div className=\"grid gap-6\">\n          <div className=\"p-4 bg-gradient-to-br from-bb-primary/20 to-bb-primary/10 rounded-xl border-2 border-bb-primary/40\">\n            <h3 className=\"text-lg font-bold mb-2\">üìù Pregunta extra√≠da</h3>\n            <p className=\"text-xs text-white/70\">Completa los campos para guardar tu pregunta</p>\n          </div>\n\n          {!processedQuestion.pregunta || processedQuestion.pregunta.includes('Pregunta no detectada') ? (\n            <div className=\"p-3 bg-orange-500/10 border border-orange-400/30 rounded-lg\">\n              <p className=\"text-sm text-orange-300\">‚ö†Ô∏è <strong>Importante:</strong> OCR no detect√≥ la pregunta correctamente. Por favor completa los campos manualmente.</p>\n            </div>\n          ) : null}\n\n          {/* Tema */}\n          <div className=\"grid gap-2.5\">\n            <label className=\"text-sm font-semibold text-white\">Tema</label>\n            <select\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none transition\"\n            >\n              {topics.map(t => (\n                <option key={t} value={t}>{t}</option>\n              ))}\n            </select>\n          </div>\n\n          {/* Pregunta */}\n          <div className=\"grid gap-2.5\">\n            <label className=\"text-sm font-semibold text-white\">Pregunta</label>\n            <textarea\n              value={processedQuestion.pregunta || ''}\n              placeholder=\"Escribe la pregunta aqu√≠...\"\n              className=\"w-full p-4 rounded-xl bg-white/5 border-2 border-white/10 text-white focus:outline-none focus:ring-2 focus:ring-bb-primary/30 focus:border-bb-primary resize-none transition text-base\"\n              rows=\"4\"\n              onChange={(e) => {\n                setProcessedQuestion(prev => ({\n                  ...prev,\n                  pregunta: e.target.value\n                }));\n              }}\n            />\n          </div>\n\n          {/* Opciones de respuesta */}\n          <div className=\"grid gap-3\">\n            <div className=\"flex items-center justify-between\">\n              <label className=\"text-sm font-semibold text-white\">Opciones de respuesta</label>\n              <span className=\"text-xs text-white/60\">M√≠nimo 2 opciones</span>\n            </div>\n            <div className=\"grid gap-4 p-5 bg-white/5 rounded-lg border border-white/10\">\n              {['a', 'b', 'c', 'd'].map((key, idx) => {\n                const optionText = processedQuestion.opciones[key];\n                const isEmpty = !optionText || optionText.trim() === '' || optionText.includes('no detectada');\n                return (\n                  <div key={key} className=\"flex items-center gap-4\">\n                    <span className=\"font-bold text-bb-primary text-lg min-w-[2.5rem]\">{key.toUpperCase()})</span>\n                    <input\n                      type=\"text\"\n                      value={optionText && !optionText.includes('no detectada') ? optionText : ''}\n                      placeholder={isEmpty ? 'Opci√≥n opcional' : ''}\n                      className={`flex-1 p-3 rounded-lg bg-white/5 border text-white text-sm focus:outline-none focus:ring-2 transition ${\n                        isEmpty \n                          ? 'border-orange-400/50 focus:ring-orange-400/30' \n                          : 'border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary'\n                      }`}\n                      onChange={(e) => {\n                        setProcessedQuestion(prev => ({\n                          ...prev,\n                          opciones: {\n                            ...prev.opciones,\n                            [key]: e.target.value\n                          }\n                        }));\n                      }}\n                    />\n                    <div className=\"flex-shrink-0\">\n                      <input\n                        type=\"radio\"\n                        name=\"correctOption\"\n                        checked={correctAnswerIndex === idx}\n                        onChange={() => setCorrectAnswerIndex(idx)}\n                        disabled={loading || isEmpty}\n                        className=\"h-5 w-5 cursor-pointer accent-bb-primary\"\n                        title={isEmpty ? 'Completa esta opci√≥n para seleccionar' : 'Respuesta correcta'}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n            {['a', 'b', 'c', 'd'].some(key => {\n              const optionText = processedQuestion.opciones[key];\n              return !optionText || optionText.trim() === '' || optionText.includes('no detectada');\n            }) && (\n              <p className=\"text-xs text-orange-300 flex items-center gap-1\">\n                <span>‚ö†Ô∏è</span> Los campos destacados en naranja no fueron detectados. Ed√≠talos manualmente.\n              </p>\n            )}\n          </div>\n\n          {/* Respuesta Correcta */}\n          <div className=\"grid gap-3 p-5 bg-bb-primary/15 rounded-lg border border-bb-primary/40\">\n            <label className=\"text-sm font-semibold text-white flex items-center gap-2\">\n              <span>‚úì Respuesta Correcta</span>\n              <span className=\"text-xs font-normal text-white/60\">(Selecciona arriba)</span>\n            </label>\n            <div className=\"text-sm text-white/80\">\n              {(() => {\n                const selectedIdx = correctAnswerIndex;\n                const optionsArray = ['a', 'b', 'c', 'd'];\n                const selectedOption = optionsArray[selectedIdx];\n                const selectedText = processedQuestion.opciones[selectedOption];\n                return selectedText && !selectedText.includes('no detectada') \n                  ? `${selectedOption.toUpperCase()}) ${selectedText}` \n                  : 'Selecciona una opci√≥n v√°lida';\n              })()}\n            </div>\n          </div>\n\n          {/* Info */}\n          <p className=\"text-xs text-white/60 flex items-center gap-2 p-2 bg-white/5 rounded-lg\">\n            <span>‚ÑπÔ∏è</span>\n            <span>Puedes editar todos los campos. Aseg√∫rate de que todo sea correcto antes de guardar.</span>\n          </p>\n\n          {/* Show saved questions counter */}\n          {savedQuestions.length > 0 && (\n            <div className=\"p-3 bg-gradient-to-r from-green-500/20 to-green-500/10 rounded-lg border border-green-400/30\">\n              <p className=\"text-sm font-semibold text-white\">\n                ‚úÖ {savedQuestions.length} pregunta{savedQuestions.length !== 1 ? 's' : ''} guardada{savedQuestions.length !== 1 ? 's' : ''}\n              </p>\n              <p className=\"text-xs text-green-300 mt-1\">üí° Puedes guardar esta y agregar m√°s, o finalizar</p>\n            </div>\n          )}\n\n          {/* Action Buttons - Organized */}\n          <div className=\"grid grid-cols-2 gap-3 sm:grid-cols-3 md:flex md:gap-3 pt-2\">\n            <Button\n              onClick={confirmQuestion}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Confirmar y guardar la pregunta', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Confirmar y guardar la pregunta', { force: true })}\n            >\n              {loading ? '‚è≥ Guardando‚Ä¶' : '‚úîÔ∏è Confirmar'}\n            </Button>\n            <Button\n              variant=\"secondary\"\n              onClick={resetForm}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Cargar otra imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Cargar otra imagen', { force: true })}\n            >\n              üì∑ Otra imagen\n            </Button>\n            {savedQuestions.length > 0 && (\n              <Button\n                variant=\"secondary\"\n                onClick={onCancel}\n                disabled={loading}\n                onFocus={() => isVoiceModeEnabled && speak('Finalizar y cerrar', { force: true })}\n                onMouseEnter={() => isVoiceModeEnabled && speak('Finalizar y cerrar', { force: true })}\n              >\n                ‚úì Finalizar\n              </Button>\n            )}\n            {savedQuestions.length === 0 && (\n              <Button\n                variant=\"secondary\"\n                onClick={onCancel}\n                disabled={loading}\n                onFocus={() => isVoiceModeEnabled && speak('Volver atr√°s', { force: true })}\n                onMouseEnter={() => isVoiceModeEnabled && speak('Volver atr√°s', { force: true })}\n              >\n                ‚Üê Atr√°s\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default OCRQuestionCapture;\n"],"names":["OCRQuestionCapture","topics","onQuestionExtracted","onCancel","isVoiceModeEnabled","speak","useVoice","user","useAuth","mode","setMode","useState","selectedTopic","setSelectedTopic","imageFile","setImageFile","imagePreview","setImagePreview","loading","setLoading","error","setError","successMessage","setSuccessMessage","processedQuestion","setProcessedQuestion","manualQuestion","setManualQuestion","correctAnswerIndex","setCorrectAnswerIndex","savedQuestions","setSavedQuestions","fileInputRef","useRef","apiBase","handleFileSelect","e","file","reader","processImage","base64Image","data","hasQuestion","detectedOptions","opt","err","confirmQuestion","pregunta","opciones","optionsArray","o","hasAtLeastTwoOptions","questionPayload","resetForm","useEffect","jsxs","jsx","Button","Alert","Spinner","t","prev","key","idx","optionText","isEmpty","selectedOption","selectedText"],"mappings":"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"}