import{a as se,u as ne,r as s,j as e}from"./index-BaYh_0Lp.js";import{B as h}from"./Button-CeP88Yp2.js";import{I as ee}from"./Input-B3ZbH6y3.js";import{A as V}from"./Alert-CT4I4Ncm.js";import{S as ie,L as pe}from"./LoadingOverlay-3aZpPDtu.js";import{a as me,b as ge}from"./api-DoyG0mL_.js";import{A as fe}from"./Skeleton-BxLw9cGR.js";import{m as oe}from"./socket-drVvRmjt.js";const xe=({topics:w,onQuestionCreated:O,onCancel:u})=>{const{isVoiceModeEnabled:r,speak:n}=se(),{user:M}=ne(),[g,j]=s.useState({question:"",options:["","","",""],correctIndex:0,selectedTopic:w[0]||""}),[q,z]=s.useState(""),[v,I]=s.useState(!1),[$,S]=s.useState(""),N=(t,m)=>{j(p=>({...p,options:p.options.map((f,b)=>b===t?m:f)}))},C=s.useCallback(()=>g.question.trim()?g.options.some(t=>!t.trim())?"Todas las opciones son requeridas":"":"La pregunta es requerida",[g]);s.useEffect(()=>{const t=C();z(t)},[g,M,C]);const D=async t=>{t.preventDefault();const m=C();if(m){z(m);return}I(!0),z(""),S("");try{const p={text:g.question,options:g.options,correctAnswerIndex:g.correctIndex,category:g.selectedTopic,explanation:""};if(S("Guardando..."),O){const f=await Promise.resolve(O(p)),b=f&&f.text?f.text:p.text;S(`Pregunta creada: "${b}"`)}else S("Â¡Pregunta preparada!")}catch(p){console.error("Error al preparar la pregunta:",p),z(p.message||"Error al guardar la pregunta")}finally{I(!1)}};return e.jsxs("form",{className:"grid gap-4",onSubmit:D,children:[r&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(h,{variant:"outline",size:"sm",type:"button",onClick:async()=>{const t=[];t.push("Formulario para escribir preguntas manualmente."),t.push("Campo Tema: selecciona el tema de la pregunta."),t.push("Campo Pregunta: escribe el texto de la pregunta."),t.push("Opciones: escribe las posibles respuestas. Marca cuÃ¡l es la correcta con el botÃ³n de opciÃ³n."),t.push("BotÃ³n AtrÃ¡s: vuelve al generador de preguntas."),t.push("BotÃ³n Guardar: guarda la pregunta actual."),await n(t.join(" "),{action:"page_guide",questionId:"manual_question_form",force:!0})},"aria-label":"Explicar la pÃ¡gina",children:"ðŸ›ˆ Explicar pÃ¡gina"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Escribe tu pregunta"}),q&&e.jsx(V,{intent:"error",children:q}),$&&e.jsx(V,{intent:"success",children:$}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",htmlFor:"topic-select",children:"Tema"}),e.jsx("select",{id:"topic-select",value:g.selectedTopic,onChange:t=>j(m=>({...m,selectedTopic:t.target.value})),disabled:v,className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:w.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",htmlFor:"question-input",children:"Pregunta"}),e.jsx(ee,{id:"question-input",type:"text",value:g.question,onChange:t=>j(m=>({...m,question:t.target.value})),disabled:v,required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Opciones"}),e.jsx("div",{className:"grid gap-3",children:g.options.map((t,m)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{type:"text",value:t,onChange:p=>N(m,p.target.value),disabled:v,required:!0,placeholder:`OpciÃ³n ${m+1}`,className:"flex-1"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"radio",name:"correctOption",checked:g.correctIndex===m,onChange:()=>j(p=>({...p,correctIndex:m})),disabled:v,className:"h-4 w-4"}),e.jsx("span",{children:"Correcta"})]})]},m))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:u,disabled:v,onFocus:()=>r&&n("AtrÃ¡s: vuelve al generador de preguntas.",{force:!0}),onMouseEnter:()=>r&&n("AtrÃ¡s: vuelve al generador de preguntas.",{force:!0}),children:"AtrÃ¡s"}),e.jsx(h,{type:"submit",disabled:v,onFocus:()=>r&&n("Guardar: guarda la pregunta actual.",{force:!0}),onMouseEnter:()=>r&&n("Guardar: guarda la pregunta actual.",{force:!0}),children:v?"Guardandoâ€¦":"Guardar"})]})]})},he=({topics:w,onQuestionExtracted:O,onCancel:u})=>{const{isVoiceModeEnabled:r,speak:n}=se(),{user:M}=ne(),[g,j]=s.useState(null),[q,z]=s.useState(w[0]||""),[v,I]=s.useState(null),[$,S]=s.useState(null),[N,C]=s.useState(!1),[D,t]=s.useState(""),[m,p]=s.useState(""),[f,b]=s.useState(null),[U,G]=s.useState({pregunta:"",opciones:{a:"",b:"",c:"",d:""}}),[B,_]=s.useState(0),[k,K]=s.useState([]),W=s.useRef(null),X="http://localhost:5000/api",ae=l=>{const d=l.target.files?.[0];if(!d)return;if(!["image/jpeg","image/png","image/jpg"].includes(d.type)){t("Por favor selecciona una imagen (PNG, JPG, JPEG)");return}if(d.size>10*1024*1024){t("La imagen es demasiado grande. MÃ¡ximo 10MB");return}I(d),t("");const i=new FileReader;i.onload=y=>{S(y.target.result)},i.readAsDataURL(d),r&&n(`Imagen seleccionada: ${d.name}. Presiona procesar para extraer la pregunta.`,{force:!0})},J=async()=>{if(!v){t("Por favor selecciona o captura una imagen");return}C(!0),t(""),p("");try{const l=new FileReader;l.onload=async d=>{const i=d.target.result;try{const o=await(await fetch(`${X}/ocr/process-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:i,mimeType:v.type||"image/jpeg",language:"es"})})).json();if(o.success){const A=o.pregunta&&!o.pregunta.includes("no detectada"),Q=Object.values(o.opciones||{}).filter(re=>re&&!re.includes("no detectada"));!A||Q.length===0?(b({pregunta:o.pregunta||"",opciones:o.opciones||{a:"",b:"",c:"",d:""}}),p("âš ï¸ DetecciÃ³n parcial. Por favor completa los campos vacÃ­os manualmente."),r&&n("ExtracciÃ³n parcial. Por favor completa la pregunta y las opciones manualmente.",{force:!0})):(b({pregunta:o.pregunta,opciones:o.opciones}),p("âœ… Pregunta extraÃ­da correctamente"),r&&n(`Pregunta detectada: ${o.pregunta}`,{force:!0}))}else t(o.error||"Error procesando la imagen")}catch(y){t(`Error al procesar la imagen: ${y.message}`)}finally{C(!1)}},l.readAsDataURL(v)}catch(l){t(`Error: ${l.message}`),C(!1)}},Y=async()=>{const l=f.pregunta?.trim(),d=f.opciones,i=[d.a?.trim()||"",d.b?.trim()||"",d.c?.trim()||"",d.d?.trim()||""].filter(A=>A),y=i.length>=2;if(!l){t("Por favor escribe la pregunta");return}if(!y){t("Por favor completa al menos 2 opciones de respuesta");return}if(!q){t("Por favor selecciona un tema");return}if(B<0||B>=i.length){t("Por favor selecciona cuÃ¡l opciÃ³n es correcta");return}C(!0),t("");const o={text:l,options:i,correctAnswerIndex:B,category:q,explanation:""};try{O&&(await O(o),p("âœ… Pregunta guardada exitosamente"),K([...k,o]),setTimeout(()=>{I(null),S(null),b(null),j(null),_(0),p("")},2e3))}catch(A){t(`Error al guardar la pregunta: ${A.message}`)}finally{C(!1)}},te=()=>{I(null),S(null),b(null),j(null),_(0),stopCamera(),t(""),p("")};return r&&!g&&!v&&s.useEffect(()=>{n("Formulario de captura de pregunta. Selecciona una imagen o toma una foto.",{force:!0})},[]),e.jsxs("div",{className:"grid gap-4 p-4",children:[r&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(h,{variant:"outline",size:"sm",type:"button",onClick:async()=>{await n("Captura de pregunta. Puedes subir una imagen o tomar una foto desde la cÃ¡mara. La aplicaciÃ³n extraerÃ¡ automÃ¡ticamente el texto y las opciones.",{force:!0})},"aria-label":"Explicar la pÃ¡gina",children:"ðŸ›ˆ Explicar pÃ¡gina"})}),D&&e.jsx(V,{intent:"error",children:D}),m&&e.jsx(V,{intent:"success",children:m}),k.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-white",children:["âœ… ",k.length," pregunta",k.length!==1?"s":""," guardada",k.length!==1?"s":""]}),e.jsx(h,{variant:"outline",size:"sm",onClick:u,className:"text-xs",children:"Finalizar"})]}),!g&&!v&&!f&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Crear pregunta"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsx(h,{onClick:()=>j("upload"),size:"lg",onFocus:()=>r&&n("Subir imagen",{force:!0}),onMouseEnter:()=>r&&n("Subir imagen",{force:!0}),children:"ðŸ“± Subir imagen"})})]}),g==="upload"&&!f&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Subir imagen"}),e.jsx("input",{ref:W,type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:ae,className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white"})]}),v&&!f&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Vista previa"}),$&&e.jsx("img",{src:$,alt:"Preview",className:"w-full max-h-96 rounded-xl object-contain border-2 border-white/10"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{onClick:J,disabled:N,size:"lg",onFocus:()=>r&&n("Procesar imagen",{force:!0}),onMouseEnter:()=>r&&n("Procesar imagen",{force:!0}),children:N?e.jsx(ie,{size:"sm"}):"âš¡ Procesar"}),e.jsx(h,{variant:"secondary",onClick:te,disabled:N,onFocus:()=>r&&n("Seleccionar otra imagen",{force:!0}),onMouseEnter:()=>r&&n("Seleccionar otra imagen",{force:!0}),children:"Cambiar imagen"})]})]}),f&&e.jsxs("div",{className:"grid gap-4 p-4 bg-white/5 rounded-xl border-2 border-bb-primary/30",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Pregunta extraÃ­da"}),!f.pregunta||f.pregunta.includes("Pregunta no detectada")?e.jsx("div",{className:"p-3 bg-orange-500/10 border border-orange-400/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-300",children:["âš ï¸ ",e.jsx("strong",{children:"Importante:"})," OCR no detectÃ³ la pregunta correctamente. Por favor completa los campos manualmente."]})}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Tema"}),e.jsx("select",{value:q,onChange:l=>z(l.target.value),className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:w.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Pregunta *"}),e.jsx("textarea",{defaultValue:f.pregunta||"",placeholder:"Escribe la pregunta aquÃ­...",className:"p-3 rounded-xl bg-white/5 border border-white/10 text-white break-words focus:outline-none focus:ring-2 focus:ring-bb-primary/30 focus:border-bb-primary resize-none",rows:"3",onChange:l=>{b(d=>({...d,pregunta:l.target.value}))}})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Opciones de respuesta *"}),e.jsx("p",{className:"text-xs text-white/60",children:"Al menos 2 opciones son requeridas"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((l,d)=>{const i=f.opciones[l],y=!i||i.trim()===""||i.includes("no detectada");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-bold text-bb-primary min-w-[2rem]",children:[l.toUpperCase(),")"]}),e.jsx("input",{type:"text",defaultValue:i&&!i.includes("no detectada")?i:"",placeholder:`OpciÃ³n ${l.toUpperCase()} (opcional)`,className:`p-2 rounded-lg bg-white/5 border text-white flex-1 break-words focus:outline-none focus:ring-2 ${y?"border-orange-400/50 focus:ring-orange-400/30":"border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary"}`,onChange:o=>{b(A=>({...A,opciones:{...A.opciones,[l]:o.target.value}}))}})]},l)})}),e.jsx("p",{className:"text-xs text-orange-300",children:"âš ï¸ Los campos en naranja no fueron detectados. EdÃ­talos manualmente."})]}),e.jsxs("div",{className:"grid gap-3 p-3 bg-bb-primary/10 rounded-lg border border-bb-primary/30",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"Â¿CuÃ¡l es la respuesta correcta? *"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((l,d)=>{const i=f.opciones[l],y=!i||i.trim()===""||i.includes("no detectada");return y?null:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"correctOption",checked:B===d,onChange:()=>_(d),disabled:N||y,className:"h-4 w-4 cursor-pointer"}),e.jsxs("span",{className:"text-sm",children:[e.jsxs("strong",{children:[l.toUpperCase(),")"]})," ",i]}),B===d&&e.jsx("span",{className:"ml-auto text-bb-primary font-bold",children:"âœ“ Correcta"})]},l)})})]}),e.jsx("p",{className:"text-sm text-white/60",children:"â„¹ï¸ Puedes editar la pregunta manualmente. Es importante que completes todos los campos correctamente."}),k.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40",children:[e.jsxs("p",{className:"text-sm font-semibold text-white mb-2",children:["âœ… ",k.length," pregunta",k.length!==1?"s":""," guardada",k.length!==1?"s":""," - Puedes guardar esta y agregar mÃ¡s"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"text-xs text-bb-primary/80",children:"ðŸ’¡ Confirma y luego agrega otra"})})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{onClick:Y,size:"lg",disabled:N,onFocus:()=>r&&n("Confirmar y guardar",{force:!0}),onMouseEnter:()=>r&&n("Confirmar y guardar",{force:!0}),children:N?"â³ Guardandoâ€¦":"âœ“ Confirmar"}),e.jsx(h,{variant:"secondary",onClick:te,disabled:N,onFocus:()=>r&&n("Capturar otra imagen",{force:!0}),onMouseEnter:()=>r&&n("Capturar otra imagen",{force:!0}),children:"ðŸ“· Otra imagen"}),e.jsx(h,{variant:"secondary",onClick:u,disabled:N,onFocus:()=>r&&n("AtrÃ¡s",{force:!0}),onMouseEnter:()=>r&&n("AtrÃ¡s",{force:!0}),children:"AtrÃ¡s"})]})})]})]})};function be({open:w,title:O,onClose:u,children:r,className:n=""}){return s.useEffect(()=>{const M=j=>{j.key==="Escape"&&u?.()};w&&document.addEventListener("keydown",M);const g=document.body.style.overflow;return w&&(document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",M),document.body.style.overflow=g}},[w,u]),e.jsx(fe,{children:w&&e.jsxs(oe.div,{className:"fixed inset-0 z-[3000] flex items-center justify-center px-4 py-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{"aria-label":"Cerrar",className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:u}),e.jsxs(oe.div,{role:"dialog","aria-modal":"true",className:`relative w-full max-w-2xl max-h-[85vh] overflow-auto rounded-2xl border border-white/10 bg-bb-bg-primary/90 shadow-xl ${n}`,initial:{scale:.98,y:10,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.98,y:10,opacity:0},transition:{type:"spring",stiffness:200,damping:22},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-start justify-between gap-4 px-6 py-5 border-b border-white/10 bg-bb-bg-primary/90",children:[O?e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:O}):e.jsx("span",{className:"sr-only",children:"Modal"}),e.jsx("button",{onClick:u,className:"rounded-md p-2 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bb-primary","aria-label":"Cerrar",children:"âœ•"})]}),e.jsx("div",{className:"px-6 py-5",children:r})]})]})})}const ke=({onQuestionsGenerated:w,onClose:O})=>{const{isVoiceModeEnabled:u,speak:r}=se(),{user:n}=ne(),[M,g]=s.useState([]),[j,q]=s.useState(""),[z,v]=s.useState("medium"),[I,$]=s.useState(null),[S,N]=s.useState(""),[C,D]=s.useState(!1),[t,m]=s.useState(!1),[p,f]=s.useState(!1),[b,U]=s.useState(null),[G,B]=s.useState(""),[_,k]=s.useState(0),[K,W]=s.useState([]),[X,ae]=s.useState(""),[J,Y]=s.useState([]),[te,l]=s.useState(""),[d,i]=s.useState(!1),[y,o]=s.useState(""),[A,Q]=s.useState(""),[re,le]=s.useState([]);s.useEffect(()=>{ce(),ue()},[]),s.useEffect(()=>{N(typeof I=="number"?String(I):"")},[I]),s.useEffect(()=>{B(typeof b=="number"?String(b):"")},[b]);const ce=async()=>{try{const a=await me();g(a),a.length>0&&q(a[0])}catch{o("Error obteniendo temas. Por favor intenta de nuevo.")}},ue=async()=>{try{const a=await ge();le(a)}catch{o("No se pudieron cargar los niveles de dificultad. Por favor, intenta de nuevo mÃ¡s tarde.")}},de=async()=>{if(!j){o("Por favor selecciona un tema vÃ¡lido");return}i(!0),o("");try{const a="http://localhost:5000/api",c=n&&n.getIdToken?await n.getIdToken():null,F=await(await fetch(`${a}/ai/generate-questions`,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({topic:j,difficulty:z,count:I,useAI:C})})).json();if(F.success){const H=F.questions.map(x=>({...(()=>{if(!Array.isArray(x.options)||typeof x.correctAnswerIndex!="number")return x;const P=x.options.map((E,Z)=>({opt:E,origIdx:Z}));for(let E=P.length-1;E>0;E--){const Z=Math.floor(Math.random()*(E+1));[P[E],P[Z]]=[P[Z],P[E]]}const R=P.findIndex(E=>E.origIdx===x.correctAnswerIndex);return{...x,options:P.map(E=>E.opt),correctAnswerIndex:R}})(),createdBy:n?.uid||"anon",createdAt:Date.now(),category:j,difficulty:z}));let L=!1;try{const x=n&&n.getIdToken?await n.getIdToken():null,R=await(await fetch(`${a}/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",...x?{Authorization:`Bearer ${x}`}:{}},body:JSON.stringify({questions:H})})).json();R.success?L=!0:(o(E=>(E?E+" | ":"")+(R.error||"Error guardando preguntas en Firestore")),o("No se pudieron guardar las preguntas. "+(R.error||"Por favor, intenta de nuevo.")))}catch{o("OcurriÃ³ un error al guardar las preguntas. Por favor, verifica tu conexiÃ³n e intenta de nuevo.")}if(!L){i(!1);return}w(F.questions),i(!1)}else o(F.error||"Error generando preguntas"),o("No se pudieron generar las preguntas: "+(F.error||"Por favor, intenta de nuevo."))}catch{o("Error de conexiÃ³n. Por favor, verifica tu conexiÃ³n a internet e intenta nuevamente.")}finally{i(!1)}};return e.jsxs(be,{open:!0,title:"ðŸ¤– Generador de Preguntas",onClose:O,children:[u&&!t&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(h,{variant:"outline",size:"sm",type:"button",onClick:async()=>{const a=[];!t&&!C?(a.push("EstÃ¡s en el generador de preguntas."),a.push("BotÃ³n Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial."),a.push("BotÃ³n Escribir preguntas: te permite escribir preguntas manualmente."),a.push("Selecciona una opciÃ³n para continuar.")):C&&!t&&(a.push("Formulario para generar preguntas con inteligencia artificial."),a.push("Campo Tema: selecciona el tema de las preguntas."),a.push("Campo Dificultad: elige la dificultad."),a.push("Campo Cantidad: indica cuÃ¡ntas preguntas quieres generar."),a.push("BotÃ³n Crear preguntas: genera las preguntas."),a.push("BotÃ³n AtrÃ¡s: vuelve a la pantalla anterior.")),await r(a.join(" "),{action:"page_guide",questionId:"ai_question_generator",force:!0})},"aria-label":"Explicar la pÃ¡gina",onFocus:()=>r("Explicar pÃ¡gina: describe la funciÃ³n de cada botÃ³n y campo en esta vista.",{force:!0}),onMouseEnter:()=>r("Explicar pÃ¡gina: describe la funciÃ³n de cada botÃ³n y campo en esta vista.",{force:!0}),children:"ðŸ›ˆ Explicar pÃ¡gina"})}),d&&e.jsx(pe,{text:"Generandoâ€¦",mobileOnly:!0}),y&&e.jsx(V,{intent:"error",children:y}),A&&e.jsx(V,{intent:"success",children:A}),!t&&!C&&!p&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(h,{onClick:()=>D(!0),size:"lg",onFocus:()=>u&&r("Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial.",{force:!0}),onMouseEnter:()=>u&&r("Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial.",{force:!0}),children:"ðŸ¤– Crear con IA"}),e.jsx(h,{variant:"secondary",size:"lg",onClick:()=>{m(!0),D(!1),k(0),W([])},onFocus:()=>u&&r("Escribir preguntas: te permite escribir preguntas manualmente.",{force:!0}),onMouseEnter:()=>u&&r("Escribir preguntas: te permite escribir preguntas manualmente.",{force:!0}),children:"âœï¸ Escribir preguntas"}),e.jsx(h,{variant:"secondary",size:"lg",onClick:()=>{f(!0),D(!1)},onFocus:()=>u&&r("Capturar pregunta: extrae preguntas de imÃ¡genes usando OCR.",{force:!0}),onMouseEnter:()=>u&&r("Capturar pregunta: extrae preguntas de imÃ¡genes usando OCR.",{force:!0}),children:"ðŸ“¸ Capturar pregunta"})]}),!t&&C&&!p&&e.jsxs("form",{className:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4",onSubmit:async a=>{a.preventDefault(),i(!0),o("");try{await de(),o("")}catch{o("Error al generar preguntas. Por favor, intÃ©ntalo de nuevo.")}finally{i(!1)}},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"topic",className:"block mb-1 text-sm text-white/80",children:"Tema"}),e.jsx("select",{id:"topic",className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",value:j,onChange:a=>q(a.target.value),disabled:M.length===0,children:M.length===0?e.jsx("option",{value:"",children:"No hay temas"}):M.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"difficulty",className:"block mb-1 text-sm text-white/80",children:"Dificultad"}),e.jsxs("select",{id:"difficulty",className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",value:z,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"easy",children:"FÃ¡cil"}),e.jsx("option",{value:"medium",children:"Media"}),e.jsx("option",{value:"hard",children:"DifÃ­cil"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"numQuestions",className:"block mb-1 text-sm text-white/80",children:"Cantidad"}),e.jsxs("div",{children:[e.jsx(ee,{id:"numQuestions",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:S,onChange:a=>{const c=a.target.value.replace(/\D+/g,"");N(c);const T=c?parseInt(c,10):NaN;Number.isNaN(T)?$(null):$(T)},onBlur:()=>{const a=parseInt(S||"",10);if(Number.isNaN(a)||a<1){$(null),N("");return}const c=Math.max(1,a);$(c),N(String(c))},required:!0,placeholder:"Cantidad",className:"w-28 text-center"}),(S===""||I===null)&&e.jsx("div",{className:`mt-1 text-xs ${S===""?"text-white/60":"text-red-300"}`,children:S===""?"Ingresa un nÃºmero (>= 1)":"Valor invÃ¡lido"})]})]}),y&&e.jsx(V,{intent:"error",className:"sm:col-span-3",children:y}),e.jsxs("div",{className:"sm:col-span-3 mt-2 flex flex-wrap gap-3 justify-end items-center",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:()=>D(!1),disabled:d,onFocus:()=>u&&r("AtrÃ¡s: vuelve a la pantalla anterior.",{force:!0}),onMouseEnter:()=>u&&r("AtrÃ¡s: vuelve a la pantalla anterior.",{force:!0}),children:"AtrÃ¡s"}),e.jsx(h,{type:"submit",disabled:d,onFocus:()=>u&&r("Crear preguntas: genera las preguntas con inteligencia artificial.",{force:!0}),onMouseEnter:()=>u&&r("Crear preguntas: genera las preguntas con inteligencia artificial.",{force:!0}),children:d?e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:16,className:"mr-2"}),"Creandoâ€¦"]}):"Crear preguntas"})]})]}),t&&e.jsx("div",{className:"mt-2",children:_===0?e.jsxs("form",{className:"grid grid-cols-1 gap-4",onSubmit:a=>{a.preventDefault(),k(1),W([]),ae(j)},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",children:"Tema"}),e.jsx("select",{value:j,onChange:a=>q(a.target.value),className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:M.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",children:"Â¿CuÃ¡ntas preguntas?"}),e.jsxs("div",{children:[e.jsx(ee,{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:G,onChange:a=>{const c=a.target.value.replace(/\D+/g,"");B(c);const T=c?parseInt(c,10):NaN;Number.isNaN(T)?U(null):U(T)},onBlur:()=>{const a=parseInt(G||"",10);if(Number.isNaN(a)||a<1){U(null),B("");return}const c=Math.max(1,a);U(c),B(String(c))},required:!0,placeholder:"Cantidad",className:"w-28 text-center"}),(G===""||b===null)&&e.jsx("div",{className:`mt-1 text-xs ${G===""?"text-white/60":"text-red-300"}`,children:G===""?"Ingresa un nÃºmero (>= 1)":"Valor invÃ¡lido"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:()=>m(!1),onFocus:()=>u&&r("Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.",{force:!0}),onMouseEnter:()=>u&&r("Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.",{force:!0}),children:"Volver"}),e.jsx(h,{type:"submit",onFocus:()=>u&&r("Empezar: inicia la creaciÃ³n manual de preguntas.",{force:!0}),onMouseEnter:()=>u&&r("Empezar: inicia la creaciÃ³n manual de preguntas.",{force:!0}),children:"Empezar"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-3 font-bold",children:["Â¡Vamos! Pregunta ",K.length+1," de ",b]}),e.jsx(xe,{topics:[X],onQuestionCreated:async a=>{try{i(!0),o("");const c="http://localhost:5000/api";if(!n||!n.getIdToken)throw new Error("Debes iniciar sesiÃ³n para crear preguntas");const T=await n.getIdToken(),F=await fetch(`${c}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify(a)}),H=await F.json();if(!F.ok)throw new Error(H.error||"Error al guardar la pregunta");const L=H.question||{...a},x=[...K,{...L,category:X}];if(x.length===b){const P=await fetch(`${c}/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify({questions:x})}),R=await P.json();if(!P.ok)throw new Error(R.error||"Error al guardar las preguntas en lote");return w&&w(x),Q("Â¡Todas las preguntas han sido guardadas exitosamente!"),setTimeout(()=>{m(!1),Q("")},1500),x}else return W(x),k(P=>P+1),Q(`Â¡Pregunta ${x.length} de ${b} guardada exitosamente!`),setTimeout(()=>Q(""),1500),L}catch(c){o("No se pudo guardar la pregunta: "+(c.message||"Por favor, intenta de nuevo."))}finally{i(!1)}},onCancel:()=>{m(!1)}})]})}),p&&e.jsx(he,{topics:M,onQuestionExtracted:async a=>{i(!0),o("");try{const c="http://localhost:5000/api",T=n&&n.getIdToken?await n.getIdToken():null,F=await fetch(`${c}/questions`,{method:"POST",headers:{"Content-Type":"application/json",...T?{Authorization:`Bearer ${T}`}:{}},body:JSON.stringify(a)});if(F.ok){const L=(await F.json()).question||{...a},x=[...J,L];Y(x),Q(`âœ… Pregunta ${x.length} guardada exitosamente. Puedes agregar mÃ¡s o finalizar.`),i(!1)}else o("No se pudo guardar la pregunta"),i(!1)}catch(c){o("Error al guardar la pregunta: "+(c.message||"Por favor, intenta de nuevo.")),i(!1)}},onCancel:()=>{f(!1),J.length>0&&(Q(`âœ… Se guardaron ${J.length} pregunta(s) de OCR`),setTimeout(()=>{w(J),Y([]),Q("")},1500))}})]})};export{ke as default};
//# sourceMappingURL=AIQuestionGenerator-C1ba-6BE.js.map
