{"version":3,"file":"AIQuestionGenerator-BZ2TyaCn.js","sources":["../../src/components/ManualQuestionForm.jsx","../../src/components/OCRQuestionCapture.jsx","../../src/components/ui/Modal.jsx","../../src/components/AIQuestionGenerator.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\n\nconst ManualQuestionForm = ({ topics, onQuestionCreated, onCancel }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [formData, setFormData] = useState({\n    question: '',\n    options: ['', '', '', ''],\n    correctIndex: 0,\n    selectedTopic: topics[0] || ''\n  });\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n\n  const handleOptionChange = (idx, value) => {\n    setFormData(prev => ({\n      ...prev,\n      options: prev.options.map((opt, i) => i === idx ? value : opt)\n    }));\n  };\n\n  const validateForm = useCallback(() => {\n    if (!formData.question.trim()) {\n      return 'La pregunta es requerida';\n    }\n    if (formData.options.some(opt => !opt.trim())) {\n      return 'Todas las opciones son requeridas';\n    }\n    return '';\n  }, [formData]);\n\n  useEffect(() => {\n    const validationError = validateForm();\n    setError(validationError);\n  }, [formData, user, validateForm]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    const validationError = validateForm();\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSuccessMessage('');\n    try {\n      // Build payload and hand off to parent for saving. Parent will perform the network request.\n      const payload = {\n        text: formData.question,\n        options: formData.options,\n        correctAnswerIndex: formData.correctIndex,\n        category: formData.selectedTopic,\n        explanation: ''\n      };\n\n      setSuccessMessage('Guardando...');\n      if (onQuestionCreated) {\n        const result = await Promise.resolve(onQuestionCreated(payload));\n        // If parent returns the saved question, show its text in the success message\n        const savedText = result && result.text ? result.text : payload.text;\n        setSuccessMessage(`Pregunta creada: \"${savedText}\"`);\n      } else {\n        setSuccessMessage('¬°Pregunta preparada!');\n      }\n    } catch (err) {\n      console.error('Error al preparar la pregunta:', err);\n      setError(err.message || 'Error al guardar la pregunta');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n  <form className=\"grid gap-4\" onSubmit={handleSubmit}>\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              const parts = [];\n              parts.push('Formulario para escribir preguntas manualmente.');\n              parts.push('Campo Tema: selecciona el tema de la pregunta.');\n              parts.push('Campo Pregunta: escribe el texto de la pregunta.');\n              parts.push('Opciones: escribe las posibles respuestas. Marca cu√°l es la correcta con el bot√≥n de opci√≥n.');\n              parts.push('Bot√≥n Atr√°s: vuelve al generador de preguntas.');\n              parts.push('Bot√≥n Guardar: guarda la pregunta actual.');\n              await speak(parts.join(' '), { action: 'page_guide', questionId: 'manual_question_form', force: true });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n      <h3 className=\"text-xl font-bold\">Escribe tu pregunta</h3>\n\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n      <div className=\"grid gap-2\">\n        <label className=\"text-sm text-white/80\" htmlFor=\"topic-select\">Tema</label>\n        <select\n          id=\"topic-select\"\n          value={formData.selectedTopic}\n          onChange={e => setFormData(prev => ({ ...prev, selectedTopic: e.target.value }))}\n          disabled={loading}\n          className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n        >\n          {topics.map(t => <option key={t} value={t}>{t}</option>)}\n        </select>\n      </div>\n\n      <div className=\"grid gap-2\">\n        <label className=\"text-sm text-white/80\" htmlFor=\"question-input\">Pregunta</label>\n        <Input\n          id=\"question-input\"\n          type=\"text\"\n          value={formData.question}\n          onChange={e => setFormData(prev => ({ ...prev, question: e.target.value }))}\n          disabled={loading}\n          required\n        />\n      </div>\n\n      <div className=\"grid gap-3\">\n        <label className=\"text-sm text-white/80\">Opciones</label>\n        <div className=\"grid gap-3\">\n          {formData.options.map((opt, idx) => (\n            <div key={idx} className=\"flex items-center gap-3\">\n              <Input\n                type=\"text\"\n                value={opt}\n                onChange={e => handleOptionChange(idx, e.target.value)}\n                disabled={loading}\n                required\n                placeholder={`Opci√≥n ${idx + 1}`}\n                className=\"flex-1\"\n              />\n              <label className=\"inline-flex items-center gap-2 text-sm\">\n                <input\n                  type=\"radio\"\n                  name=\"correctOption\"\n                  checked={formData.correctIndex === idx}\n                  onChange={() => setFormData(prev => ({ ...prev, correctIndex: idx }))}\n                  disabled={loading}\n                  className=\"h-4 w-4\"\n                />\n                <span>Correcta</span>\n              </label>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3\">\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          onClick={onCancel}\n          disabled={loading}\n          onFocus={() => isVoiceModeEnabled && speak('Atr√°s: vuelve al generador de preguntas.', { force: true })}\n          onMouseEnter={() => isVoiceModeEnabled && speak('Atr√°s: vuelve al generador de preguntas.', { force: true })}\n        >\n          Atr√°s\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={loading}\n          onFocus={() => isVoiceModeEnabled && speak('Guardar: guarda la pregunta actual.', { force: true })}\n          onMouseEnter={() => isVoiceModeEnabled && speak('Guardar: guarda la pregunta actual.', { force: true })}\n        >\n          {loading ? 'Guardando‚Ä¶' : 'Guardar'}\n        </Button>\n      </div>\n    </form>\n  );\n};\n\nexport default ManualQuestionForm;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\nimport Spinner from './ui/Spinner';\n\nconst OCRQuestionCapture = ({ topics, onQuestionExtracted, onCancel }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [mode, setMode] = useState(null); // 'upload' or 'manual'\n  const [selectedTopic, setSelectedTopic] = useState(topics[0] || '');\n  const [imageFile, setImageFile] = useState(null);\n  const [imagePreview, setImagePreview] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const [processedQuestion, setProcessedQuestion] = useState(null);\n  const [manualQuestion, setManualQuestion] = useState({ pregunta: '', opciones: { a: '', b: '', c: '', d: '' } });\n  const [correctAnswerIndex, setCorrectAnswerIndex] = useState(0); // Track which option is correct\n  const [savedQuestions, setSavedQuestions] = useState([]); // Track saved questions\n  const fileInputRef = useRef(null);\n\n  const apiBase = import.meta.env.VITE_API_URL;\n\n  /**\n   * Handle file selection from input\n   */\n  const handleFileSelect = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!['image/jpeg', 'image/png', 'image/jpg'].includes(file.type)) {\n      setError('Por favor selecciona una imagen (PNG, JPG, JPEG)');\n      return;\n    }\n\n    // Validate file size (max 10MB for OCR)\n    if (file.size > 10 * 1024 * 1024) {\n      setError('La imagen es demasiado grande. M√°ximo 10MB');\n      return;\n    }\n\n    setImageFile(file);\n    setError('');\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      setImagePreview(e.target.result);\n    };\n    reader.readAsDataURL(file);\n\n    // Announce to voice\n    if (isVoiceModeEnabled) {\n      speak(`Imagen seleccionada: ${file.name}. Presiona procesar para extraer la pregunta.`, { force: true });\n    }\n  };\n\n\n\n  /**\n   * Process image using OCR\n   */\n  const processImage = async () => {\n    if (!imageFile) {\n      setError('Por favor selecciona o captura una imagen');\n      return;\n    }\n\n    if (!apiBase) {\n      setError('Error de configuraci√≥n: URL del API no definida');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSuccessMessage('');\n\n    try {\n      // Convert file to base64\n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        const base64Image = e.target.result;\n\n        try {\n          const response = await fetch(`${apiBase}/ocr/process-image`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              imageBase64: base64Image,\n              mimeType: imageFile.type || 'image/jpeg',\n              language: 'es'\n            })\n          });\n\n          const data = await response.json();\n\n          if (data.success) {\n            // Check if OCR detection was successful or partial\n            const hasQuestion = data.pregunta && !data.pregunta.includes('no detectada');\n            const detectedOptions = Object.values(data.opciones || {}).filter(opt => opt && !opt.includes('no detectada'));\n            \n            if (!hasQuestion || detectedOptions.length === 0) {\n              // Partial detection - show warning but allow manual completion\n              setProcessedQuestion({\n                pregunta: data.pregunta || '',\n                opciones: data.opciones || { a: '', b: '', c: '', d: '' }\n              });\n              setSuccessMessage('‚ö†Ô∏è Detecci√≥n parcial. Por favor completa los campos vac√≠os manualmente.');\n              \n              if (isVoiceModeEnabled) {\n                speak('Extracci√≥n parcial. Por favor completa la pregunta y las opciones manualmente.', { force: true });\n              }\n            } else {\n              // Full or mostly successful detection\n              setProcessedQuestion({\n                pregunta: data.pregunta,\n                opciones: data.opciones\n              });\n              setSuccessMessage('‚úÖ Pregunta extra√≠da correctamente');\n\n              if (isVoiceModeEnabled) {\n                speak(`Pregunta detectada: ${data.pregunta}`, { force: true });\n              }\n            }\n          } else {\n            setError(data.error || 'Error procesando la imagen');\n          }\n        } catch (err) {\n          setError(`Error al procesar la imagen: ${err.message}`);\n        } finally {\n          setLoading(false);\n        }\n      };\n\n      reader.readAsDataURL(imageFile);\n    } catch (err) {\n      setError(`Error: ${err.message}`);\n      setLoading(false);\n    }\n  };\n\n  /**\n   * Confirm and submit the extracted question\n   */\n  const confirmQuestion = async () => {\n    // Validation: check if we have a pregunta and at least 2 options\n    const pregunta = processedQuestion.pregunta?.trim();\n    const opciones = processedQuestion.opciones;\n    const optionsArray = [\n      opciones.a?.trim() || '',\n      opciones.b?.trim() || '',\n      opciones.c?.trim() || '',\n      opciones.d?.trim() || ''\n    ].filter(o => o);\n    \n    const hasAtLeastTwoOptions = optionsArray.length >= 2;\n\n    if (!pregunta) {\n      setError('Por favor escribe la pregunta');\n      return;\n    }\n\n    if (!hasAtLeastTwoOptions) {\n      setError('Por favor completa al menos 2 opciones de respuesta');\n      return;\n    }\n\n    if (!selectedTopic) {\n      setError('Por favor selecciona un tema');\n      return;\n    }\n\n    // Validate that correctAnswerIndex is within bounds\n    if (correctAnswerIndex < 0 || correctAnswerIndex >= optionsArray.length) {\n      setError('Por favor selecciona cu√°l opci√≥n es correcta');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    // Create question payload\n    const questionPayload = {\n      text: pregunta,\n      options: optionsArray,\n      correctAnswerIndex: correctAnswerIndex,\n      category: selectedTopic,\n      explanation: ''\n    };\n\n    try {\n      if (onQuestionExtracted) {\n        // Wait for the callback to complete\n        await onQuestionExtracted(questionPayload);\n        \n        // Show success message\n        setSuccessMessage('‚úÖ Pregunta guardada exitosamente');\n        \n        // Add to local saved questions list\n        setSavedQuestions([...savedQuestions, questionPayload]);\n        \n        // Reset form after a short delay to show the success message\n        // Mantener modal abierto para agregar m√°s preguntas\n        setTimeout(() => {\n          setImageFile(null);\n          setImagePreview(null);\n          setProcessedQuestion(null);\n          setMode(null);\n          setCorrectAnswerIndex(0);\n          setSuccessMessage('');\n        }, 2000);\n      }\n    } catch (err) {\n      setError(`Error al guardar la pregunta: ${err.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /**\n   * Reset form\n   */\n  const resetForm = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    setProcessedQuestion(null);\n    setMode(null);\n    setCorrectAnswerIndex(0);\n    stopCamera();\n    setError('');\n    setSuccessMessage('');\n  };\n\n  if (isVoiceModeEnabled && !mode && !imageFile) {\n    useEffect(() => {\n      speak('Formulario de captura de pregunta. Selecciona una imagen o toma una foto.', { force: true });\n    }, []);\n  }\n\n  return (\n    <div className=\"grid gap-4 p-4\">\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              await speak('Captura de pregunta. Puedes subir una imagen o tomar una foto desde la c√°mara. La aplicaci√≥n extraer√° autom√°ticamente el texto y las opciones.', {\n                force: true\n              });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n      \n      {/* Show counter of saved questions */}\n      {savedQuestions.length > 0 && (\n        <div className=\"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40 flex items-center justify-between\">\n          <span className=\"text-sm font-semibold text-white\">\n            ‚úÖ {savedQuestions.length} pregunta{savedQuestions.length !== 1 ? 's' : ''} guardada{savedQuestions.length !== 1 ? 's' : ''}\n          </span>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={onCancel}\n            className=\"text-xs\"\n          >\n            Finalizar\n          </Button>\n        </div>\n      )}\n\n      {/* Mode selection */}\n      {!mode && !imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Crear pregunta</h3>\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <Button\n              onClick={() => setMode('upload')}\n              size=\"lg\"\n              onFocus={() => isVoiceModeEnabled && speak('Subir imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Subir imagen', { force: true })}\n            >\n              üì± Subir imagen\n            </Button>\n            <Button\n              variant=\"secondary\"\n              size=\"lg\"\n              onClick={() => {\n                setMode('manual');\n                setProcessedQuestion({ pregunta: '', opciones: { a: '', b: '', c: '', d: '' } });\n              }}\n              onFocus={() => isVoiceModeEnabled && speak('Escribir manualmente', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Escribir manualmente', { force: true })}\n            >\n              ‚úèÔ∏è Escribir\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Upload mode */}\n      {mode === 'upload' && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Subir imagen</h3>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/jpeg,image/png,image/jpg\"\n            onChange={handleFileSelect}\n            className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white\"\n          />\n        </div>\n      )}\n\n      {/* Image preview and processing */}\n      {imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Vista previa</h3>\n          {imagePreview && (\n            <img\n              src={imagePreview}\n              alt=\"Preview\"\n              className=\"w-full max-h-96 rounded-xl object-contain border-2 border-white/10\"\n            />\n          )}\n          <div className=\"flex gap-3\">\n            <Button\n              onClick={processImage}\n              disabled={loading}\n              size=\"lg\"\n              onFocus={() => isVoiceModeEnabled && speak('Procesar imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Procesar imagen', { force: true })}\n            >\n              {loading ? <Spinner size=\"sm\" /> : '‚ö° Procesar'}\n            </Button>\n            <Button\n              variant=\"secondary\"\n              onClick={resetForm}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Seleccionar otra imagen', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Seleccionar otra imagen', { force: true })}\n            >\n              Cambiar imagen\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Processed question display and confirmation */}\n      {processedQuestion && (\n        <div className=\"grid gap-4 p-4 bg-white/5 rounded-xl border-2 border-bb-primary/30\">\n          <h3 className=\"text-lg font-bold\">Pregunta extra√≠da</h3>\n\n          {!processedQuestion.pregunta || processedQuestion.pregunta.includes('Pregunta no detectada') ? (\n            <div className=\"p-3 bg-orange-500/10 border border-orange-400/30 rounded-lg\">\n              <p className=\"text-sm text-orange-300\">‚ö†Ô∏è <strong>Importante:</strong> OCR no detect√≥ la pregunta correctamente. Por favor completa los campos manualmente.</p>\n            </div>\n          ) : null}\n\n          <div className=\"grid gap-2\">\n            <label className=\"text-sm text-white/80\">Tema</label>\n            <select\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n            >\n              {topics.map(t => (\n                <option key={t} value={t}>{t}</option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"grid gap-2\">\n            <label className=\"text-sm text-white/80\">Pregunta *</label>\n            <textarea\n              defaultValue={processedQuestion.pregunta || ''}\n              placeholder=\"Escribe la pregunta aqu√≠...\"\n              className=\"p-3 rounded-xl bg-white/5 border border-white/10 text-white break-words focus:outline-none focus:ring-2 focus:ring-bb-primary/30 focus:border-bb-primary resize-none\"\n              rows=\"3\"\n              onChange={(e) => {\n                setProcessedQuestion(prev => ({\n                  ...prev,\n                  pregunta: e.target.value\n                }));\n              }}\n            />\n          </div>\n\n          <div className=\"grid gap-3\">\n            <label className=\"text-sm text-white/80\">Opciones de respuesta *</label>\n            <p className=\"text-xs text-white/60\">Al menos 2 opciones son requeridas</p>\n            <div className=\"grid gap-2\">\n              {['a', 'b', 'c', 'd'].map((key, idx) => {\n                const optionText = processedQuestion.opciones[key];\n                const isEmpty = !optionText || optionText.trim() === '' || optionText.includes('no detectada');\n                return (\n                  <div key={key} className=\"flex items-start gap-2\">\n                    <span className=\"font-bold text-bb-primary min-w-[2rem]\">{key.toUpperCase()})</span>\n                    <input\n                      type=\"text\"\n                      defaultValue={optionText && !optionText.includes('no detectada') ? optionText : ''}\n                      placeholder={`Opci√≥n ${key.toUpperCase()} (opcional)`}\n                      className={`p-2 rounded-lg bg-white/5 border text-white flex-1 break-words focus:outline-none focus:ring-2 ${\n                        isEmpty \n                          ? 'border-orange-400/50 focus:ring-orange-400/30' \n                          : 'border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary'\n                      }`}\n                      onChange={(e) => {\n                        setProcessedQuestion(prev => ({\n                          ...prev,\n                          opciones: {\n                            ...prev.opciones,\n                            [key]: e.target.value\n                          }\n                        }));\n                      }}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n            <p className=\"text-xs text-orange-300\">‚ö†Ô∏è Los campos en naranja no fueron detectados. Ed√≠talos manualmente.</p>\n          </div>\n\n          <div className=\"grid gap-3 p-3 bg-bb-primary/10 rounded-lg border border-bb-primary/30\">\n            <label className=\"text-sm font-semibold text-white\">¬øCu√°l es la respuesta correcta? *</label>\n            <div className=\"grid gap-2\">\n              {['a', 'b', 'c', 'd'].map((key, idx) => {\n                const optionText = processedQuestion.opciones[key];\n                const isEmptyOrInvalid = !optionText || optionText.trim() === '' || optionText.includes('no detectada');\n                \n                // Filter to only show valid options\n                if (isEmptyOrInvalid) return null;\n                \n                return (\n                  <label key={key} className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer\">\n                    <input\n                      type=\"radio\"\n                      name=\"correctOption\"\n                      checked={correctAnswerIndex === idx}\n                      onChange={() => setCorrectAnswerIndex(idx)}\n                      disabled={loading || isEmptyOrInvalid}\n                      className=\"h-4 w-4 cursor-pointer\"\n                    />\n                    <span className=\"text-sm\">\n                      <strong>{key.toUpperCase()})</strong> {optionText}\n                    </span>\n                    {correctAnswerIndex === idx && (\n                      <span className=\"ml-auto text-bb-primary font-bold\">‚úì Correcta</span>\n                    )}\n                  </label>\n                );\n              })}\n            </div>\n          </div>\n\n          <p className=\"text-sm text-white/60\">\n            ‚ÑπÔ∏è Puedes editar la pregunta manualmente. Es importante que completes todos los campos correctamente.\n          </p>\n\n          {/* Show saved questions counter and add another option - VISIBLE BEFORE CONFIRMING */}\n          {savedQuestions.length > 0 && (\n            <div className=\"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40\">\n              <p className=\"text-sm font-semibold text-white mb-2\">\n                ‚úÖ {savedQuestions.length} pregunta{savedQuestions.length !== 1 ? 's' : ''} guardada{savedQuestions.length !== 1 ? 's' : ''} - Puedes guardar esta y agregar m√°s\n              </p>\n              <div className=\"flex gap-2\">\n                <span className=\"text-xs text-bb-primary/80\">üí° Confirma y luego agrega otra</span>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex flex-col gap-2\">\n            <div className=\"flex gap-3\">\n              <Button\n                onClick={confirmQuestion}\n                size=\"lg\"\n                disabled={loading}\n                onFocus={() => isVoiceModeEnabled && speak('Confirmar y guardar', { force: true })}\n                onMouseEnter={() => isVoiceModeEnabled && speak('Confirmar y guardar', { force: true })}\n              >\n                {loading ? '‚è≥ Guardando‚Ä¶' : '‚úì Confirmar'}\n              </Button>\n              <Button\n                variant=\"secondary\"\n                onClick={resetForm}\n                disabled={loading}\n                onFocus={() => isVoiceModeEnabled && speak('Capturar otra imagen', { force: true })}\n                onMouseEnter={() => isVoiceModeEnabled && speak('Capturar otra imagen', { force: true })}\n              >\n                üì∑ Otra imagen\n              </Button>\n              <Button\n                variant=\"secondary\"\n                onClick={onCancel}\n                disabled={loading}\n                onFocus={() => isVoiceModeEnabled && speak('Atr√°s', { force: true })}\n                onMouseEnter={() => isVoiceModeEnabled && speak('Atr√°s', { force: true })}\n              >\n                Atr√°s\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default OCRQuestionCapture;\n","import React, { useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\n\nexport default function Modal({ open, title, onClose, children, className = '' }) {\n  useEffect(() => {\n    const handleEsc = (e) => {\n      if (e.key === 'Escape') onClose?.()\n    }\n    if (open) document.addEventListener('keydown', handleEsc)\n    // Prevent body scroll when modal is open\n    const originalOverflow = document.body.style.overflow\n    if (open) document.body.style.overflow = 'hidden'\n    return () => {\n      document.removeEventListener('keydown', handleEsc)\n      document.body.style.overflow = originalOverflow\n    }\n  }, [open, onClose])\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div className=\"fixed inset-0 z-[3000] flex items-center justify-center px-4 py-8\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>\n          <button aria-label=\"Cerrar\" className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" onClick={onClose} />\n          <motion.div role=\"dialog\" aria-modal=\"true\" className={`relative w-full max-w-2xl max-h-[85vh] overflow-auto rounded-2xl border border-white/10 bg-bb-bg-primary/90 shadow-xl ${className}`} initial={{ scale: 0.98, y: 10, opacity: 0 }} animate={{ scale: 1, y: 0, opacity: 1 }} exit={{ scale: 0.98, y: 10, opacity: 0 }} transition={{ type: 'spring', stiffness: 200, damping: 22 }}>\n            <div className=\"sticky top-0 z-10 flex items-start justify-between gap-4 px-6 py-5 border-b border-white/10 bg-bb-bg-primary/90\">\n              {title ? <h2 className=\"text-xl md:text-2xl font-bold\">{title}</h2> : <span className=\"sr-only\">Modal</span>}\n              <button onClick={onClose} className=\"rounded-md p-2 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bb-primary\" aria-label=\"Cerrar\">‚úï</button>\n            </div>\n            <div className=\"px-6 py-5\">\n              {children}\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  )\n}\n\n","import React, { useState, useEffect } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport ManualQuestionForm from './ManualQuestionForm';\nimport OCRQuestionCapture from './OCRQuestionCapture';\nimport { fetchTopics, fetchDifficultyLevels } from '../services/api';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\nimport Modal from './ui/Modal';\nimport Spinner from './ui/Spinner';\nimport LoadingOverlay from './ui/LoadingOverlay';\n\nconst AIQuestionGenerator = ({ onQuestionsGenerated, onClose }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [topics, setTopics] = useState([]);\n  const [selectedTopic, setSelectedTopic] = useState('');\n  const [selectedDifficulty, setSelectedDifficulty] = useState('medium');\n  const [questionCount, setQuestionCount] = useState(null);\n  const [questionCountInput, setQuestionCountInput] = useState('');\n  const [useAI, setUseAI] = useState(false);\n  const [showManualForm, setShowManualForm] = useState(false);\n  const [showOCRForm, setShowOCRForm] = useState(false);\n  const [manualCount, setManualCount] = useState(null);\n  const [manualCountInput, setManualCountInput] = useState('');\n  const [manualStep, setManualStep] = useState(0);\n  const [manualQuestions, setManualQuestions] = useState([]);\n  const [manualTopic, setManualTopic] = useState('');\n  const [ocrQuestions, setOcrQuestions] = useState([]);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  \n  const [error, setError] = useState('');\n  const [statusMessage, setStatusMessage] = useState('');\n  const [difficultyLevels, setDifficultyLevels] = useState([]);\n\n  useEffect(() => {\n    loadTopics();\n    loadDifficultyLevels();\n  }, []);\n\n  // Mantener inputs string sincronizados cuando el valor num√©rico cambie por stepper u otros\n  useEffect(() => { setQuestionCountInput(typeof questionCount === 'number' ? String(questionCount) : ''); }, [questionCount]);\n  useEffect(() => { setManualCountInput(typeof manualCount === 'number' ? String(manualCount) : ''); }, [manualCount]);\n\n  const loadTopics = async () => {\n    try {\n      const topics = await fetchTopics();\n      setTopics(topics);\n      if (topics.length > 0) {\n        setSelectedTopic(topics[0]);\n      }\n    } catch (error) {\n      setError('Error obteniendo temas. Por favor intenta de nuevo.');\n    }\n  };\n\n  const loadDifficultyLevels = async () => {\n    try {\n      const levels = await fetchDifficultyLevels();\n      setDifficultyLevels(levels);\n    } catch (error) {\n      setError('No se pudieron cargar los niveles de dificultad. Por favor, intenta de nuevo m√°s tarde.');\n    }\n  };\n\n  const generateQuestions = async () => {\n    if (!selectedTopic) {\n      setError('Por favor selecciona un tema v√°lido');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      const apiBase = import.meta.env.VITE_API_URL;\n      if (!apiBase) {\n        setError('Error de configuraci√≥n: URL del API no definida');\n        return;\n      }\n      const token = user && user.getIdToken ? await user.getIdToken() : null;\n      const response = await fetch(`${apiBase}/ai/generate-questions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token ? { Authorization: `Bearer ${token}` } : {})\n        },\n        body: JSON.stringify({\n          topic: selectedTopic,\n          difficulty: selectedDifficulty,\n          count: questionCount,\n          useAI: useAI\n        }),\n      });\n\n      const data = await response.json();\n      if (data.success) {\n        // Guardar preguntas en Firestore y esperar confirmaci√≥n exitosa antes de crear la partida\n        const questionsWithMeta = data.questions.map(q => ({\n          // Si las opciones existen, barajarlas y actualizar el √≠ndice de la respuesta correcta de forma robusta\n          ...(() => {\n            if (!Array.isArray(q.options) || typeof q.correctAnswerIndex !== 'number') return q;\n            // Asociar cada opci√≥n con su √≠ndice original\n            const optionsWithIndex = q.options.map((opt, idx) => ({ opt, origIdx: idx }));\n            // Barajar\n            for (let i = optionsWithIndex.length - 1; i > 0; i--) {\n              const j = Math.floor(Math.random() * (i + 1));\n              [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];\n            }\n            // Buscar la nueva posici√≥n de la opci√≥n que era la correcta\n            const newCorrectIndex = optionsWithIndex.findIndex(o => o.origIdx === q.correctAnswerIndex);\n            return {\n              ...q,\n              options: optionsWithIndex.map(o => o.opt),\n              correctAnswerIndex: newCorrectIndex\n            };\n          })(),\n          createdBy: user?.uid || 'anon',\n          createdAt: Date.now(),\n          category: selectedTopic,\n          difficulty: selectedDifficulty\n        }));\n        let saveOk = false;\n        try {\n          const bulkToken = user && user.getIdToken ? await user.getIdToken() : null;\n          const response = await fetch(`${apiBase}/questions/bulk`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              ...(bulkToken ? { Authorization: `Bearer ${bulkToken}` } : {})\n            },\n            body: JSON.stringify({ questions: questionsWithMeta })\n          });\n          const result = await response.json();\n          if (!result.success) {\n            setError((prev) => (prev ? prev + ' | ' : '') + (result.error || 'Error guardando preguntas en Firestore'));\n            setError('No se pudieron guardar las preguntas. ' + (result.error || 'Por favor, intenta de nuevo.'));\n          } else {\n            saveOk = true;\n          }\n        } catch (e) {\n          setError('Ocurri√≥ un error al guardar las preguntas. Por favor, verifica tu conexi√≥n e intenta de nuevo.');\n        }\n        if (!saveOk) {\n          setLoading(false);\n          return;\n        }\n        // Redirigir al usuario a la pantalla principal para que pueda crear la partida manualmente\n        onQuestionsGenerated(data.questions);\n        setLoading(false);\n        // No navegues ni cierres aqu√≠, deja que el Dashboard controle el cierre\n      } else {\n        setError(data.error || 'Error generando preguntas');\n        setError('No se pudieron generar las preguntas: ' + (data.error || 'Por favor, intenta de nuevo.'));\n      }\n    } catch (error) {\n      setError('Error de conexi√≥n. Por favor, verifica tu conexi√≥n a internet e intenta nuevamente.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Mantener vac√≠o por defecto; no autocompletar cantidad\n\n  return (\n    <Modal open={true} title=\"ü§ñ Generador de Preguntas\" onClose={onClose}>\n      {isVoiceModeEnabled && (!showManualForm) && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              const parts = [];\n              if (!showManualForm && !useAI) {\n                parts.push('Est√°s en el generador de preguntas.');\n                parts.push('Bot√≥n Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.');\n                parts.push('Bot√≥n Escribir preguntas: te permite escribir preguntas manualmente.');\n                parts.push('Selecciona una opci√≥n para continuar.');\n              } else if (useAI && !showManualForm) {\n                parts.push('Formulario para generar preguntas con inteligencia artificial.');\n                parts.push('Campo Tema: selecciona el tema de las preguntas.');\n                parts.push('Campo Dificultad: elige la dificultad.');\n                parts.push('Campo Cantidad: indica cu√°ntas preguntas quieres generar.');\n                parts.push('Bot√≥n Crear preguntas: genera las preguntas.');\n                parts.push('Bot√≥n Atr√°s: vuelve a la pantalla anterior.');\n              }\n              await speak(parts.join(' '), { action: 'page_guide', questionId: 'ai_question_generator', force: true });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n            onFocus={() => speak('Explicar p√°gina: describe la funci√≥n de cada bot√≥n y campo en esta vista.', { force: true })}\n            onMouseEnter={() => speak('Explicar p√°gina: describe la funci√≥n de cada bot√≥n y campo en esta vista.', { force: true })}\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n      {loading && <LoadingOverlay text=\"Generando‚Ä¶\" mobileOnly />}\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {statusMessage && <Alert intent=\"success\">{statusMessage}</Alert>}\n      {!showManualForm && !useAI && !showOCRForm && (\n        <div className=\"flex flex-col gap-3\">\n          <Button\n            onClick={() => setUseAI(true)}\n            size=\"lg\"\n            onFocus={() => isVoiceModeEnabled && speak('Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.', { force: true })}\n          >\n            ü§ñ Crear con IA\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => { setShowManualForm(true); setUseAI(false); setManualStep(0); setManualQuestions([]); }}\n            onFocus={() => isVoiceModeEnabled && speak('Escribir preguntas: te permite escribir preguntas manualmente.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Escribir preguntas: te permite escribir preguntas manualmente.', { force: true })}\n          >\n            ‚úèÔ∏è Escribir preguntas\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => { setShowOCRForm(true); setUseAI(false); }}\n            onFocus={() => isVoiceModeEnabled && speak('Capturar pregunta: extrae preguntas de im√°genes usando OCR.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Capturar pregunta: extrae preguntas de im√°genes usando OCR.', { force: true })}\n          >\n            üì∏ Capturar pregunta\n          </Button>\n        </div>\n      )}\n      {!showManualForm && useAI && !showOCRForm && (\n        <form\n          className=\"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4\"\n          onSubmit={async (e) => {\n            e.preventDefault();\n            setLoading(true);\n            setError('');\n            try {\n              await generateQuestions();\n              setError('');\n            } catch (err) {\n              setError('Error al generar preguntas. Por favor, int√©ntalo de nuevo.');\n            } finally {\n              setLoading(false);\n            }\n          }}\n        >\n          <div>\n            <label htmlFor=\"topic\" className=\"block mb-1 text-sm text-white/80\">Tema</label>\n            <select\n              id=\"topic\"\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              disabled={topics.length === 0}\n            >\n              {topics.length === 0 ? (\n                <option value=\"\">No hay temas</option>\n              ) : (\n                topics.map(topic => (\n                  <option key={topic} value={topic}>{topic}</option>\n                ))\n              )}\n            </select>\n          </div>\n          <div>\n            <label htmlFor=\"difficulty\" className=\"block mb-1 text-sm text-white/80\">Dificultad</label>\n            <select\n              id=\"difficulty\"\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n              value={selectedDifficulty}\n              onChange={(e) => setSelectedDifficulty(e.target.value)}\n            >\n              <option value=\"easy\">F√°cil</option>\n              <option value=\"medium\">Media</option>\n              <option value=\"hard\">Dif√≠cil</option>\n            </select>\n          </div>\n          <div>\n            <label htmlFor=\"numQuestions\" className=\"block mb-1 text-sm text-white/80\">Cantidad</label>\n              <div>\n                <Input\n                id=\"numQuestions\"\n                type=\"text\"\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n                value={questionCountInput}\n                onChange={(e) => {\n                  const digits = e.target.value.replace(/\\D+/g, '')\n                  setQuestionCountInput(digits)\n                  const num = digits ? parseInt(digits, 10) : NaN\n                  if (!Number.isNaN(num)) setQuestionCount(num); else setQuestionCount(null)\n                }}\n                onBlur={() => {\n                  const num = parseInt(questionCountInput || '', 10)\n                  if (Number.isNaN(num) || num < 1) {\n                    setQuestionCount(null)\n                    setQuestionCountInput('')\n                    return\n                  }\n                  const normalized = Math.max(1, num)\n                  setQuestionCount(normalized)\n                  setQuestionCountInput(String(normalized))\n                }}\n                required\n                placeholder=\"Cantidad\"\n                className=\"w-28 text-center\"\n              />\n              {(questionCountInput === '' || questionCount === null) && (\n                <div className={`mt-1 text-xs ${questionCountInput === '' ? 'text-white/60' : 'text-red-300'}`}>\n                  {questionCountInput === '' ? 'Ingresa un n√∫mero (>= 1)' : 'Valor inv√°lido'}\n                </div>\n              )}\n              </div>\n          </div>\n          {error && <Alert intent=\"error\" className=\"sm:col-span-3\">{error}</Alert>}\n          <div className=\"sm:col-span-3 mt-2 flex flex-wrap gap-3 justify-end items-center\">\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => setUseAI(false)}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Atr√°s: vuelve a la pantalla anterior.', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Atr√°s: vuelve a la pantalla anterior.', { force: true })}\n            >\n              Atr√°s\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Crear preguntas: genera las preguntas con inteligencia artificial.', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Crear preguntas: genera las preguntas con inteligencia artificial.', { force: true })}\n            >\n              {loading ? (<><Spinner size={16} className=\"mr-2\" />Creando‚Ä¶</>) : 'Crear preguntas'}\n            </Button>\n          </div>\n        </form>\n      )}\n      {showManualForm && (\n        <div className=\"mt-2\">\n          {manualStep === 0 ? (\n            <form\n              className=\"grid grid-cols-1 gap-4\"\n              onSubmit={e => { e.preventDefault(); setManualStep(1); setManualQuestions([]); setManualTopic(selectedTopic); }}\n            >\n              <div>\n                <label className=\"block mb-1 text-sm text-white/80\">Tema</label>\n                <select\n                  value={selectedTopic}\n                  onChange={e => setSelectedTopic(e.target.value)}\n                  className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n                >\n                  {topics.map(t => <option key={t} value={t}>{t}</option>)}\n                </select>\n              </div>\n              <div>\n                <label className=\"block mb-1 text-sm text-white/80\">¬øCu√°ntas preguntas?</label>\n                <div>\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    pattern=\"[0-9]*\"\n                    value={manualCountInput}\n                    onChange={e => {\n                      const digits = e.target.value.replace(/\\D+/g, '')\n                      setManualCountInput(digits)\n                      const num = digits ? parseInt(digits, 10) : NaN\n                      if (!Number.isNaN(num)) setManualCount(num); else setManualCount(null)\n                    }}\n                    onBlur={() => {\n                      const num = parseInt(manualCountInput || '', 10)\n                      if (Number.isNaN(num) || num < 1) {\n                        setManualCount(null)\n                        setManualCountInput('')\n                        return\n                      }\n                      const normalized = Math.max(1, num)\n                      setManualCount(normalized)\n                      setManualCountInput(String(normalized))\n                    }}\n                    required\n                    placeholder=\"Cantidad\"\n                    className=\"w-28 text-center\"\n                  />\n                  {(manualCountInput === '' || manualCount === null) && (\n                    <div className={`mt-1 text-xs ${manualCountInput === '' ? 'text-white/60' : 'text-red-300'}`}>\n                      {manualCountInput === '' ? 'Ingresa un n√∫mero (>= 1)' : 'Valor inv√°lido'}\n                    </div>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={() => setShowManualForm(false)}\n                  onFocus={() => isVoiceModeEnabled && speak('Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.', { force: true })}\n                  onMouseEnter={() => isVoiceModeEnabled && speak('Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.', { force: true })}\n                >\n                  Volver\n                </Button>\n                <Button\n                  type=\"submit\"\n                  onFocus={() => isVoiceModeEnabled && speak('Empezar: inicia la creaci√≥n manual de preguntas.', { force: true })}\n                  onMouseEnter={() => isVoiceModeEnabled && speak('Empezar: inicia la creaci√≥n manual de preguntas.', { force: true })}\n                >\n                  Empezar\n                </Button>\n              </div>\n            </form>\n          ) : (\n            <div>\n              <div className=\"text-center mb-3 font-bold\">¬°Vamos! Pregunta {manualQuestions.length + 1} de {manualCount}</div>\n              <ManualQuestionForm\n                topics={[manualTopic]}\n                onQuestionCreated={async (q) => {\n                                    // q is the payload prepared by the child\n                                    try {\n                                      setLoading(true);\n                                      setError('');\n\n                                      const apiBase = import.meta.env.VITE_API_URL;\n                                      if (!apiBase) {\n                                        throw new Error('Error de configuraci√≥n: URL del API no definida');\n                                      }\n                                      if (!user || !user.getIdToken) {\n                                        throw new Error('Debes iniciar sesi√≥n para crear preguntas');\n                                      }\n                                      const token = await user.getIdToken();\n\n                                      // Save single question\n                                      const response = await fetch(`${apiBase}/questions`, {\n                                        method: 'POST',\n                                        headers: {\n                                          'Content-Type': 'application/json',\n                                          Authorization: `Bearer ${token}`\n                                        },\n                                        body: JSON.stringify(q)\n                                      });\n\n                                      const data = await response.json();\n                                      if (!response.ok) {\n                                        throw new Error(data.error || 'Error al guardar la pregunta');\n                                      }\n\n                                      const saved = data.question || { ...q };\n                                      const next = [...manualQuestions, { ...saved, category: manualTopic }];\n\n                                      // If last question, bulk save (server may already store them individually, but keep compatibility)\n                                      if (next.length === manualCount) {\n                                        // Do a bulk save to keep existing API usage\n                                        const bulkResp = await fetch(`${apiBase}/questions/bulk`, {\n                                          method: 'POST',\n                                          headers: {\n                                            'Content-Type': 'application/json',\n                                            Authorization: `Bearer ${token}`\n                                          },\n                                          body: JSON.stringify({ questions: next })\n                                        });\n                                        const bulkData = await bulkResp.json();\n                                        if (!bulkResp.ok) {\n                                          throw new Error(bulkData.error || 'Error al guardar las preguntas en lote');\n                                        }\n\n                                        if (onQuestionsGenerated) {\n                                          onQuestionsGenerated(next);\n                                        }\n\n                                        setStatusMessage('¬°Todas las preguntas han sido guardadas exitosamente!');\n                                        setTimeout(() => {\n                                          setShowManualForm(false);\n                                          setStatusMessage('');\n                                        }, 1500);\n                                        return next;\n                                      } else {\n                                        setManualQuestions(next);\n                                        setManualStep(prev => prev + 1);\n                                        setStatusMessage(`¬°Pregunta ${next.length} de ${manualCount} guardada exitosamente!`);\n                                        setTimeout(() => setStatusMessage(''), 1500);\n                                        return saved;\n                                      }\n                                    } catch (error) {\n                                      setError('No se pudo guardar la pregunta: ' + (error.message || 'Por favor, intenta de nuevo.'));\n                                    } finally {\n                                      setLoading(false);\n                                    }\n                                  }}\n                                  onCancel={() => { setShowManualForm(false); }}\n                                />\n            </div>\n          )}\n        </div>\n      )}\n      {showOCRForm && (\n        <OCRQuestionCapture\n          topics={topics}\n          onQuestionExtracted={async (questionPayload) => {\n            setLoading(true);\n            setError('');\n            try {\n              const apiBase = import.meta.env.VITE_API_URL;\n              const token = user && user.getIdToken ? await user.getIdToken() : null;\n              const response = await fetch(`${apiBase}/questions`, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  ...(token ? { Authorization: `Bearer ${token}` } : {})\n                },\n                body: JSON.stringify(questionPayload)\n              });\n\n              if (response.ok) {\n                const result = await response.json();\n                const savedQuestion = result.question || { ...questionPayload };\n                const updatedQuestions = [...ocrQuestions, savedQuestion];\n                setOcrQuestions(updatedQuestions);\n                \n                setStatusMessage(`‚úÖ Pregunta ${updatedQuestions.length} guardada exitosamente. Puedes agregar m√°s o finalizar.`);\n                setLoading(false);\n                \n                // Mantener modal abierto para agregar m√°s preguntas\n                // No cierra autom√°ticamente despu√©s de guardar\n              } else {\n                setError('No se pudo guardar la pregunta');\n                setLoading(false);\n              }\n            } catch (error) {\n              setError('Error al guardar la pregunta: ' + (error.message || 'Por favor, intenta de nuevo.'));\n              setLoading(false);\n            }\n          }}\n          onCancel={() => { \n            setShowOCRForm(false);\n            \n            // Si hay preguntas guardadas, notifica al parent\n            if (ocrQuestions.length > 0) {\n              setStatusMessage(`‚úÖ Se guardaron ${ocrQuestions.length} pregunta(s) de OCR`);\n              \n              setTimeout(() => {\n                onQuestionsGenerated(ocrQuestions);\n                setOcrQuestions([]);\n                setStatusMessage('');\n              }, 1500);\n            }\n          }}\n        />\n      )}\n    </Modal>\n  );\n}\n\nexport default AIQuestionGenerator;"],"names":["ManualQuestionForm","topics","onQuestionCreated","onCancel","isVoiceModeEnabled","speak","useVoice","user","useAuth","formData","setFormData","useState","error","setError","loading","setLoading","successMessage","setSuccessMessage","handleOptionChange","idx","value","prev","opt","i","validateForm","useCallback","useEffect","validationError","handleSubmit","e","payload","result","savedText","err","jsxs","jsx","Button","parts","Alert","Input","OCRQuestionCapture","onQuestionExtracted","mode","setMode","selectedTopic","setSelectedTopic","imageFile","setImageFile","imagePreview","setImagePreview","processedQuestion","setProcessedQuestion","manualQuestion","setManualQuestion","correctAnswerIndex","setCorrectAnswerIndex","savedQuestions","setSavedQuestions","fileInputRef","useRef","apiBase","handleFileSelect","file","reader","processImage","base64Image","data","hasQuestion","detectedOptions","confirmQuestion","pregunta","opciones","optionsArray","o","hasAtLeastTwoOptions","questionPayload","resetForm","Spinner","t","key","optionText","isEmpty","isEmptyOrInvalid","Modal","open","title","onClose","children","className","handleEsc","originalOverflow","AnimatePresence","motion","AIQuestionGenerator","onQuestionsGenerated","setTopics","selectedDifficulty","setSelectedDifficulty","questionCount","setQuestionCount","questionCountInput","setQuestionCountInput","useAI","setUseAI","showManualForm","setShowManualForm","showOCRForm","setShowOCRForm","manualCount","setManualCount","manualCountInput","setManualCountInput","manualStep","setManualStep","manualQuestions","setManualQuestions","manualTopic","setManualTopic","ocrQuestions","setOcrQuestions","statusMessage","setStatusMessage","difficultyLevels","setDifficultyLevels","loadTopics","loadDifficultyLevels","fetchTopics","levels","fetchDifficultyLevels","generateQuestions","token","questionsWithMeta","q","optionsWithIndex","j","newCorrectIndex","saveOk","bulkToken","LoadingOverlay","topic","digits","num","normalized","Fragment","response","saved","next","bulkResp","bulkData","savedQuestion","updatedQuestions"],"mappings":"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"}