{"version":3,"file":"OCRQuestionCapture-C5SgBjEi.js","sources":["../../src/components/OCRQuestionCapture.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport Button from './ui/Button';\nimport Alert from './ui/Alert';\nimport Spinner from './ui/Spinner';\n\nconst OCRQuestionCapture = ({ topics, onQuestionExtracted, onCancel }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const fileInputRef = useRef(null);\n  const apiBase = import.meta.env.VITE_API_URL;\n\n  // ==================== STATE MANAGEMENT ====================\n  const [mode, setMode] = useState(null);\n  const [selectedTopic, setSelectedTopic] = useState(topics[0] || '');\n  const [imageFile, setImageFile] = useState(null);\n  const [imagePreview, setImagePreview] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const [processedQuestion, setProcessedQuestion] = useState(null);\n  const [correctAnswerIndex, setCorrectAnswerIndex] = useState(0);\n  const [savedQuestions, setSavedQuestions] = useState([]);\n\n  // ==================== VALIDATION UTILITIES ====================\n  const validateImage = (file) => {\n    const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];\n    const maxSize = 10 * 1024 * 1024; // 10MB\n\n    if (!validTypes.includes(file.type)) {\n      return 'Formato inv√°lido. Solo PNG, JPG o JPEG.';\n    }\n    if (file.size > maxSize) {\n      return 'Imagen demasiado grande. M√°ximo 10MB.';\n    }\n    return null;\n  };\n\n  const validateQuestion = () => {\n    const pregunta = processedQuestion.pregunta?.trim();\n    const opciones = processedQuestion.opciones;\n    \n    const optionsArray = ['a', 'b', 'c', 'd']\n      .map(key => opciones[key]?.trim() || '')\n      .filter(opt => opt && !opt.includes('no detectada'));\n\n    if (!pregunta) return 'Escribe la pregunta.';\n    if (optionsArray.length < 2) return 'M√≠nimo 2 opciones v√°lidas.';\n    if (!selectedTopic) return 'Selecciona un tema.';\n    if (correctAnswerIndex >= optionsArray.length) return 'Selecciona respuesta correcta.';\n    \n    return null;\n  };\n\n  // ==================== FILE HANDLING ====================\n  const handleFileSelect = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const validationError = validateImage(file);\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    setImageFile(file);\n    setError('');\n\n    const reader = new FileReader();\n    reader.onload = (e) => setImagePreview(e.target.result);\n    reader.readAsDataURL(file);\n\n    if (isVoiceModeEnabled) {\n      speak(`Imagen seleccionada: ${file.name}. Presiona procesar.`, { force: true });\n    }\n  };\n\n  // ==================== OCR PROCESSING ====================\n  const processImage = async () => {\n    if (!imageFile || !apiBase) {\n      setError('Selecciona una imagen v√°lida o configura el API.');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSuccessMessage('');\n\n    try {\n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        try {\n          const response = await fetch(`${apiBase}/ocr/process-image`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              imageBase64: e.target.result,\n              mimeType: imageFile.type || 'image/jpeg',\n              language: 'es'\n            })\n          });\n\n          const data = await response.json();\n\n          if (data.success) {\n            const hasQuestion = data.pregunta && !data.pregunta.includes('no detectada');\n            const detectedOptions = Object.values(data.opciones || {})\n              .filter(opt => opt && !opt.includes('no detectada'));\n\n            if (!hasQuestion || detectedOptions.length === 0) {\n              setSuccessMessage('‚ö†Ô∏è Detecci√≥n parcial. Completa los campos.', { force: true });\n              if (isVoiceModeEnabled) {\n                speak('Extracci√≥n parcial. Completa manualmente.', { force: true });\n              }\n            } else {\n              setSuccessMessage('‚úÖ Pregunta extra√≠da correctamente');\n              if (isVoiceModeEnabled) {\n                speak(`Pregunta detectada: ${data.pregunta}`, { force: true });\n              }\n            }\n\n            setProcessedQuestion({\n              pregunta: data.pregunta || '',\n              opciones: data.opciones || { a: '', b: '', c: '', d: '' }\n            });\n          } else {\n            setError(data.error || 'Error procesando imagen.');\n          }\n        } catch (err) {\n          setError(`Error: ${err.message}`);\n        } finally {\n          setLoading(false);\n        }\n      };\n      reader.readAsDataURL(imageFile);\n    } catch (err) {\n      setError(`Error: ${err.message}`);\n      setLoading(false);\n    }\n  };\n\n  // ==================== QUESTION CONFIRMATION ====================\n  const confirmQuestion = async () => {\n    const validationError = validateQuestion();\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    const optionsArray = ['a', 'b', 'c', 'd']\n      .map(key => processedQuestion.opciones[key]?.trim() || '')\n      .filter(opt => opt && !opt.includes('no detectada'));\n\n    const questionPayload = {\n      text: processedQuestion.pregunta.trim(),\n      options: optionsArray,\n      correctAnswerIndex,\n      category: selectedTopic,\n      explanation: ''\n    };\n\n    try {\n      if (onQuestionExtracted) {\n        await onQuestionExtracted(questionPayload);\n        setSavedQuestions([...savedQuestions, questionPayload]);\n        setSuccessMessage('‚úÖ Pregunta guardada exitosamente');\n\n        if (isVoiceModeEnabled) {\n          speak('Pregunta guardada. Puedes agregar m√°s.', { force: true });\n        }\n\n        setTimeout(() => {\n          setImageFile(null);\n          setImagePreview(null);\n          setProcessedQuestion(null);\n          setMode(null);\n          setCorrectAnswerIndex(0);\n          setSuccessMessage('');\n        }, 2000);\n      }\n    } catch (err) {\n      setError(`Error al guardar: ${err.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ==================== FORM RESET ====================\n  const resetForm = () => {\n    setImageFile(null);\n    setImagePreview(null);\n    setProcessedQuestion(null);\n    setMode(null);\n    setCorrectAnswerIndex(0);\n    setError('');\n    setSuccessMessage('');\n  };\n\n  // ==================== EFFECTS ====================\n  useEffect(() => {\n    if (isVoiceModeEnabled && !mode && !imageFile) {\n      speak('Captura de pregunta. Sube una imagen para comenzar.', { force: true });\n    }\n  }, [isVoiceModeEnabled, mode, imageFile]);\n\n  // ==================== RENDER ====================\n  return (\n    <div className=\"grid gap-4 p-4\">\n      {/* Voice Mode Help */}\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={async () => {\n              await speak('Sube una imagen. La aplicaci√≥n extrae autom√°ticamente texto y opciones. Edita si necesario y guarda.', { force: true });\n            }}\n          >\n            üõà Explicar\n          </Button>\n        </div>\n      )}\n\n      {/* Alerts */}\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n      {/* Questions Counter (After Save) */}\n      {savedQuestions.length > 0 && !processedQuestion && (\n        <div className=\"p-3 bg-gradient-to-r from-green-500/20 to-green-500/10 rounded-lg border border-green-400/30\">\n          <div className=\"mb-3\">\n            <p className=\"text-sm font-semibold text-white\">\n              ‚úÖ {savedQuestions.length} pregunta{savedQuestions.length !== 1 ? 's' : ''} guardada{savedQuestions.length !== 1 ? 's' : ''}\n            </p>\n            <p className=\"text-xs text-green-300 mt-1\">üí° Agregar m√°s o finalizar</p>\n          </div>\n          <div className=\"flex gap-2 flex-wrap\">\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={() => setMode('upload')}\n            >\n              üì∑ Otra imagen\n            </Button>\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              onClick={onCancel}\n            >\n              ‚úì Finalizar\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Mode Selection */}\n      {!mode && !imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Crear pregunta desde imagen</h3>\n          <Button\n            onClick={() => setMode('upload')}\n            size=\"lg\"\n          >\n            üì± Subir imagen\n          </Button>\n        </div>\n      )}\n\n      {/* Upload Section */}\n      {mode === 'upload' && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Subir imagen con texto</h3>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/jpeg,image/png,image/jpg\"\n            onChange={handleFileSelect}\n            className=\"block w-full rounded-xl border-2 border-dashed border-white/20 bg-white/5 px-4 py-6 text-white cursor-pointer hover:border-white/40 hover:bg-white/10 transition\"\n          />\n          <p className=\"text-xs text-white/50\">PNG, JPG o JPEG. M√°ximo 10MB.</p>\n        </div>\n      )}\n\n      {/* Preview Section */}\n      {imageFile && !processedQuestion && (\n        <div className=\"grid gap-3\">\n          <h3 className=\"text-lg font-bold\">Vista previa</h3>\n          {imagePreview && (\n            <img\n              src={imagePreview}\n              alt=\"Preview\"\n              className=\"w-full max-h-96 rounded-xl object-contain border-2 border-white/10\"\n            />\n          )}\n          <div className=\"flex gap-2 flex-wrap\">\n            <Button\n              onClick={processImage}\n              disabled={loading}\n              size=\"lg\"\n            >\n              {loading ? <Spinner size=\"sm\" /> : '‚ö° Procesar'}\n            </Button>\n            <Button\n              variant=\"secondary\"\n              onClick={resetForm}\n              disabled={loading}\n            >\n              Cambiar imagen\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Question Editor */}\n      {processedQuestion && (\n        <div className=\"grid gap-6\">\n          {/* Header */}\n          <div className=\"p-4 bg-gradient-to-br from-bb-primary/20 to-bb-primary/10 rounded-xl border-2 border-bb-primary/40\">\n            <h3 className=\"text-lg font-bold mb-2\">üìù Editar Pregunta</h3>\n            <p className=\"text-xs text-white/70\">Verifica y completa todos los campos</p>\n          </div>\n\n          {/* Warning for Partial Detection */}\n          {!processedQuestion.pregunta || processedQuestion.pregunta.includes('no detectada') && (\n            <Alert intent=\"warning\">\n              ‚ö†Ô∏è <strong>Completar manualmente:</strong> OCR no detect√≥ la pregunta correctamente.\n            </Alert>\n          )}\n\n          {/* Topic Selection */}\n          <div className=\"grid gap-2.5\">\n            <label className=\"text-sm font-semibold text-white\">Tema</label>\n            <select\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              className=\"w-full px-4 py-3 rounded-xl border-2 border-white/10 bg-white/5 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 transition\"\n            >\n              {topics.map(t => (\n                <option key={t} value={t}>{t}</option>\n              ))}\n            </select>\n          </div>\n\n          {/* Question Text */}\n          <div className=\"grid gap-2.5\">\n            <label className=\"text-sm font-semibold text-white\">Pregunta</label>\n            <textarea\n              value={processedQuestion.pregunta || ''}\n              onChange={(e) => setProcessedQuestion(prev => ({\n                ...prev,\n                pregunta: e.target.value\n              }))}\n              placeholder=\"Escribe la pregunta...\"\n              className=\"w-full p-4 rounded-xl bg-white/5 border-2 border-white/10 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 resize-none transition\"\n              rows=\"4\"\n            />\n          </div>\n\n          {/* Answer Options */}\n          <div className=\"grid gap-3\">\n            <div className=\"flex justify-between items-center\">\n              <label className=\"text-sm font-semibold text-white\">Opciones de respuesta</label>\n              <span className=\"text-xs text-white/60\">M√≠nimo 2</span>\n            </div>\n            <div className=\"grid gap-3 p-4 bg-white/5 rounded-lg border border-white/10\">\n              {['a', 'b', 'c', 'd'].map((key, idx) => {\n                const optionText = processedQuestion.opciones[key];\n                const isEmpty = !optionText || optionText.trim() === '' || optionText.includes('no detectada');\n\n                return (\n                  <div key={key} className=\"flex items-center gap-3\">\n                    <span className=\"font-bold text-bb-primary text-lg w-8\">{key.toUpperCase()})</span>\n                    <input\n                      type=\"text\"\n                      value={optionText && !optionText.includes('no detectada') ? optionText : ''}\n                      onChange={(e) => setProcessedQuestion(prev => ({\n                        ...prev,\n                        opciones: { ...prev.opciones, [key]: e.target.value }\n                      }))}\n                      className={`flex-1 px-3 py-2 rounded-lg bg-white/5 border text-white text-sm focus:outline-none focus:ring-2 transition ${\n                        isEmpty\n                          ? 'border-orange-400/50 focus:ring-orange-400/30'\n                          : 'border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary'\n                      }`}\n                      placeholder={isEmpty ? 'Nueva opci√≥n' : ''}\n                    />\n                    <input\n                      type=\"radio\"\n                      name=\"correctOption\"\n                      checked={correctAnswerIndex === idx}\n                      onChange={() => setCorrectAnswerIndex(idx)}\n                      disabled={isEmpty || loading}\n                      className=\"h-5 w-5 cursor-pointer accent-bb-primary\"\n                    />\n                  </div>\n                );\n              })}\n            </div>\n            {['a', 'b', 'c', 'd'].some(key => {\n              const text = processedQuestion.opciones[key];\n              return !text || text.trim() === '' || text.includes('no detectada');\n            }) && (\n              <p className=\"text-xs text-orange-300\">‚ö†Ô∏è Campos en naranja necesitan edici√≥n.</p>\n            )}\n          </div>\n\n          {/* Correct Answer Summary */}\n          <div className=\"p-4 bg-bb-primary/15 rounded-lg border border-bb-primary/40\">\n            <p className=\"text-sm font-semibold text-white mb-2\">‚úì Respuesta Correcta:</p>\n            <p className=\"text-sm text-white/80\">\n              {(() => {\n                const optionsArray = ['a', 'b', 'c', 'd'];\n                const selectedKey = optionsArray[correctAnswerIndex];\n                const selectedText = processedQuestion.opciones[selectedKey];\n                return selectedText && !selectedText.includes('no detectada')\n                  ? `${selectedKey.toUpperCase()}) ${selectedText}`\n                  : '‚ö†Ô∏è Selecciona una v√°lida';\n              })()}\n            </p>\n          </div>\n\n          {/* Info Box */}\n          <div className=\"p-3 bg-blue-500/10 border border-blue-400/30 rounded-lg\">\n            <p className=\"text-xs text-blue-300\">‚ÑπÔ∏è Revisa todo antes de guardar. Puedes editar cualquier campo.</p>\n          </div>\n\n          {/* Saved Questions Badge */}\n          {savedQuestions.length > 0 && (\n            <div className=\"p-3 bg-green-500/10 border border-green-400/30 rounded-lg\">\n              <p className=\"text-sm font-semibold text-green-300\">\n                ‚úÖ {savedQuestions.length} guardada{savedQuestions.length !== 1 ? 's' : ''}\n              </p>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"grid grid-cols-2 gap-2 pt-2\">\n            <Button\n              onClick={confirmQuestion}\n              disabled={loading}\n              className=\"flex-1\"\n            >\n              {loading ? '‚è≥ Guardando‚Ä¶' : '‚úîÔ∏è Guardar'}\n            </Button>\n            {savedQuestions.length > 0 ? (\n              <Button\n                variant=\"secondary\"\n                onClick={onCancel}\n                disabled={loading}\n                className=\"flex-1\"\n              >\n                ‚úì Finalizar\n              </Button>\n            ) : (\n              <Button\n                variant=\"secondary\"\n                onClick={onCancel}\n                disabled={loading}\n                className=\"flex-1\"\n              >\n                ‚Üê Atr√°s\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default OCRQuestionCapture;\n"],"names":["OCRQuestionCapture","topics","onQuestionExtracted","onCancel","isVoiceModeEnabled","speak","useVoice","fileInputRef","useRef","apiBase","mode","setMode","useState","selectedTopic","setSelectedTopic","imageFile","setImageFile","imagePreview","setImagePreview","loading","setLoading","error","setError","successMessage","setSuccessMessage","processedQuestion","setProcessedQuestion","correctAnswerIndex","setCorrectAnswerIndex","savedQuestions","setSavedQuestions","validateImage","file","validateQuestion","pregunta","opciones","optionsArray","key","opt","handleFileSelect","e","validationError","reader","processImage","data","hasQuestion","detectedOptions","err","confirmQuestion","questionPayload","resetForm","useEffect","jsxs","jsx","Button","Alert","Spinner","t","prev","idx","optionText","isEmpty","text","selectedKey","selectedText"],"mappings":"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"}