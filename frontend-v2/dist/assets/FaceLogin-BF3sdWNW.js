import{r as s,b as P,j as e,s as B,e as $}from"./index-BP-VUWEV.js";import{B as h}from"./Button-C88ZZduS.js";import{I as A}from"./Input-Ddtb7GhB.js";import{A as x}from"./Alert-C6PvCdCu.js";import{F as O,o as V,g as C}from"./imageOptimizer-B6QFrVqj.js";function D(){const[d,S]=s.useState(""),[f,t]=s.useState(""),[v,m]=s.useState(""),[c,j]=s.useState(!1),[b,i]=s.useState(""),[w,u]=s.useState(null),[N,p]=s.useState(null),[y,g]=s.useState("email"),E=P(),k=async a=>{try{i("Optimizando imagen...");const o=await V(a,200,200,.3),n=C(a),l=C(o),r=Math.round((1-l/n)*100);console.log(`‚úì Imagen optimizada: ${n}KB ‚Üí ${l}KB (${r}% reducci√≥n)`),u(o),p(o),i("")}catch(o){console.error("Error optimizando imagen, usando original:",o),u(a),p(a),i("")}},z=()=>{u(null),p(null),t(""),m("")},F=a=>{if(a.preventDefault(),!d){t("Por favor, ingresa tu email");return}t(""),g("capture")},T=async()=>{if(!w){t("Por favor, captura una foto primero");return}if(!d){t("Email requerido"),g("email");return}j(!0),i("Enviando imagen..."),t(""),m("");try{const a="http://localhost:5000/api";i("Verificando rostro...");const o=JSON.stringify({image:w,email:d});console.log(`Tama√±o del payload: ${(o.length/1024).toFixed(2)}KB`);const n=await fetch(`${a}/face/login`,{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip, deflate"},body:o,priority:"high"}),l=n.headers.get("content-type");if(!l||!l.includes("application/json")){const L=await n.text();throw console.error("Respuesta no es JSON:",L.substring(0,200)),new Error(`El servidor devolvi√≥ un error. Verifica que el backend est√© corriendo en ${a}`)}const r=await n.json();if(!n.ok)throw new Error(r.error||"Error en el login facial");if(r.success&&r.verified)if(r.customToken)i("Autenticando..."),await B($,r.customToken),m("¬°Login facial exitoso! Redirigiendo..."),setTimeout(()=>{E("/dashboard")},1e3);else throw new Error("No se recibi√≥ token de autenticaci√≥n");else throw new Error(r.error||"Las caras no coinciden. Acceso denegado.")}catch(a){t(a.message||"Error al verificar la cara. Por favor, intenta de nuevo."),console.error("Error en login facial:",a)}finally{j(!1),i("")}},I=()=>{g("email"),u(null),p(null),t(""),m("")};return e.jsx("div",{className:"container min-h-screen px-4 py-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"üîê Login Facial"}),e.jsx("p",{className:"text-white/70 mt-2",children:"Inicia sesi√≥n usando reconocimiento facial"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-6",children:[f&&e.jsx(x,{intent:"error",className:"mb-4",children:f}),v&&e.jsx(x,{intent:"success",className:"mb-4",children:v}),b&&e.jsxs(x,{intent:"info",className:"mb-4",children:["‚è≥ ",b]}),y==="email"?e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(A,{id:"email",type:"email",placeholder:"t√∫@correo.com",value:d,onChange:a=>S(a.target.value),required:!0,disabled:c})]}),e.jsx(h,{type:"submit",size:"lg",disabled:c,className:"w-full",children:"Continuar con Login Facial"})]}):e.jsx("div",{className:"space-y-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",children:e.jsx("img",{src:N,alt:"Foto capturada",className:"w-full h-auto max-h-[480px] mx-auto"})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(h,{onClick:z,variant:"outline",disabled:c,size:"lg",children:"üîÑ Tomar Otra Foto"}),e.jsx(h,{onClick:T,disabled:c,size:"lg",children:c?"‚è≥ Verificando...":"‚úÖ Verificar y Login"})]})]}):e.jsx(O,{onCapture:k,onCancel:I,disabled:c,buttonText:"üì∑ Capturar Foto",showCancel:!0})}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:y==="email"&&e.jsx(h,{onClick:()=>E("/login"),variant:"ghost",size:"sm",children:"‚Üê Volver a Login Normal"})})]})]})})}export{D as default};
//# sourceMappingURL=FaceLogin-BF3sdWNW.js.map
