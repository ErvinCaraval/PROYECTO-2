import{r as s,b as T,j as e,m as I,d as L}from"./index-BOaVjrce.js";import{B as u}from"./Button-D2tu_0bI.js";import{I as P}from"./Input-Cm1bFLR1.js";import{A as w}from"./Alert-BchDzBqE.js";import{F as B,o as $,g as N}from"./imageOptimizer-BDifxBkI.js";function J(){const[l,y]=s.useState(""),[p,o]=s.useState(""),[x,c]=s.useState(""),[i,g]=s.useState(!1),[f,d]=s.useState(null),[v,m]=s.useState(null),[j,h]=s.useState("email"),b=T(),C=async a=>{try{const t=await $(a,300,300,.6),n=N(a),r=N(t);console.log(`Imagen optimizada: ${n}KB ‚Üí ${r}KB (${Math.round((1-r/n)*100)}% reducci√≥n)`),d(t),m(t)}catch(t){console.error("Error optimizando imagen, usando original:",t),d(a),m(a)}},E=()=>{d(null),m(null),o(""),c("")},k=a=>{if(a.preventDefault(),!l){o("Por favor, ingresa tu email");return}o(""),h("capture")},S=async()=>{if(!f){o("Por favor, captura una foto primero");return}if(!l){o("Email requerido"),h("email");return}g(!0),o(""),c("");try{const a="http://localhost:5000",t=await fetch(`${a}/api/face/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:f,email:l})}),n=t.headers.get("content-type");if(!n||!n.includes("application/json")){const F=await t.text();throw console.error("Respuesta no es JSON:",F.substring(0,200)),new Error(`El servidor devolvi√≥ un error. Verifica que el backend est√© corriendo en ${a}`)}const r=await t.json();if(!t.ok)throw new Error(r.error||"Error en el login facial");if(r.success&&r.verified)if(r.customToken)await I(L,r.customToken),c("¬°Login facial exitoso! Redirigiendo..."),setTimeout(()=>{b("/dashboard")},1e3);else throw new Error("No se recibi√≥ token de autenticaci√≥n");else throw new Error(r.error||"Las caras no coinciden. Acceso denegado.")}catch(a){o(a.message||"Error al verificar la cara. Por favor, intenta de nuevo."),console.error("Error en login facial:",a)}finally{g(!1)}},z=()=>{h("email"),d(null),m(null),o(""),c("")};return e.jsx("div",{className:"container min-h-screen px-4 py-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"üîê Login Facial"}),e.jsx("p",{className:"text-white/70 mt-2",children:"Inicia sesi√≥n usando reconocimiento facial"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-6",children:[p&&e.jsx(w,{intent:"error",className:"mb-4",children:p}),x&&e.jsx(w,{intent:"success",className:"mb-4",children:x}),j==="email"?e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(P,{id:"email",type:"email",placeholder:"t√∫@correo.com",value:l,onChange:a=>y(a.target.value),required:!0,disabled:i})]}),e.jsx(u,{type:"submit",size:"lg",disabled:i,className:"w-full",children:"Continuar con Login Facial"})]}):e.jsx("div",{className:"space-y-4",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",children:e.jsx("img",{src:v,alt:"Foto capturada",className:"w-full h-auto max-h-[480px] mx-auto"})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(u,{onClick:E,variant:"outline",disabled:i,size:"lg",children:"üîÑ Tomar Otra Foto"}),e.jsx(u,{onClick:S,disabled:i,size:"lg",children:i?"Verificando...":"‚úÖ Verificar y Login"})]})]}):e.jsx(B,{onCapture:C,onCancel:z,disabled:i,buttonText:"üì∑ Capturar Foto",showCancel:!0})}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:j==="email"&&e.jsx(u,{onClick:()=>b("/login"),variant:"ghost",size:"sm",children:"‚Üê Volver a Login Normal"})})]})]})})}export{J as default};
//# sourceMappingURL=FaceLogin-xj1hNEeM.js.map
