{"version":3,"file":"GamePage-CTMMuQjw.js","sources":["../../src/services/voiceRecognitionService.js","../../src/components/VoiceAnswerButton.jsx","../../src/components/Question.jsx","../../src/components/Timer.jsx","../../src/pages/GamePage.jsx"],"sourcesContent":["\nimport { fetchWithRetry } from './api';\n\nclass AssemblyAIVoiceRecognitionService {\n  constructor() {\n    this.isRecording = false;\n    this.mediaRecorder = null;\n    this.audioChunks = [];\n    this.apiBase = (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) || import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n    this.stream = null;\n  }\n\n  isAvailable() {\n    return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia && window.MediaRecorder);\n  }\n\n  isListening() {\n    return this.isRecording;\n  }\n\n  async start() {\n    if (!this.isAvailable()) {\n      throw new Error('La grabaci√≥n de audio no est√° soportada en este navegador.');\n    }\n\n    if (this.isRecording) {\n      console.warn('AssemblyAI: La grabaci√≥n ya est√° en progreso.');\n      return;\n    }\n\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      this.mediaRecorder = new MediaRecorder(this.stream);\n      this.audioChunks = [];\n\n      this.mediaRecorder.ondataavailable = (event) => {\n        this.audioChunks.push(event.data);\n      };\n\n      this.mediaRecorder.onstart = () => {\n        this.isRecording = true;\n        console.log('AssemblyAI: Grabaci√≥n iniciada.');\n      };\n\n      this.mediaRecorder.start();\n    } catch (error) {\n      console.error('AssemblyAI: Error al iniciar la grabaci√≥n:', error);\n      throw new Error('No se pudo acceder al micr√≥fono. Por favor, verifica los permisos.');\n    }\n  }\n\n  stop() {\n    return new Promise((resolve, reject) => {\n      if (!this.mediaRecorder || !this.isRecording) {\n        return reject('No hay ninguna grabaci√≥n en progreso.');\n      }\n\n      this.mediaRecorder.onstop = async () => {\n        this.isRecording = false;\n        console.log('AssemblyAI: Grabaci√≥n detenida.');\n\n        const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });\n        const reader = new FileReader();\n\n        reader.onloadend = async () => {\n          const base64Audio = reader.result.split(',')[1];\n          \n          try {\n            console.log('AssemblyAI: Enviando audio al backend para transcripci√≥n (voice-interactions)...');\n            // Use the voice-interactions public endpoint which proxies to AssemblyAI.\n            // This avoids requiring an auth token here (the assemblyai route is authenticated).\n            console.log('üöÄ Enviando petici√≥n al backend...');\n            const response = await fetchWithRetry(`${this.apiBase}/voice-interactions/process-audio`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify({ audioBase64: base64Audio, mimeType: 'audio/webm' })\n            });\n            console.log('üì¶ Respuesta completa del backend:', response);\n\n            if (response.success) {\n              console.log('AssemblyAI: Transcripci√≥n recibida:', response.text);\n              resolve({ \n                transcript: response.text || '',\n                audioBase64: base64Audio,\n                audioMimeType: 'audio/webm',\n                assemblyAIResult: {\n                  success: true,\n                  text: response.text,\n                  confidence: response.confidence,\n                  language: response.language\n                }\n              });\n            } else {\n              console.error('AssemblyAI: Error en la transcripci√≥n:', response.error);\n              reject(new Error(response.error || 'Error en el servidor al transcribir el audio.'));\n            }\n          } catch (error) {\n            console.error('AssemblyAI: Error al enviar el audio al backend:', error);\n            reject(new Error('No se pudo conectar con el servidor para la transcripci√≥n.'));\n          }\n        };\n\n        reader.onerror = (error) => {\n            console.error('AssemblyAI: Error al convertir el audio a Base64:', error);\n            reject(new Error('Hubo un problema al procesar el audio grabado.'));\n        };\n\n        reader.readAsDataURL(audioBlob);\n      };\n      \n      this.mediaRecorder.stop();\n      if (this.stream) {\n        this.stream.getTracks().forEach(track => track.stop());\n        this.stream = null;\n      }\n    });\n  }\n\n  // This method is kept for compatibility with the old interface, but the flow will need to be adapted\n  // in the UI components (e.g., press and hold button to record).\n  async recognizeAnswer(questionOptions = []) {\n    if (this.isListening()) {\n      return this.stop();\n    } else {\n      await this.start();\n      // Indicate that listening has started. The UI will need to call stop() later.\n      return { isListening: true };\n    }\n  }\n\n  // Matcher function moved here from the old service to keep it consistent.\n  matchAnswer(transcript, questionOptions) {\n    if (!questionOptions || questionOptions.length === 0) {\n      return { option: transcript, index: -1, isValid: false };\n    }\n\n    // Normalize and clean transcript: lowercase, trim, remove common punctuation\n    let cleanTranscript = transcript.toLowerCase().trim().replace(/[.,/#!$%^&*;:{}=\\-_`~()]/g, \"\");\n    // Remove accents to more easily match words like \"opci√≥n\" -> \"opcion\"\n    try {\n      cleanTranscript = cleanTranscript.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    } catch (e) {\n      // normalize may not be supported in some very old environments; ignore if it fails\n    }\n    \n    // Remove common speech-to-text artifacts\n    cleanTranscript = cleanTranscript\n      .replace(/\\bah\\b/gi, 'a')    // \"ah\" -> \"a\"\n      .replace(/\\beh\\b/gi, 'e')    // \"eh\" -> \"e\"\n      .replace(/\\bbe\\b/gi, 'b')    // \"be\" -> \"b\"\n      .replace(/\\bce\\b/gi, 'c')    // \"ce\" -> \"c\"\n      .replace(/\\bde\\b/gi, 'd');   // \"de\" -> \"d\"\n\n    console.log('üßπ Transcript limpio para matching:', cleanTranscript);\n\n    // 1) Detect single-letter answers appearing anywhere (\"a\", \"b\", etc.) or after the word \"opcion/opci√≥n\"\n    // More flexible pattern that catches single letters even if they're part of small words\n    const letterAnywhere = cleanTranscript.match(/(?:\\bopcion\\b\\s*)?([a-d])(?:\\b|$)/);\n    if (letterAnywhere) {\n      const letter = letterAnywhere[1].toUpperCase();\n      const index = letter.charCodeAt(0) - 65;\n      if (index >= 0 && index < questionOptions.length) {\n        console.log('üìå Detectada letra de opci√≥n:', letter, '√≠ndice:', index);\n        return {\n          option: questionOptions[index],\n          index,\n          isValid: true\n        };\n      }\n    }\n\n    // 2) Position matches: \"primera\", \"segunda\", \"tercera\", \"cuarta\" and numeric words\n    const positionPatterns = [\n      /primera|primero|uno|1/,\n      /segunda|segundo|dos|2/,\n      /tercera|tercero|tres|3/,\n      /cuarta|cuarto|cuatro|4/\n    ];\n\n    for (let i = 0; i < positionPatterns.length && i < questionOptions.length; i++) {\n      if (positionPatterns[i].test(cleanTranscript)) {\n        return {\n          option: questionOptions[i],\n          index: i,\n          isValid: true\n        };\n      }\n    }\n\n    // 3) Partial text matches (if the transcript contains a chunk of the option text)\n    for (let i = 0; i < questionOptions.length; i++) {\n      const optionText = questionOptions[i].toLowerCase();\n      const normalizedOption = optionText.normalize ? optionText.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : optionText;\n      if (cleanTranscript.includes(normalizedOption)) {\n        return {\n          option: questionOptions[i],\n          index: i,\n          isValid: true\n        };\n      }\n    }\n\n    // No match found\n    return {\n      option: transcript,\n      index: -1,\n      isValid: false\n    };\n  }\n}\n\nconst assemblyAIVoiceService = new AssemblyAIVoiceRecognitionService();\nexport default assemblyAIVoiceService;\n","\nimport React, { useState, useRef } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport Button from './ui/Button';\nimport voiceRecognitionService from '../services/voiceRecognitionService'; // Using AssemblyAI service\n\nconst VoiceAnswerButton = ({ options, onAnswer, disabled = false }) => {\n  const { isVoiceModeEnabled } = useVoice();\n  const [isRecording, setIsRecording] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const isHeldRef = useRef(false); // To prevent firing mouseup after touch end\n    const cleanup = () => {\n      isHeldRef.current = false;\n      setIsRecording(false);\n      setIsProcessing(false);\n    };\n\n  if (!isVoiceModeEnabled || !voiceRecognitionService.isAvailable()) {\n    return null;\n  }\n\n  const handleRecordingStart = async () => {\n    if (disabled || isRecording || isProcessing) return;\n    isHeldRef.current = true;\n    setError('');\n    setSuccessMessage('');\n    try {\n        // Check for permission first\n        const permission = await navigator.mediaDevices.getUserMedia({ audio: true });\n        if (!permission) {\n          cleanup();\n          throw new Error('Se requiere permiso para usar el micr√≥fono.');\n        }\n      await voiceRecognitionService.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error('Error starting recording:', err);\n        cleanup();\n      setError(err.message || 'No se pudo iniciar la grabaci√≥n.');\n    }\n  };\n\n  const handleRecordingStop = async () => {\n    if (!isHeldRef.current) return; // Prevent accidental triggers\n    if (!isRecording) return;\n\n      cleanup();\n    setError('');\n      setIsProcessing(true);\n\n    try {\n      console.log('üé§ Deteniendo grabaci√≥n y enviando audio...');\n      const result = await voiceRecognitionService.stop();\n      console.log('üìù Resultado recibido:', result);\n      const { transcript, audioBase64, audioMimeType, assemblyAIResult } = result;\n\n      if (!transcript) {\n        throw new Error('No se detect√≥ ninguna voz.');\n      }\n      \n      setSuccessMessage(`Transcrito: \"${transcript}\"`);\n      console.log('üîç Intentando matchear respuesta:', transcript);\n      \n      const match = voiceRecognitionService.matchAnswer(transcript, options);\n      console.log('‚ú® Resultado del match:', match);\n\n      if (match.isValid) {\n        console.log('‚úÖ Respuesta v√°lida, llamando onAnswer con √≠ndice:', match.index);\n        onAnswer(match.index, audioBase64, assemblyAIResult, audioMimeType);\n        setSuccessMessage(`‚úÖ Respuesta reconocida: ${options[match.index]}`);\n      } else {\n        console.log('‚ùå No se pudo matchear la respuesta');\n        setError('No pude entender tu respuesta. Int√©ntalo de nuevo.');\n      }\n\n    } catch (err) {\n      console.error('Error stopping recording or processing:', err);\n      setError(err.message || 'Error al procesar el audio.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  \n  // Combine mouse and touch events\n  const buttonEventHandlers = {\n    onMouseDown: handleRecordingStart,\n    onMouseUp: handleRecordingStop,\n    onMouseLeave: handleRecordingStop, // Stop if mouse leaves button area while pressed\n    onTouchStart: handleRecordingStart,\n    onTouchEnd: handleRecordingStop,\n  };\n\n  // Use separate texts for desktop and mobile so the label fits on small screens\n  let buttonTextDesktop = \"üé§ Mant√©n presionado para hablar\";\n  let buttonTextMobile = \"üé§ Mant√©n\";\n  let buttonVariant = \"primary\";\n  let isPulsing = false;\n\n  if (isRecording) {\n    buttonTextDesktop = \"üé§ Escuchando...\";\n    buttonTextMobile = \"üé§ Escuchando\";\n    buttonVariant = \"secondary\";\n    isPulsing = true;\n  } else if (isProcessing) {\n    buttonTextDesktop = \"üîÑ Procesando...\";\n    buttonTextMobile = \"üîÑ Procesando\";\n    buttonVariant = \"secondary\";\n    isPulsing = true;\n  }\n\n  return (\n    <div className=\"space-y-2 w-full\">\n      <Button\n        {...buttonEventHandlers}\n        disabled={disabled || !isVoiceModeEnabled}\n        variant={buttonVariant}\n        className={`w-full touch-none ${isPulsing ? 'animate-pulse' : ''}`}>\n        <div className=\"flex items-center justify-center gap-2\">\n          {isRecording && <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\"></div>}\n          {/* Desktop: show full text on sm+ screens. Mobile: show shorter text on smaller screens */}\n          <span className=\"hidden sm:inline\">{buttonTextDesktop}</span>\n          <span className=\"inline sm:hidden\">{buttonTextMobile}</span>\n        </div>\n      </Button>\n      {successMessage && (\n        <div className=\"text-sm text-green-500 bg-green-500/10 border border-green-500/30 rounded p-2 text-center font-semibold animate-fade-in\">\n          {successMessage}\n        </div>\n      )}\n      {error && (\n        <div className=\"text-sm text-red-400 bg-red-500/20 p-2 rounded text-center font-semibold\">\n          {error}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default VoiceAnswerButton;\n","import React, { useEffect, useState } from 'react';\nimport { useAuth } from '../AuthContext';\nimport { motion } from 'framer-motion';\nimport { useVoice } from '../VoiceContext';\nimport Button from './ui/Button';\nimport VoiceAnswerButton from './VoiceAnswerButton';\nimport voiceRecognitionService from '../services/voiceRecognitionService';\n\nexport default function Question({ text, question, options, onSelect, selected, showResult = false, correctIndex = null, imageSrc }) {\n  const title = typeof text === 'string' && text.length > 0 ? text : question;\n  const { isVoiceModeEnabled, speak, stopSpeaking, isVoiceAvailable, voiceInteractionsService } = useVoice();\n  // Obtener el usuario autenticado (fallback a window.__USER__ si existiera)\n  const { user: authUser } = useAuth();\n  const user = authUser || ((typeof window !== 'undefined' && window.__USER__) || null);\n  const questionId = (question && (question.id || question.questionId)) || 'general';\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [hasReadQuestion, setHasReadQuestion] = useState(false);\n  const [autoReadError, setAutoReadError] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [recognitionError, setRecognitionError] = useState('');\n\n\n  // Reiniciar hasReadQuestion cada vez que cambie la pregunta o el √≠ndice\n  useEffect(() => {\n    setHasReadQuestion(false);\n  }, [title, options]);\n\n  // Auto-read question when it appears and voice mode is enabled\n  useEffect(() => {\n    if (isVoiceModeEnabled && title && Array.isArray(options) && options.length > 0 && !hasReadQuestion && !showResult) {\n      readQuestion().catch((err) => {\n        setAutoReadError('No se pudo leer la pregunta autom√°ticamente. Usa el bot√≥n para escuchar.');\n      });\n    }\n  }, [isVoiceModeEnabled, title, options, hasReadQuestion, showResult]);\n\n  const readQuestion = async () => {\n    if (!isVoiceModeEnabled || !title) return;\n    setIsSpeaking(true);\n    setHasReadQuestion(true);\n    setAutoReadError('');\n    try {\n      let toSpeak = `Pregunta: ${title}`;\n      if (Array.isArray(options) && options.length > 0) {\n        options.forEach((option, i) => {\n          toSpeak += `. Opci√≥n ${String.fromCharCode(65 + i)}: ${option}`;\n        });\n      }\n      await speak(toSpeak);\n    } catch (error) {\n      setAutoReadError('No se pudo leer la pregunta autom√°ticamente. Usa el bot√≥n para escuchar.');\n      console.error('Error reading question:', error);\n    } finally {\n      setIsSpeaking(false);\n    }\n  };\n\n  const readOption = async (index) => {\n    if (!isVoiceModeEnabled || !options[index]) return;\n    \n    try {\n      await speak(`Opci√≥n ${String.fromCharCode(65 + index)}: ${options[index]}`);\n    } catch (error) {\n      console.error('Error reading option:', error);\n    }\n  };\n\n  const stopReading = () => {\n    stopSpeaking();\n    setIsSpeaking(false);\n  };\n\n  const startVoiceRecognition = async () => {\n    if (!isVoiceModeEnabled || !voiceRecognitionService.isAvailable()) {\n      setRecognitionError('Reconocimiento de voz no disponible');\n      return;\n    }\n\n    if (selected !== null) {\n      setRecognitionError('Ya has seleccionado una respuesta');\n      return;\n    }\n\n    setIsListening(true);\n    setRecognitionError('');\n\n    try {\n      const result = await voiceRecognitionService.recognizeAnswer(options);\n\n      if (result.stopped) {\n        // Si el usuario dijo \"parar\", no mostrar error ni hablar\n        setIsListening(false);\n        return;\n      }\n\n      if (result.isValid && result.matchedIndex !== -1) {\n        // Log the voice answer con los IDs reales\n        if (voiceInteractionsService) {\n          // Log with a default duration (simulate 1s if not measured)\n          await voiceInteractionsService.logVoiceAnswer(\n            (user && user.uid) || undefined,\n            questionId || undefined,\n            result.transcript,\n            result.confidence,\n            result.matchedOption,\n            result.matchedIndex,\n            1000 // 1s duration for backend validation\n          );\n        }\n\n        // Confirm the recognized answer\n        await speak(`Respuesta reconocida: ${result.matchedOption}. ¬øEs correcta?`, {\n          action: 'voice_answer_confirmation',\n          questionId: 'question'\n        });\n\n        // Si la respuesta es √∫nica o autoSelected, seleccionar inmediatamente\n        if (result.autoSelected || options.length === 1) {\n          onSelect(result.matchedIndex);\n        } else {\n          // Auto-select the recognized answer after a short delay\n          setTimeout(() => {\n            onSelect(result.matchedIndex);\n          }, 2000);\n        }\n      } else {\n        setRecognitionError(`No se pudo reconocer la respuesta: \"${result.transcript}\". Intenta decir \"A\", \"B\", \"C\", \"D\" o \"primera opci√≥n\", \"segunda opci√≥n\", etc.`);\n        await speak(`No se pudo reconocer la respuesta. Intenta decir \"A\", \"B\", \"C\", \"D\" o \"primera opci√≥n\", \"segunda opci√≥n\", etc.`, {\n          action: 'voice_answer_error',\n          questionId: 'question'\n        });\n      }\n    } catch (error) {\n      setRecognitionError(error.message);\n      await speak(`Error en el reconocimiento: ${error.message}`, {\n        action: 'voice_recognition_error',\n        questionId: 'question'\n      });\n    } finally {\n      setIsListening(false);\n    }\n  };\n\n  const stopVoiceRecognition = () => {\n    voiceRecognitionService.stopRecognition();\n    setIsListening(false);\n    setRecognitionError('');\n  };\n  const getOptionClasses = (idx) => {\n    if (showResult) {\n      if (idx === correctIndex) return 'border-emerald-400/60 bg-emerald-500/10';\n      if (selected === idx && idx !== correctIndex) return 'border-red-400/60 bg-red-500/10';\n      return 'border-white/15 bg-white/5';\n    }\n    return selected === idx\n      ? 'border-bb-primary bg-white/10'\n      : 'border-white/20 bg-white/5 hover:bg-white/10';\n  };\n  return (\n    <div className=\"w-full flex flex-col items-center justify-center\">\n      <div className=\"w-full max-w-xl mx-auto bg-white/10 border border-white/20 rounded-2xl shadow-lg p-6 mb-6 flex flex-col items-center\">\n        {imageSrc && (\n          <div className=\"w-full mb-4 rounded-2xl border border-white/10 bg-black/20 overflow-hidden\">\n            <img\n              src={imageSrc}\n              alt=\"Imagen de la pregunta\"\n              className=\"w-full max-h-72 object-contain bg-black/40\"\n              loading=\"lazy\"\n            />\n          </div>\n        )}\n        <h2 className=\"text-xl md:text-2xl font-bold leading-snug break-words text-center mb-2\">{title}</h2>\n        {/* Voice Controls: bot√≥n siempre visible en modo voz */}\n        {isVoiceModeEnabled && (\n          <div className=\"w-full flex flex-col items-center gap-2 mt-2\">\n            <Button\n              variant=\"secondary\"\n              size=\"md\"\n              onClick={readQuestion}\n              title=\"Leer pregunta y opciones\"\n              className=\"px-3 py-2 text-base\"\n              disabled={isSpeaking}\n            >\n              üîä Leer pregunta y opciones\n            </Button>\n            {autoReadError && (\n              <div className=\"text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded p-2 text-center font-semibold\">\n                {autoReadError}\n              </div>\n            )}\n            {!isVoiceAvailable && (\n              <div className=\"text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded p-2 text-center font-semibold\">\n                La s√≠ntesis de voz no est√° disponible en tu navegador.\n              </div>\n            )}\n            {isVoiceAvailable && !showResult && (\n              <VoiceAnswerButton \n                options={options}\n                onAnswer={async (idx, audioBase64, assemblyResult, audioMimeType) => {\n                  // Primero registra la interacci√≥n para asegurar que quede en historial\n                  if (voiceInteractionsService && user && questionId) {\n                    await voiceInteractionsService.logVoiceAnswer(\n                      user.uid,\n                      questionId,\n                      options[idx],\n                      undefined, // confidence (no disponible aqu√≠)\n                      options[idx],\n                      idx,\n                      undefined, // duration (no disponible aqu√≠)\n                      audioBase64, // nuevo argumento opcional\n                      assemblyResult, // marca que AssemblyAI se us√≥ si success\n                      audioMimeType\n                    );\n                  }\n                  stopSpeaking();\n                  setIsListening(false);\n                  setRecognitionError('');\n                  onSelect(idx);\n                }}\n                disabled={selected !== null}\n              />\n            )}\n          </div>\n        )}\n      </div>\n      <motion.div\n        role=\"group\"\n        aria-label=\"Opciones de respuesta\"\n        className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 w-full max-w-2xl mx-auto\"\n        initial=\"hidden\" animate=\"show\"\n        variants={{ hidden: {}, show: { transition: { staggerChildren: 0.04 } } }}\n      >\n        {options.map((opt, idx) => (\n          <motion.button\n            key={idx}\n            onClick={() => onSelect(idx)}\n            disabled={selected !== null}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            whileHover={{ scale: selected === null ? 1.01 : 1 }}\n            whileTap={{ scale: selected === null ? 0.99 : 1 }}\n            transition={{ type: 'spring', stiffness: 160, damping: 14 }}\n            className={`col-span-1 text-left w-full rounded-xl border px-4 py-3 text-sm md:text-base transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bb-primary break-words ${getOptionClasses(idx)}`}\n            aria-pressed={selected === idx}\n            onFocus={() => {\n              if (isVoiceModeEnabled && !isSpeaking) {\n                readOption(idx);\n              }\n            }}\n          >\n            <span className=\"mr-2 inline-flex h-6 w-6 items-center justify-center rounded-md bg-white/10 text-sm font-semibold\">{String.fromCharCode(65 + idx)}</span>\n            <span className=\"align-middle\">{opt}</span>\n          </motion.button>\n        ))}\n      </motion.div>\n      {/* Recognition Error */}\n      {recognitionError && (\n        <div className=\"p-3 bg-red-500/10 border border-red-500/20 rounded-lg mt-4 max-w-xl mx-auto\">\n          <p className=\"text-sm text-red-400\">{recognitionError}</p>\n        </div>\n      )}\n    </div>\n  );\n}","import React, { useEffect, useState, useRef, useCallback, useMemo } from 'react'\nimport { motion } from 'framer-motion'\n\nexport default function Timer({ seconds = 20, onEnd, onTick }) {\n  const [time, setTime] = useState(seconds)\n  const intervalRef = useRef()\n  const onEndRef = useRef(onEnd)\n  const onTickRef = useRef(onTick)\n\n  // Mantener referencias actualizadas\n  useEffect(() => {\n    onEndRef.current = onEnd\n  }, [onEnd])\n\n  useEffect(() => {\n    onTickRef.current = onTick\n  }, [onTick])\n\n  // Resetear el timer cuando cambian los segundos\n  useEffect(() => {\n    setTime(seconds)\n    \n    // Limpiar interval anterior si existe\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current)\n    }\n    \n    // Solo iniciar el timer si los segundos son mayores a 0\n    if (seconds > 0) {\n      intervalRef.current = setInterval(() => {\n        setTime(prevTime => {\n          const newTime = prevTime - 1\n          \n          if (newTime <= 0) {\n            if (intervalRef.current) {\n              clearInterval(intervalRef.current)\n            }\n            if (onEndRef.current) {\n              onEndRef.current()\n            }\n          }\n          return newTime\n        })\n      }, 1000)\n    }\n    \n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current)\n      }\n    }\n  }, [seconds])\n\n  // Notificar cambios de tiempo\n  useEffect(() => {\n    if (onTickRef.current) {\n      onTickRef.current(time)\n    }\n  }, [time])\n\n  // Cleanup al desmontar el componente\n  useEffect(() => {\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current)\n      }\n    }\n  }, [])\n\n  const timerColor = useMemo(() => {\n    if (time <= 3) return { border: 'border-red-400/50', text: 'text-red-300', glow: 'shadow-[0_0_15px_rgba(239,68,68,0.4)]' }\n    if (time <= 6) return { border: 'border-amber-400/50', text: 'text-amber-300', glow: 'shadow-[0_0_15px_rgba(245,158,11,0.3)]' }\n    return { border: 'border-emerald-400/50', text: 'text-emerald-300', glow: 'shadow-[0_0_15px_rgba(16,185,129,0.2)]' }\n  }, [time])\n\n  const percentage = (time / seconds) * 100\n\n  return (\n    <motion.div \n      className=\"text-center\"\n      initial={{ scale: 0.9, opacity: 0 }}\n      animate={{ scale: 1, opacity: 1 }}\n      transition={{ type: 'spring', stiffness: 200, damping: 20 }}\n    >\n      <div className=\"relative w-20 h-20 mx-auto\">\n        {/* Background circle */}\n        <svg className=\"absolute inset-0 w-full h-full -rotate-90\" viewBox=\"0 0 100 100\">\n          <circle\n            cx=\"50\"\n            cy=\"50\"\n            r=\"45\"\n            fill=\"none\"\n            stroke=\"rgba(255, 255, 255, 0.1)\"\n            strokeWidth=\"3\"\n          />\n          {/* Progress circle */}\n          <motion.circle\n            cx=\"50\"\n            cy=\"50\"\n            r=\"45\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"3\"\n            strokeDasharray={`${2 * Math.PI * 45}`}\n            strokeDashoffset={useMemo(() => 2 * Math.PI * 45 * (1 - percentage / 100), [percentage])}\n            className={timerColor.text}\n            strokeLinecap=\"round\"\n            style={{ transition: 'stroke-dashoffset 0.3s ease-out' }}\n          />\n        </svg>\n\n        {/* Timer value */}\n        <motion.div\n          className={`absolute inset-0 flex items-center justify-center font-bold text-3xl ${timerColor.text} ${timerColor.glow}`}\n          key={time}\n          initial={{ scale: 1.2, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          transition={{ duration: 0.2 }}\n        >\n          {time}\n        </motion.div>\n      </div>\n\n      <motion.span \n        className=\"mt-3 block text-xs text-white/60 font-medium\"\n        animate={{ opacity: time <= 3 ? [1, 0.7, 1] : 1 }}\n        transition={{ repeat: time <= 3 ? Infinity : 0, duration: 0.6 }}\n      >\n        {time === 0 ? '¬°Tiempo!' : 'segundos'}\n      </motion.span>\n    </motion.div>\n  )\n}","import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../AuthContext';\nimport { useVoice } from '../VoiceContext';\nimport { getSocket } from '../services/socket';\nimport Question from '../components/Question';\nimport Timer from '../components/Timer';\nimport Ranking from '../components/Ranking';\nimport { Card, CardBody, CardHeader } from '../components/ui/Card';\nimport Alert from '../components/ui/Alert';\n\nexport default function GamePage() {\n  const [questionTimeout, setQuestionTimeout] = useState(false);\n  const { gameId } = useParams();\n  const { user } = useAuth();\n  const { isVoiceModeEnabled, speak, voiceInteractionsService } = useVoice();\n  const [question, setQuestion] = useState(null);\n  const [questionIndex, setQuestionIndex] = useState(0);\n  const [totalQuestions, setTotalQuestions] = useState(0);\n  // Referencia reactiva para totalQuestions\n  const totalQuestionsRef = useRef(totalQuestions);\n  useEffect(() => { totalQuestionsRef.current = totalQuestions; }, [totalQuestions]);\n  const [selected, setSelected] = useState(null);\n  // Referencia reactiva para selected\n  const selectedRef = useRef(selected);\n  useEffect(() => { selectedRef.current = selected; }, [selected]);\n  const [players, setPlayers] = useState([]);\n  const [showResult, setShowResult] = useState(false);\n  const [result, setResult] = useState(null);\n  const [timerKey, setTimerKey] = useState(0);\n  const [, setTimeLeft] = useState(10);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    (async () => {\n      const socket = await getSocket();\n      // Solicitar la primera pregunta al conectar\n      if (user && gameId) {\n        socket.emit('requestQuestion', { gameId });\n        console.log('[GamePage] Emitiendo requestQuestion:', { gameId });\n      }\n    })();\n    setTimeout(() => {\n      if (!question) setQuestionTimeout(true);\n    }, 5000);\n\n    if (!user) return;\n    const setup = async () => {\n      const socket = await getSocket();\n      if (!socket.connected) {\n        console.log('[GamePage] Intentando conectar socket...');\n        socket.connect();\n      }\n      function onConnect() {\n        console.log('[GamePage] Socket conectado:', socket.id);\n      }\n      function onNewQuestion({ question, index, timeout }) {\n        console.log('[GamePage] Evento newQuestion recibido:', question);\n        if (!Array.isArray(question.options)) {\n          question.options = [];\n        }\n        setQuestion({\n          ...question,\n          options: [...question.options],\n        });\n        setQuestionIndex(index);\n        setSelected(null);\n        setShowResult(false);\n        const questionTimeout = typeof timeout === 'number' ? timeout : (isVoiceModeEnabled ? 120 : 10);\n        setTimeLeft(questionTimeout);\n        setTimerKey(prev => prev + 1);\n        // Forzar lectura de la pregunta y opciones aqu√≠ tambi√©n\n        if (\n          isVoiceModeEnabled &&\n          user &&\n          question &&\n          Array.isArray(question.options) &&\n          question.options.length > 0 &&\n          question.text\n        ) {\n          const tq = totalQuestionsRef.current || '?';\n          let toSpeak = `Pregunta ${index + 1} de ${tq}. ${question.text}`;\n          question.options.forEach((opt, i) => {\n            toSpeak += `. Opci√≥n ${String.fromCharCode(65 + i)}: ${opt}`;\n          });\n          speak(toSpeak, {\n            action: 'new_question_full',\n            questionId: question.id || `question_${index}`,\n            metadata: {\n              questionIndex: index,\n              totalQuestions: tq,\n              gameId\n            }\n          });\n        }\n      }\n      function onAnswerResult({ correctAnswerIndex, explanation, players }) {\n        console.log('[GamePage] Evento answerResult recibido:', { correctAnswerIndex, explanation, players });\n        setShowResult(true);\n        setResult({ correctAnswerIndex, explanation });\n        setPlayers(players);\n        // Feedback de voz: solo decir si es correcta o incorrecta\n        if (isVoiceModeEnabled && user) {\n          const userSelected = selectedRef.current;\n          if (userSelected !== null && typeof correctAnswerIndex === 'number') {\n            let resultMsg = userSelected === correctAnswerIndex ? '¬°Respuesta correcta!' : 'Respuesta incorrecta.';\n            speak(resultMsg, {\n              action: 'answer_result',\n              questionId: question?.id || `question_${questionIndex}`,\n              metadata: {\n                isCorrect: userSelected === correctAnswerIndex,\n                selectedIndex: userSelected,\n                correctIndex: correctAnswerIndex,\n                explanation\n              }\n            });\n          }\n        }\n      }\n      function onGameFinished({ players }) {\n        console.log('[GamePage] Evento gameFinished recibido:', players);\n        if (isVoiceModeEnabled && user) {\n          const userPlayer = players.find(p => p.uid === user.uid);\n          const position = players.findIndex(p => p.uid === user.uid) + 1;\n          const totalPlayers = players.length;\n          speak(`¬°Juego terminado! Obtuviste el puesto ${position} de ${totalPlayers} jugadores.`, {\n            action: 'game_finished',\n            questionId: 'game',\n            metadata: {\n              position,\n              totalPlayers,\n              score: userPlayer?.score || 0\n            }\n          });\n        }\n        navigate(`/summary/${gameId}`, { state: { players } });\n      }\n      function onGameStarted({ questionsCount }) {\n        console.log('[GamePage] Evento gameStarted recibido:', questionsCount);\n        setTotalQuestions(questionsCount);\n        if (isVoiceModeEnabled && user) {\n          speak(`¬°Juego iniciado! Tendr√°s ${questionsCount} preguntas para responder.`, {\n            action: 'game_started',\n            questionId: 'game',\n            metadata: {\n              questionsCount,\n              gameId\n            }\n          });\n        }\n        (async () => {\n          const socket = await getSocket();\n          socket.emit('requestQuestion', { gameId });\n          console.log('[GamePage] Solicitud de primera pregunta tras gameStarted:', { gameId });\n        })();\n      }\n      socket.on('connect', onConnect);\n      socket.on('newQuestion', onNewQuestion);\n      socket.on('answerResult', onAnswerResult);\n      socket.on('gameFinished', onGameFinished);\n      socket.on('gameStarted', onGameStarted);\n    };\n    setup();\n    return () => {\n      (async () => {\n        const socket = await getSocket();\n        socket.off('connect');\n        socket.off('newQuestion');\n        socket.off('answerResult');\n        socket.off('gameFinished');\n        socket.off('gameStarted');\n      })();\n    };\n  }, [user, gameId, navigate]);\n\n  // EFECTO: Asistente de voz SIEMPRE lee la pregunta y opciones cuando cambia questionIndex o question\n  useEffect(() => {\n    if (\n      isVoiceModeEnabled &&\n      user &&\n      question &&\n      Array.isArray(question.options) &&\n      question.options.length > 0 &&\n      question.text\n    ) {\n      const tq = totalQuestionsRef.current || '?';\n      let toSpeak = `Pregunta ${questionIndex + 1} de ${tq}. ${question.text}`;\n      question.options.forEach((opt, i) => {\n        toSpeak += `. Opci√≥n ${String.fromCharCode(65 + i)}: ${opt}`;\n      });\n      speak(toSpeak, {\n        action: 'new_question_full',\n        questionId: question.id || `question_${questionIndex}`,\n        metadata: {\n          questionIndex,\n          totalQuestions: tq,\n          gameId\n        }\n      });\n    }\n  }, [questionIndex, question, isVoiceModeEnabled, user, speak, gameId]);\n\n  const questionRef = useRef(question);\n  questionRef.current = question;\n\n  const handleSelect = useCallback((idx) => {\n    if (selected !== null) return; // Prevent multiple selections\n    setSelected(idx);\n    // Enviar tambi√©n el valor de la opci√≥n seleccionada\n    const answerValue = questionRef.current && Array.isArray(questionRef.current.options) ? questionRef.current.options[idx] : undefined;\n    (async () => {\n      const socket = await getSocket();\n      socket.emit('submitAnswer', { gameId, uid: user.uid, answerIndex: idx, answerValue });\n    })();\n  }, [gameId, user, selected]);\n\n  const handleTimerEnd = useCallback(() => {\n    if (selected === null) {\n      (async () => {\n        const socket = await getSocket();\n        socket.emit('submitAnswer', { gameId, uid: user.uid, answerIndex: null, answerValue: null });\n      })();\n    }\n  }, [gameId, user, selected]);\n\n  // Voice mode timer warning\n  const handleTimerWarning = useCallback((timeLeft) => {\n    if (isVoiceModeEnabled && user && timeLeft <= 3 && timeLeft > 0) {\n      speak(`¬°Atenci√≥n! Te quedan ${timeLeft} segundos para responder.`, {\n        action: 'timer_warning',\n        questionId: question?.id || `question_${questionIndex}`,\n        metadata: { timeLeft }\n      });\n    }\n  }, [isVoiceModeEnabled, user, question, questionIndex, speak]);\n\n    const getOptionColor = (index) => {\n     if (!showResult) {\n      return selected === index ? 'selected' : '';\n    }\n    \n     if (index === result.correctAnswerIndex) {\n      return 'correct';\n   }\n    \n    if (selected === index && index !== result.correctAnswerIndex) {\n       return 'incorrect';\n     }\n    \n     return '';\n  };\n\n  const getPlayerRank = () => {\n    const sortedPlayers = [...players].sort((a, b) => b.score - a.score);\n    const playerIndex = sortedPlayers.findIndex(p => p.uid === user.uid);\n    return playerIndex + 1;\n  };\n\n  return (\n    <div className=\"container min-h-screen px-4 py-4 md:py-6 grid gap-4 md:gap-6 lg:grid-cols-[2fr_1fr]\">\n      <header className=\"flex items-start md:items-end justify-between gap-3 md:gap-4 lg:col-span-2\">\n        <div className=\"min-w-0\">\n          <h2 className=\"text-xl md:text-2xl font-bold\">üéØ Juego de Preguntas</h2>\n          <div className=\"mt-2 flex items-center gap-3 md:gap-4\">\n            <span className=\"text-xs md:text-sm text-white/80 whitespace-nowrap\">Pregunta {questionIndex + 1} de {totalQuestions || '?'}</span>\n            <div className=\"h-2 w-32 md:w-48 rounded-full bg-white/10\">\n              <div className=\"h-2 rounded-full bg-gradient-to-r from-bb-primary to-bb-accent\" style={{ width: `${((questionIndex + 1) / (totalQuestions || 1)) * 100}%` }} />\n            </div>\n          </div>\n        </div>\n        <div className=\"text-right shrink-0\">\n          <div className=\"text-lg md:text-xl font-bold\">#{getPlayerRank()}</div>\n          <div className=\"text-[10px] md:text-xs text-white/70\">Tu posici√≥n</div>\n          {isVoiceModeEnabled && (\n            <button\n              className=\"mt-2 px-3 py-2 rounded-md text-xs md:text-sm bg-white/10 hover:bg-white/20 border border-white/20\"\n              onClick={() => {\n                const parts = []\n                parts.push('Est√°s en la p√°gina de juego de preguntas.')\n                parts.push(`Progreso: pregunta ${questionIndex + 1} de ${totalQuestions || 'desconocido'}.`)\n                parts.push('A la izquierda est√° la tarjeta con la pregunta y las opciones. Usa las teclas o el rat√≥n para seleccionar tu respuesta.')\n                parts.push('A la derecha ver√°s el temporizador de la pregunta.')\n                parts.push('M√°s abajo, se mostrar√° si tu respuesta fue correcta y la explicaci√≥n, cuando est√© disponible.')\n                parts.push('A la derecha de la p√°gina est√° el ranking con la puntuaci√≥n de los jugadores.')\n                speak(parts.join(' '), { action: 'page_guide', questionId: 'game', metadata: { gameId } })\n              }}\n            >\n              üõà Explicar p√°gina\n            </button>\n          )}\n        </div>\n      </header>\n\n      <main className=\"space-y-4\">\n        {question && (\n          <Card className=\"transition hover:shadow-glow\">\n            <CardBody className=\"space-y-4 pt-4\">\n              <div className=\"flex items-start justify-between gap-3 md:gap-4\">\n                <div className=\"min-w-0 flex-1\">\n                  <Question\n                    text={question.text}\n                    question={question.question}\n                    options={question.options}\n                    onSelect={handleSelect}\n                    selected={selected}\n                    showResult={showResult}\n                    correctIndex={result?.correctAnswerIndex ?? null}\n                    imageSrc={question.imageBase64 || question.imageUrl}\n                  />\n                </div>\n                <div className=\"shrink-0 pt-1\">\n                  <Timer\n                    key={timerKey}\n                    seconds={selected === null ? (typeof timeLeft === 'number' ? timeLeft : (isVoiceModeEnabled ? 120 : 10)) : 0}\n                    onEnd={handleTimerEnd}\n                    onTick={(timeLeft) => {\n                      setTimeLeft(timeLeft);\n                      handleTimerWarning(timeLeft);\n                    }}\n                  />\n                </div>\n              </div>\n              {showResult && result && (\n                <Alert intent=\"info\">\n                  <div className=\"font-semibold mb-1\">‚úÖ ¬°Respuesta revelada!</div>\n                  <div><strong>Correcta:</strong> {question.options[result.correctAnswerIndex]}</div>\n                  {result.explanation && (\n                    <div className=\"mt-2 text-white/90\"><strong>Explicaci√≥n:</strong> {result.explanation}</div>\n                  )}\n                </Alert>\n              )}\n            </CardBody>\n          </Card>\n        )}\n\n        {!question && !questionTimeout && (\n          <div className=\"flex items-center gap-3 text-white/80\">\n            <div className=\"loading-spinner\" />\n            <p>Esperando la siguiente pregunta...</p>\n          </div>\n        )}\n        {!question && questionTimeout && (\n          <Alert intent=\"error\">No se encontraron preguntas para este tema. Verifica que hayas generado preguntas y que el tema coincida exactamente.</Alert>\n        )}\n      </main>\n\n      <aside>\n        <Card>\n          <CardHeader className=\"pb-2\"><h3 className=\"text-xl md:text-2xl font-semibold\">Ranking</h3></CardHeader>\n          <CardBody>\n            <Ranking players={players} />\n          </CardBody>\n        </Card>\n      </aside>\n    </div>\n  );\n}\n"],"names":["AssemblyAIVoiceRecognitionService","event","error","resolve","reject","audioBlob","reader","base64Audio","response","fetchWithRetry","track","questionOptions","transcript","cleanTranscript","letterAnywhere","letter","index","positionPatterns","i","optionText","normalizedOption","assemblyAIVoiceService","VoiceAnswerButton","options","onAnswer","disabled","isVoiceModeEnabled","useVoice","isRecording","setIsRecording","useState","isProcessing","setIsProcessing","setError","successMessage","setSuccessMessage","isHeldRef","useRef","cleanup","voiceRecognitionService","handleRecordingStart","err","handleRecordingStop","result","audioBase64","audioMimeType","assemblyAIResult","match","buttonEventHandlers","buttonTextDesktop","buttonTextMobile","buttonVariant","isPulsing","jsxs","jsx","Button","Question","text","question","onSelect","selected","showResult","correctIndex","imageSrc","title","speak","stopSpeaking","isVoiceAvailable","voiceInteractionsService","authUser","useAuth","user","questionId","isSpeaking","setIsSpeaking","hasReadQuestion","setHasReadQuestion","autoReadError","setAutoReadError","isListening","setIsListening","recognitionError","setRecognitionError","useEffect","readQuestion","toSpeak","option","readOption","getOptionClasses","idx","assemblyResult","motion","opt","Timer","seconds","onEnd","onTick","time","setTime","intervalRef","onEndRef","onTickRef","prevTime","newTime","timerColor","useMemo","percentage","GamePage","questionTimeout","setQuestionTimeout","gameId","useParams","setQuestion","questionIndex","setQuestionIndex","totalQuestions","setTotalQuestions","totalQuestionsRef","setSelected","selectedRef","players","setPlayers","setShowResult","setResult","timerKey","setTimerKey","setTimeLeft","navigate","useNavigate","socket","getSocket","onConnect","onNewQuestion","timeout","prev","tq","onAnswerResult","correctAnswerIndex","explanation","userSelected","onGameFinished","userPlayer","p","position","totalPlayers","onGameStarted","questionsCount","questionRef","handleSelect","useCallback","answerValue","handleTimerEnd","handleTimerWarning","timeLeft","getPlayerRank","a","b","parts","Card","CardBody","Alert","CardHeader","Ranking"],"mappings":"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"}