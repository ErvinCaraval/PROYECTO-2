{"version":3,"file":"AIQuestionGenerator-80P0KPaB.js","sources":["../../src/components/ManualQuestionForm.jsx","../../src/components/ImageAnalysisQuestionCreator.jsx","../../src/components/ObjectDetectionQuestionCreator.jsx","../../src/components/ui/Modal.jsx","../../src/components/AIQuestionGenerator.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\n\nconst ManualQuestionForm = ({ topics, onQuestionCreated, onCancel }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [formData, setFormData] = useState({\n    question: '',\n    options: ['', '', '', ''],\n    correctIndex: 0,\n    selectedTopic: topics[0] || ''\n  });\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [successMessage, setSuccessMessage] = useState('');\n\n  const handleOptionChange = (idx, value) => {\n    setFormData(prev => ({\n      ...prev,\n      options: prev.options.map((opt, i) => i === idx ? value : opt)\n    }));\n  };\n\n  const validateForm = useCallback(() => {\n    if (!formData.question.trim()) {\n      return 'La pregunta es requerida';\n    }\n    if (formData.options.some(opt => !opt.trim())) {\n      return 'Todas las opciones son requeridas';\n    }\n    return '';\n  }, [formData]);\n\n  useEffect(() => {\n    const validationError = validateForm();\n    setError(validationError);\n  }, [formData, user, validateForm]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    const validationError = validateForm();\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    setSuccessMessage('');\n    try {\n      // Build payload and hand off to parent for saving. Parent will perform the network request.\n      const payload = {\n        text: formData.question,\n        options: formData.options,\n        correctAnswerIndex: formData.correctIndex,\n        category: formData.selectedTopic,\n        explanation: ''\n      };\n\n      setSuccessMessage('Guardando...');\n      if (onQuestionCreated) {\n        const result = await Promise.resolve(onQuestionCreated(payload));\n        // If parent returns the saved question, show its text in the success message\n        const savedText = result && result.text ? result.text : payload.text;\n        setSuccessMessage(`Pregunta creada: \"${savedText}\"`);\n      } else {\n        setSuccessMessage('¬°Pregunta preparada!');\n      }\n    } catch (err) {\n      console.error('Error al preparar la pregunta:', err);\n      setError(err.message || 'Error al guardar la pregunta');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n  <form className=\"grid gap-4\" onSubmit={handleSubmit}>\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              const parts = [];\n              parts.push('Formulario para escribir preguntas manualmente.');\n              parts.push('Campo Tema: selecciona el tema de la pregunta.');\n              parts.push('Campo Pregunta: escribe el texto de la pregunta.');\n              parts.push('Opciones: escribe las posibles respuestas. Marca cu√°l es la correcta con el bot√≥n de opci√≥n.');\n              parts.push('Bot√≥n Atr√°s: vuelve al generador de preguntas.');\n              parts.push('Bot√≥n Guardar: guarda la pregunta actual.');\n              await speak(parts.join(' '), { action: 'page_guide', questionId: 'manual_question_form', force: true });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n      \n      <div className=\"p-4 bg-gradient-to-br from-bb-primary/20 to-bb-primary/10 rounded-xl border-2 border-bb-primary/40 mb-4\">\n        <h3 className=\"text-lg font-bold mb-1\">‚úèÔ∏è Escribe tu pregunta</h3>\n        <p className=\"text-xs text-white/70\">Rellena todos los campos correctamente</p>\n      </div>\n\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n      {/* Tema */}\n      <div className=\"grid gap-2\">\n        <label className=\"text-sm font-semibold text-white\" htmlFor=\"topic-select\">Tema *</label>\n        <select\n          id=\"topic-select\"\n          value={formData.selectedTopic}\n          onChange={e => setFormData(prev => ({ ...prev, selectedTopic: e.target.value }))}\n          disabled={loading}\n          className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none transition\"\n        >\n          {topics.map(t => <option key={t} value={t}>{t}</option>)}\n        </select>\n      </div>\n\n      {/* Pregunta */}\n      <div className=\"grid gap-2\">\n        <label className=\"text-sm font-semibold text-white\" htmlFor=\"question-input\">Pregunta *</label>\n        <Input\n          id=\"question-input\"\n          type=\"text\"\n          value={formData.question}\n          onChange={e => setFormData(prev => ({ ...prev, question: e.target.value }))}\n          disabled={loading}\n          placeholder=\"Escribe la pregunta aqu√≠...\"\n          required\n        />\n      </div>\n\n      {/* Opciones */}\n      <div className=\"grid gap-3\">\n        <div className=\"flex items-center justify-between\">\n          <label className=\"text-sm font-semibold text-white\">Opciones de respuesta *</label>\n          <span className=\"text-xs text-white/60\">4 opciones requeridas</span>\n        </div>\n        <div className=\"grid gap-3 p-3 bg-white/5 rounded-lg border border-white/10\">\n          {formData.options.map((opt, idx) => (\n            <div key={idx} className=\"flex items-center gap-3\">\n              <span className=\"font-bold text-bb-primary text-lg min-w-[2rem]\">{String.fromCharCode(65 + idx)})</span>\n              <Input\n                type=\"text\"\n                value={opt}\n                onChange={e => handleOptionChange(idx, e.target.value)}\n                disabled={loading}\n                placeholder=\"Escribe la opci√≥n...\"\n                className=\"flex-1\"\n                required\n              />\n              <label className=\"inline-flex items-center gap-2 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"correctOption\"\n                  checked={formData.correctIndex === idx}\n                  onChange={() => setFormData(prev => ({ ...prev, correctIndex: idx }))}\n                  disabled={loading}\n                  className=\"h-5 w-5 accent-bb-primary cursor-pointer\"\n                />\n                <span className=\"text-xs text-white/70 whitespace-nowrap\">Correcta</span>\n              </label>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Resumen de respuesta correcta */}\n      <div className=\"p-3 bg-bb-primary/15 rounded-lg border border-bb-primary/40\">\n        <p className=\"text-xs text-white/70 mb-1\">Respuesta correcta seleccionada:</p>\n        <p className=\"text-sm font-semibold text-white\">\n          {String.fromCharCode(65 + formData.correctIndex)}) {formData.options[formData.correctIndex] || '(sin llenar)'}\n        </p>\n      </div>\n\n      {/* Botones de acci√≥n */}\n      <div className=\"flex gap-3 pt-2\">\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          onClick={onCancel}\n          disabled={loading}\n          className=\"flex-1\"\n          onFocus={() => isVoiceModeEnabled && speak('Atr√°s: vuelve al generador de preguntas.', { force: true })}\n          onMouseEnter={() => isVoiceModeEnabled && speak('Atr√°s: vuelve al generador de preguntas.', { force: true })}\n        >\n          Atr√°s\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={loading}\n          className=\"flex-1\"\n          onFocus={() => isVoiceModeEnabled && speak('Guardar: guarda la pregunta actual.', { force: true })}\n          onMouseEnter={() => isVoiceModeEnabled && speak('Guardar: guarda la pregunta actual.', { force: true })}\n        >\n          {loading ? '‚è≥ Guardando‚Ä¶' : '‚úì Guardar'}\n        </Button>\n      </div>\n    </form>\n  );\n};\n\nexport default ManualQuestionForm;\n","import React, { useState, useRef } from 'react';\nimport { useAuth } from '../AuthContext';\nimport { useVoice } from '../VoiceContext';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\nimport Spinner from './ui/Spinner';\nimport Badge from './ui/Badge';\n\nconst MAX_IMAGE_SIZE = 4 * 1024 * 1024; // 4MB\nconst ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\n// Imagen que se guarda dentro de la pregunta (y se replica en el documento de la partida)\n// Mantenerla peque√±a evita que los documentos de Firestore superen el l√≠mite de 1 MB.\nconst MAX_GAME_IMAGE_BYTES = 80 * 1024; // ~80KB por imagen\n\nconst INITIAL_OPTIONS = ['', '', '', ''];\n\nconst buildUniqueList = (items = []) => {\n  const seen = new Set();\n  return items.filter(item => {\n    const key = item?.toLowerCase?.() || item;\n    if (!key || seen.has(key)) return false;\n    seen.add(key);\n    return true;\n  });\n};\n\nfunction capitalize(text = '') {\n  if (!text) return '';\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n\nconst getBase64PayloadBytes = (base64 = '') => {\n  if (!base64 || typeof base64 !== 'string') return 0;\n  const payload = base64.includes(',') ? base64.split(',')[1] : base64;\n  // F√≥rmula est√°ndar para estimar bytes reales a partir de base64\n  return Math.floor((payload.length * 3) / 4);\n};\n\nconst loadImageElement = (dataUrl) =>\n  new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = dataUrl;\n  });\n\n// Reduce resoluci√≥n/calidad hasta que el base64 quede por debajo de maxBytes\nconst downscaleBase64 = async (dataUrl, maxBytes, maxDimension = 640) => {\n  const image = await loadImageElement(dataUrl);\n  const scale = Math.min(1, maxDimension / Math.max(image.width, image.height));\n\n  const canvas = document.createElement('canvas');\n  canvas.width = Math.max(1, Math.round(image.width * scale));\n  canvas.height = Math.max(1, Math.round(image.height * scale));\n  const ctx = canvas.getContext('2d');\n  ctx.drawImage(image, 0, 0, canvas.width, canvas.height);\n\n  const qualities = [0.8, 0.7, 0.6, 0.5, 0.4];\n  for (const quality of qualities) {\n    const output = canvas.toDataURL('image/jpeg', quality);\n    if (getBase64PayloadBytes(output) <= maxBytes) {\n      return output;\n    }\n  }\n  return canvas.toDataURL('image/jpeg', 0.35);\n};\n\nconst ensureBase64UnderLimit = async (dataUrl, maxBytes = MAX_GAME_IMAGE_BYTES) => {\n  if (!dataUrl) return dataUrl;\n  if (getBase64PayloadBytes(dataUrl) <= maxBytes) {\n    return dataUrl;\n  }\n  try {\n    return await downscaleBase64(dataUrl, maxBytes);\n  } catch {\n    // Si algo falla al comprimir, devolvemos la original (peor de los casos)\n    return dataUrl;\n  }\n};\n\nconst ImageAnalysisQuestionCreator = ({ topics = [], onQuestionCreated, onCancel }) => {\n  const { user } = useAuth();\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const fileInputRef = useRef(null);\n  const apiBase =\n    (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) ||\n    import.meta.env.VITE_API_URL ||\n    'http://localhost:5000/api';\n\n  const [selectedTopic, setSelectedTopic] = useState(topics[0] || '');\n  const [imageFile, setImageFile] = useState(null);\n  const [imagePreview, setImagePreview] = useState('');\n  const [analysis, setAnalysis] = useState(null);\n  const [questionSuggestions, setQuestionSuggestions] = useState(null);\n  const [questionDraft, setQuestionDraft] = useState({\n    text: '',\n    options: [...INITIAL_OPTIONS],\n    correctIndex: 0,\n    explanation: '',\n    imageBase64: ''\n  });\n  const [analyzing, setAnalyzing] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const [justSaved, setJustSaved] = useState(false);\n\n  const validateFile = (file) => {\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return 'Formato inv√°lido. Usa JPG, PNG o WebP.';\n    }\n    if (file.size > MAX_IMAGE_SIZE) {\n      return 'La imagen debe ser menor a 4MB.';\n    }\n    return null;\n  };\n\n  const readFileAsDataURL = (file) => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = (event) => resolve(event.target.result);\n      reader.onerror = () => reject(new Error('No se pudo leer la imagen'));\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const handleFileChange = async (event) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const validationError = validateFile(file);\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    try {\n      const preview = await readFileAsDataURL(file);\n      // Comprimir la imagen para que sea segura de guardar/reutilizar en partidas\n      const optimized = await ensureBase64UnderLimit(preview);\n\n      setImageFile(file);\n      setImagePreview(preview);\n      setAnalysis(null);\n      setQuestionSuggestions(null);\n      setQuestionDraft({\n        text: '',\n        options: [...INITIAL_OPTIONS],\n        correctIndex: 0,\n        explanation: '',\n        imageBase64: optimized\n      });\n      setError('');\n      setSuccessMessage('');\n      setJustSaved(false);\n      if (isVoiceModeEnabled) {\n        speak('Imagen seleccionada. Ahora pulsa analizar imagen para obtener una sugerencia de pregunta.', {\n          force: false,\n          action: 'image_selected'\n        });\n      }\n    } catch (err) {\n      setError(err.message);\n      if (isVoiceModeEnabled) {\n        speak(`Error al leer la imagen: ${err.message}`, {\n          force: false,\n          action: 'image_error'\n        });\n      }\n    }\n  };\n\n  const analyzeImage = async () => {\n    if (!apiBase) {\n      setError('Configura la variable VITE_API_URL para usar esta funci√≥n.');\n      return;\n    }\n    if (!imageFile || !imagePreview) {\n      setError('Selecciona una imagen v√°lida antes de analizar.');\n      return;\n    }\n\n    setAnalyzing(true);\n    setError('');\n    setSuccessMessage('');\n\n    try {\n      const token = user && user.getIdToken ? await user.getIdToken() : null;\n      const response = await fetch(`${apiBase}/vision/analyze-image`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token ? { Authorization: `Bearer ${token}` } : {})\n        },\n        body: JSON.stringify({\n          imageBase64: imagePreview,\n          mimeType: imageFile.type,\n          language: 'es'\n        })\n      });\n      const data = await response.json();\n      if (!response.ok || !data.success) {\n        throw new Error(data.error || 'Error analizando la imagen');\n      }\n      setAnalysis(data.analysis);\n      setQuestionSuggestions(data.questionSuggestions || null);\n      // Usar siempre la versi√≥n comprimida que ya guardamos en questionDraft\n      autoPopulateDraft(\n        data.analysis,\n        data.questionSuggestions,\n        questionDraft.imageBase64 || imagePreview\n      );\n      setSuccessMessage('Imagen analizada exitosamente');\n\n      if (isVoiceModeEnabled) {\n        const caption = data.analysis?.description?.primary?.text;\n        const spoken = caption\n          ? `An√°lisis completo. Descripci√≥n principal: ${caption}. Ahora revisa la pregunta sugerida y las opciones antes de guardar.`\n          : 'An√°lisis completo. Ahora revisa la pregunta sugerida y las opciones antes de guardar.';\n        speak(spoken, { force: false, action: 'image_analysis_done' });\n      }\n    } catch (err) {\n      const message = err.message || 'No se pudo analizar la imagen';\n      setError(message);\n      if (isVoiceModeEnabled) {\n        speak(`Error al analizar la imagen: ${message}`, {\n          force: false,\n          action: 'image_analysis_error'\n        });\n      }\n    } finally {\n      setAnalyzing(false);\n    }\n  };\n\n  const autoPopulateDraft = (analysisResult, suggestions, imageBase64) => {\n    const primaryCaption = analysisResult?.description?.primary?.text;\n    const baseQuestion = suggestions?.question\n      ? suggestions.question\n      : primaryCaption\n        ? '¬øQu√© describe mejor esta imagen?'\n        : '¬øQu√© se muestra en la imagen?';\n\n    const tagNames = (analysisResult?.tags || []).map(tag => tag.name).filter(Boolean);\n    const objectNames = (analysisResult?.objects || []).map(obj => obj.name).filter(Boolean);\n    const suggestionOptions = suggestions?.options || [];\n    const mergedOptions = buildUniqueList([\n      ...suggestionOptions,\n      ...tagNames,\n      ...objectNames\n    ]).map(capitalize);\n\n    while (mergedOptions.length < 4) {\n      mergedOptions.push('');\n    }\n\n    const trimmedOptions = mergedOptions.slice(0, 4);\n    const suggestedAnswer = suggestions?.suggestedAnswer || trimmedOptions[0];\n    const suggestedIndex = trimmedOptions.findIndex(opt => opt && opt.toLowerCase() === (suggestedAnswer || '').toLowerCase());\n\n    setQuestionDraft({\n      text: baseQuestion,\n      options: trimmedOptions,\n      correctIndex: suggestedIndex >= 0 ? suggestedIndex : 0,\n      explanation: suggestions?.descriptionContext\n        ? `Contexto: ${suggestions.descriptionContext}`\n        : 'Pregunta generada a partir del an√°lisis de la imagen.',\n      imageBase64: imageBase64\n    });\n    if (!selectedTopic && topics.length > 0) {\n      setSelectedTopic(topics[0]);\n    }\n  };\n\n  const handleOptionChange = (idx, value) => {\n    setJustSaved(false);\n    setQuestionDraft(prev => ({\n      ...prev,\n      options: prev.options.map((opt, i) => (i === idx ? value : opt))\n    }));\n  };\n\n  const validateQuestionDraft = () => {\n    if (!questionDraft.text.trim()) {\n      return 'Escribe la pregunta sugerida antes de guardar.';\n    }\n    const filledOptions = questionDraft.options.filter(opt => opt.trim());\n    if (filledOptions.length < 2) {\n      return 'Completa al menos 2 opciones de respuesta.';\n    }\n    if (!questionDraft.options[questionDraft.correctIndex]?.trim()) {\n      return 'Selecciona una respuesta correcta v√°lida.';\n    }\n    if (!selectedTopic) {\n      return 'Selecciona un tema para la pregunta.';\n    }\n    return '';\n  };\n\n  const handleSaveQuestion = async () => {\n    const validationError = validateQuestionDraft();\n    if (validationError) {\n      setError(validationError);\n      if (isVoiceModeEnabled) {\n        speak(validationError, { force: false, action: 'image_question_validation_error' });\n      }\n      return;\n    }\n\n    if (!onQuestionCreated) {\n      setError('No se proporcion√≥ manejador para guardar la pregunta.');\n      return;\n    }\n\n    setSaving(true);\n    setError('');\n    setSuccessMessage('');\n\n    const payload = {\n      text: questionDraft.text.trim(),\n      options: questionDraft.options.map(opt => opt.trim()),\n      correctAnswerIndex: questionDraft.correctIndex,\n      category: selectedTopic,\n      explanation: questionDraft.explanation || '',\n      imageBase64: questionDraft.imageBase64,\n      imageAnalysis: analysis\n    };\n\n    try {\n      await Promise.resolve(onQuestionCreated(payload));\n      setSuccessMessage('Pregunta generada y enviada correctamente.');\n      setJustSaved(true);\n      if (isVoiceModeEnabled) {\n        speak('Pregunta guardada exitosamente. Puedes crear otra pregunta con esta imagen o volver al panel.', {\n          force: false,\n          action: 'image_question_saved'\n        });\n      }\n      // Permitir crear m√°s preguntas sin cerrar el flujo\n      setTimeout(() => setSuccessMessage(''), 2000);\n      setTimeout(() => setJustSaved(false), 3000);\n    } catch (err) {\n      setError(err.message || 'No se pudo guardar la pregunta');\n      setJustSaved(false);\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const resetFlow = () => {\n    setImageFile(null);\n    setImagePreview('');\n    setAnalysis(null);\n    setQuestionSuggestions(null);\n    setQuestionDraft({\n      text: '',\n      options: [...INITIAL_OPTIONS],\n      correctIndex: 0,\n      explanation: '',\n      imageBase64: ''\n    });\n    setError('');\n    setSuccessMessage('');\n    setJustSaved(false);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  return (\n    <div className=\"grid gap-4 p-4\">\n      {isVoiceModeEnabled && (\n        <div className=\"flex justify-end\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              const script = [\n                'Sube una imagen relacionada con tu pregunta.',\n                'Haz clic en Analizar imagen para obtener descripciones, etiquetas y objetos detectados.',\n                'Edita la pregunta sugerida y las opciones antes de guardar.',\n                'Al finalizar, guarda la pregunta o vuelve atr√°s.'\n              ];\n              await speak(script.join(' '), { force: true, action: 'image_analysis_help' });\n            }}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Explicar flujo: describe c√≥mo usar esta herramienta para crear preguntas desde im√°genes.', { force: true })}\n            onFocus={() => isVoiceModeEnabled && speak('Explicar flujo: describe c√≥mo usar esta herramienta para crear preguntas desde im√°genes.', { force: true })}\n          >\n            üõà Explicar flujo\n          </Button>\n        </div>\n      )}\n\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n      <div className=\"grid gap-3 rounded-2xl border border-white/10 bg-white/5 p-4\">\n        <h3 className=\"text-lg font-bold\">1. Subir imagen</h3>\n        <label\n          className=\"flex flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed border-white/20 bg-white/5 px-4 py-10 text-center text-sm text-white/70 hover:border-bb-primary/60 hover:bg-white/10 transition cursor-pointer\"\n          onMouseEnter={() => isVoiceModeEnabled && speak(imagePreview ? 'Imagen seleccionada. Haz clic para cambiar la imagen.' : '√Årea de subida de imagen. Haz clic o arrastra una imagen JPG, PNG o WebP de m√°ximo 4 megabytes.', { force: true })}\n          onFocus={() => isVoiceModeEnabled && speak(imagePreview ? 'Imagen seleccionada. Haz clic para cambiar la imagen.' : '√Årea de subida de imagen. Haz clic o arrastra una imagen JPG, PNG o WebP de m√°ximo 4 megabytes.', { force: true })}\n        >\n          {imagePreview ? (\n            <img src={imagePreview} alt=\"Vista previa\" className=\"max-h-64 rounded-lg object-contain\" />\n          ) : (\n            <>\n              <span className=\"text-2xl\">üñºÔ∏è</span>\n              <span>Haz clic o arrastra una imagen (JPG, PNG, WebP, m√°x. 4MB)</span>\n            </>\n          )}\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept={ALLOWED_TYPES.join(',')}\n            className=\"hidden\"\n            onChange={handleFileChange}\n          />\n        </label>\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button\n            type=\"button\"\n            disabled={!imageFile || analyzing}\n            onClick={analyzeImage}\n            onMouseEnter={() => isVoiceModeEnabled && !analyzing && speak('Analizar imagen: analiza la imagen con inteligencia artificial para generar descripciones, etiquetas y sugerencias de pregunta.', { force: true })}\n            onFocus={() => isVoiceModeEnabled && !analyzing && speak('Analizar imagen: analiza la imagen con inteligencia artificial para generar descripciones, etiquetas y sugerencias de pregunta.', { force: true })}\n          >\n            {analyzing ? (\n              <>\n                <Spinner size={16} className=\"mr-2\" />\n                Analizando‚Ä¶\n              </>\n            ) : 'üîç Analizar imagen'}\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            disabled={!imageFile || analyzing}\n            onClick={resetFlow}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Limpiar: elimina la imagen y el an√°lisis actual para empezar de nuevo.', { force: true })}\n            onFocus={() => isVoiceModeEnabled && speak('Limpiar: elimina la imagen y el an√°lisis actual para empezar de nuevo.', { force: true })}\n          >\n            Limpiar\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            onClick={onCancel}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Volver: cierra esta herramienta y regresa al generador de preguntas.', { force: true })}\n            onFocus={() => isVoiceModeEnabled && speak('Volver: cierra esta herramienta y regresa al generador de preguntas.', { force: true })}\n          >\n            Volver\n          </Button>\n        </div>\n      </div>\n\n      {analysis && (\n        <div className=\"grid gap-4 rounded-2xl border border-white/10 bg-white/5 p-4\">\n          <h3 className=\"text-lg font-bold\">2. Resultados del an√°lisis</h3>\n          {analysis?.description?.primary?.text && (\n            <div \n              className=\"rounded-xl border border-white/10 bg-bb-primary/10 p-3\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Descripci√≥n principal: ${analysis.description.primary.text}. Confianza: ${(analysis.description.primary.confidence * 100).toFixed(1)} por ciento.`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Descripci√≥n principal: ${analysis.description.primary.text}. Confianza: ${(analysis.description.primary.confidence * 100).toFixed(1)} por ciento.`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Descripci√≥n principal del an√°lisis\"\n            >\n              <p className=\"text-sm text-white/70 uppercase tracking-wide\">Descripci√≥n principal</p>\n              <p className=\"text-base font-semibold text-white mt-1\">{analysis.description.primary.text}</p>\n              <p className=\"text-xs text-white/60 mt-1\">\n                Confianza: {(analysis.description.primary.confidence * 100).toFixed(1)}%\n              </p>\n            </div>\n          )}\n\n          {analysis.tags?.length > 0 && (\n            <div \n              className=\"grid gap-2\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Tags detectados: ${analysis.tags.map(t => `${t.name} con ${(t.confidence * 100).toFixed(0)} por ciento de confianza`).join(', ')}.`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Tags detectados: ${analysis.tags.map(t => `${t.name} con ${(t.confidence * 100).toFixed(0)} por ciento de confianza`).join(', ')}.`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Tags detectados\"\n            >\n              <p className=\"text-sm text-white/70 font-semibold\">Tags detectados</p>\n              <div className=\"flex flex-wrap gap-2\">\n                {analysis.tags.map(tag => (\n                  <Badge key={tag.name} variant=\"primary\">\n                    {tag.name} ‚Ä¢ {(tag.confidence * 100).toFixed(0)}%\n                  </Badge>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {analysis.categories?.length > 0 && (\n            <div \n              className=\"grid gap-1\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Categor√≠as detectadas: ${analysis.categories.map(c => `${c.name} con ${(c.confidence * 100).toFixed(1)} por ciento`).join(', ')}.`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Categor√≠as detectadas: ${analysis.categories.map(c => `${c.name} con ${(c.confidence * 100).toFixed(1)} por ciento`).join(', ')}.`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Categor√≠as detectadas\"\n            >\n              <p className=\"text-sm text-white/70 font-semibold\">Categor√≠as</p>\n              {analysis.categories.map(cat => (\n                <p key={cat.name} className=\"text-sm text-white/80\">\n                  {cat.name} ({(cat.confidence * 100).toFixed(1)}%)\n                </p>\n              ))}\n            </div>\n          )}\n\n          {analysis.objectSummary?.length > 0 && (\n            <div \n              className=\"grid gap-1\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Objetos detectados: ${analysis.objectSummary.map(o => `${capitalize(o.name)} ${o.count} ${o.count === 1 ? 'vez' : 'veces'}`).join(', ')}.`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Objetos detectados: ${analysis.objectSummary.map(o => `${capitalize(o.name)} ${o.count} ${o.count === 1 ? 'vez' : 'veces'}`).join(', ')}.`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Objetos detectados\"\n            >\n              <p className=\"text-sm text-white/70 font-semibold\">Objetos detectados</p>\n              {analysis.objectSummary.map(obj => (\n                <p key={obj.name} className=\"text-sm text-white/80\">\n                  {capitalize(obj.name)} ‚Ä¢ {obj.count} {obj.count === 1 ? 'vez' : 'veces'}\n                </p>\n              ))}\n            </div>\n          )}\n\n          {analysis.colors && (\n            <div \n              className=\"grid gap-2\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Colores dominantes: ${(analysis.colors.dominantColors || []).join(', ')}. ${analysis.colors.accentColor ? `Color de acento: ${analysis.colors.accentColor}.` : ''}`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Colores dominantes: ${(analysis.colors.dominantColors || []).join(', ')}. ${analysis.colors.accentColor ? `Color de acento: ${analysis.colors.accentColor}.` : ''}`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Colores dominantes\"\n            >\n              <p className=\"text-sm text-white/70 font-semibold\">Colores dominantes</p>\n              <div className=\"flex flex-wrap gap-2\">\n                {(analysis.colors.dominantColors || []).map(color => (\n                  <span\n                    key={color}\n                    className=\"px-3 py-1 text-xs font-semibold rounded-full border border-white/10 bg-white/10 text-white/80\"\n                  >\n                    {color}\n                  </span>\n                ))}\n                {analysis.colors.accentColor && (\n                  <span className=\"flex items-center gap-2 text-xs text-white/80\">\n                    Acento:\n                    <span\n                      className=\"inline-flex h-4 w-4 rounded-full border border-white/40\"\n                      style={{ backgroundColor: `#${analysis.colors.accentColor}` }}\n                    />\n                    #{analysis.colors.accentColor}\n                  </span>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {analysis && (\n        <div className=\"grid gap-4 rounded-2xl border border-white/10 bg-white/5 p-4\">\n          <h3 className=\"text-lg font-bold\">3. Generar pregunta</h3>\n          {questionSuggestions && (\n            <div \n              className=\"rounded-xl border border-bb-primary/40 bg-bb-primary/10 p-3 text-sm text-white/80\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Sugerencia de pregunta: ${questionSuggestions.question}. ${questionSuggestions.descriptionContext ? `Contexto: ${questionSuggestions.descriptionContext}.` : ''} ${questionSuggestions.categorySuggestion ? `Categor√≠a sugerida: ${questionSuggestions.categorySuggestion}.` : ''}`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Sugerencia de pregunta: ${questionSuggestions.question}. ${questionSuggestions.descriptionContext ? `Contexto: ${questionSuggestions.descriptionContext}.` : ''} ${questionSuggestions.categorySuggestion ? `Categor√≠a sugerida: ${questionSuggestions.categorySuggestion}.` : ''}`, { force: true })}\n              tabIndex={0}\n              role=\"region\"\n              aria-label=\"Sugerencia de pregunta\"\n            >\n              <p className=\"font-semibold\">Sugerencia:</p>\n              <ul className=\"list-disc pl-5 space-y-1 mt-1\">\n                <li>Pregunta base: {questionSuggestions.question}</li>\n                {questionSuggestions.descriptionContext && (\n                  <li>Contexto: {questionSuggestions.descriptionContext}</li>\n                )}\n                {questionSuggestions.categorySuggestion && (\n                  <li>Categor√≠a sugerida: {questionSuggestions.categorySuggestion}</li>\n                )}\n              </ul>\n            </div>\n          )}\n\n          <div className=\"grid gap-3\">\n            <label className=\"text-sm text-white/70 font-semibold\">Tema</label>\n            <select\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              className=\"rounded-xl border-2 border-white/10 bg-white/5 px-4 py-2 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Tema: selecciona el tema de la pregunta. Tema actual: ${selectedTopic}.`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Tema: selecciona el tema de la pregunta. Tema actual: ${selectedTopic}.`, { force: true })}\n            >\n              {topics.map(topic => (\n                <option key={topic} value={topic}>{topic}</option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"grid gap-2\">\n            <label className=\"text-sm text-white/70 font-semibold\">Pregunta propuesta</label>\n            <textarea\n              value={questionDraft.text}\n              onChange={(e) => {\n                setJustSaved(false);\n                setQuestionDraft(prev => ({ ...prev, text: e.target.value }));\n              }}\n              rows={3}\n              className=\"w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-2 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30\"\n              placeholder=\"¬øQu√© se muestra en la imagen?\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Pregunta propuesta: edita el texto de la pregunta. ${questionDraft.text ? `Texto actual: ${questionDraft.text}` : 'Campo vac√≠o, escribe la pregunta aqu√≠.'}`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Pregunta propuesta: edita el texto de la pregunta. ${questionDraft.text ? `Texto actual: ${questionDraft.text}` : 'Campo vac√≠o, escribe la pregunta aqu√≠.'}`, { force: true })}\n            />\n          </div>\n\n          <div className=\"grid gap-3\">\n            <div className=\"flex items-center justify-between\">\n              <label className=\"text-sm text-white/70 font-semibold\">Opciones de respuesta</label>\n              <span className=\"text-xs text-white/50\">Marca la correcta</span>\n            </div>\n            <div className=\"grid gap-3 p-3 bg-white/5 rounded-xl border border-white/10\">\n              {questionDraft.options.map((option, idx) => (\n                <div key={idx} className=\"flex items-center gap-3\">\n                  <span className=\"text-lg font-bold text-bb-primary min-w-[2rem]\">\n                    {String.fromCharCode(65 + idx)})\n                  </span>\n                  <Input\n                    value={option}\n                    onChange={(e) => handleOptionChange(idx, e.target.value)}\n                    placeholder=\"Escribe una opci√≥n‚Ä¶\"\n                    className=\"flex-1\"\n                    onMouseEnter={() => isVoiceModeEnabled && speak(`Opci√≥n ${String.fromCharCode(65 + idx)}: ${option || 'campo vac√≠o, escribe una opci√≥n aqu√≠.'}`, { force: true })}\n                    onFocus={() => isVoiceModeEnabled && speak(`Opci√≥n ${String.fromCharCode(65 + idx)}: ${option || 'campo vac√≠o, escribe una opci√≥n aqu√≠.'}`, { force: true })}\n                  />\n                  <label \n                    className=\"inline-flex items-center gap-2 cursor-pointer text-xs text-white/70\"\n                    onMouseEnter={() => isVoiceModeEnabled && speak(`Marcar opci√≥n ${String.fromCharCode(65 + idx)} como correcta. ${questionDraft.correctIndex === idx ? 'Esta opci√≥n est√° marcada como correcta.' : 'Haz clic para marcar esta opci√≥n como la respuesta correcta.'}`, { force: true })}\n                    onFocus={() => isVoiceModeEnabled && speak(`Marcar opci√≥n ${String.fromCharCode(65 + idx)} como correcta. ${questionDraft.correctIndex === idx ? 'Esta opci√≥n est√° marcada como correcta.' : 'Haz clic para marcar esta opci√≥n como la respuesta correcta.'}`, { force: true })}\n                  >\n                    <input\n                      type=\"radio\"\n                      name=\"correctOption\"\n                      checked={questionDraft.correctIndex === idx}\n                      onChange={() => {\n                        setJustSaved(false);\n                        setQuestionDraft(prev => ({ ...prev, correctIndex: idx }));\n                      }}\n                      className=\"h-4 w-4 accent-bb-primary cursor-pointer\"\n                    />\n                    Correcta\n                  </label>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"grid gap-2\">\n            <label className=\"text-sm text-white/70 font-semibold\">Explicaci√≥n (opcional)</label>\n            <textarea\n              value={questionDraft.explanation}\n              onChange={(e) => {\n                setJustSaved(false);\n                setQuestionDraft(prev => ({ ...prev, explanation: e.target.value }));\n              }}\n              rows={2}\n              className=\"w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-2 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30\"\n              placeholder=\"A√±ade un contexto o pista opcional‚Ä¶\"\n              onMouseEnter={() => isVoiceModeEnabled && speak(`Explicaci√≥n opcional: a√±ade un contexto o pista para la pregunta. ${questionDraft.explanation ? `Texto actual: ${questionDraft.explanation}` : 'Campo vac√≠o, puedes a√±adir una explicaci√≥n opcional.'}`, { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak(`Explicaci√≥n opcional: a√±ade un contexto o pista para la pregunta. ${questionDraft.explanation ? `Texto actual: ${questionDraft.explanation}` : 'Campo vac√≠o, puedes a√±adir una explicaci√≥n opcional.'}`, { force: true })}\n            />\n          </div>\n\n          <div className=\"flex flex-wrap gap-3 items-center\">\n            <div className=\"flex items-center gap-2\">\n              <Button\n                type=\"button\"\n                onClick={handleSaveQuestion}\n                disabled={saving}\n                onMouseEnter={() => isVoiceModeEnabled && !saving && speak('Guardar pregunta: guarda la pregunta actual con la imagen y el an√°lisis. Puedes crear m√°s preguntas despu√©s.', { force: true })}\n                onFocus={() => isVoiceModeEnabled && !saving && speak('Guardar pregunta: guarda la pregunta actual con la imagen y el an√°lisis. Puedes crear m√°s preguntas despu√©s.', { force: true })}\n              >\n                {saving ? (\n                  <>\n                    <Spinner size={16} className=\"mr-2\" />\n                    Guardando‚Ä¶\n                  </>\n                ) : 'Guardar pregunta'}\n              </Button>\n              {justSaved && (\n                <span className=\"inline-flex items-center gap-1.5 text-sm text-emerald-400 font-medium animate-in fade-in duration-300\">\n                  <span className=\"text-lg\">‚úì</span>\n                  <span>Guardado</span>\n                </span>\n              )}\n            </div>\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={onCancel}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Finalizar: cierra esta herramienta y regresa al generador de preguntas. Las preguntas guardadas estar√°n disponibles.', { force: true })}\n              onFocus={() => isVoiceModeEnabled && speak('Finalizar: cierra esta herramienta y regresa al generador de preguntas. Las preguntas guardadas estar√°n disponibles.', { force: true })}\n            >\n              Finalizar\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageAnalysisQuestionCreator;\n\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useAuth } from '../AuthContext';\nimport { useVoice } from '../VoiceContext';\nimport Button from './ui/Button';\nimport Alert from './ui/Alert';\nimport Spinner from './ui/Spinner';\nimport './ObjectDetectionQuestionCreator.css';\n\nconst MAX_IMAGE_SIZE = 4 * 1024 * 1024;\nconst ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/webp'];\n\n/**\n * HU-VC4: Object Detection Question Creator\n * Allows teachers to create interactive questions based on detected objects\n */\nexport default function ObjectDetectionQuestionCreator({ \n  topics = [], \n  onQuestionCreated, \n  onCancel \n}) {\n  const { user } = useAuth();\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const fileInputRef = useRef(null);\n  const canvasRef = useRef(null);\n  \n  const apiBase = (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) || import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n\n  // State\n  const [imageFile, setImageFile] = useState(null);\n  const [imagePreview, setImagePreview] = useState(null);\n  const [detecting, setDetecting] = useState(false);\n  const [detection, setDetection] = useState(null);\n  const [error, setError] = useState('');\n  const [successMessage, setSuccessMessage] = useState('');\n  const [confidenceThreshold, setConfidenceThreshold] = useState(0.5);\n  const [selectedObject, setSelectedObject] = useState(null);\n  const [questionType, setQuestionType] = useState('identification');\n  const [hoveredObject, setHoveredObject] = useState(null);\n  const [step, setStep] = useState('upload'); // upload | results | preview\n  const [questionsCreated, setQuestionsCreated] = useState(0);\n  const [justSavedQuestion, setJustSavedQuestion] = useState(false);\n  const [questionDraft, setQuestionDraft] = useState({\n    text: '',\n    options: ['', '', '', ''],\n    correctIndex: 0,\n    explanation: ''\n  });\n\n  // Handlers\n  const handleFileChange = (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      setError('‚ùå Formato inv√°lido. Usa JPG, PNG o WebP.');\n      return;\n    }\n    if (file.size > MAX_IMAGE_SIZE) {\n      setError('‚ùå La imagen debe ser menor a 4MB.');\n      return;\n    }\n\n    setImageFile(file);\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      setImagePreview(event.target.result);\n      setStep('upload');\n      // Resetear contadores cuando se carga una nueva imagen\n      setQuestionsCreated(0);\n      setJustSavedQuestion(false);\n      if (isVoiceModeEnabled) {\n        speak('Imagen seleccionada correctamente. Presiona detectar objetos para continuar.', { force: true });\n      }\n      setError('');\n      setSuccessMessage('‚úÖ Imagen cargada');\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const detectObjects = async () => {\n    if (!imagePreview) {\n      setError('‚ùå Selecciona una imagen primero.');\n      return;\n    }\n\n    setDetecting(true);\n    setError('');\n    setSuccessMessage('');\n\n    try {\n      const token = user && user.getIdToken ? await user.getIdToken() : null;\n      \n      const response = await fetch(`${apiBase}/vision/detect-objects`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token ? { Authorization: `Bearer ${token}` } : {})\n        },\n        body: JSON.stringify({\n          imageBase64: imagePreview,\n          minConfidence: confidenceThreshold,\n          language: 'es'\n        })\n      });\n\n      const data = await response.json();\n\n      if (!data.success) {\n        setError(`‚ùå ${data.error || 'Error detectando objetos'}`);\n        return;\n      }\n\n      setDetection(data.detection);\n      setError('');\n      setSuccessMessage(`‚úÖ Se detectaron ${data.detection.stats.totalObjects} objetos`);\n      setSelectedObject(null);\n      \n      // Usar setTimeout para asegurar que el estado se actualice antes de dibujar\n      setTimeout(() => {\n        setStep('results');\n        drawBoundingBoxes(data.detection.objects);\n      }, 100);\n\n      if (isVoiceModeEnabled) {\n        const objectCount = data.detection.stats.totalObjects;\n        const topObjects = data.detection.topObjects\n          .slice(0, 3)\n          .map(o => `${o.name} con ${(o.confidence * 100).toFixed(0)}% confianza`)\n          .join(', ');\n        \n        speak(\n          `Detecci√≥n completada. Se encontraron ${objectCount} objeto${objectCount !== 1 ? 's' : ''}. \n           ${topObjects}. Selecciona un objeto para crear la pregunta.`,\n          { force: true }\n        );\n      }\n    } catch (err) {\n      console.error('Error:', err);\n      setError(`‚ùå ${err.message}`);\n    } finally {\n      setDetecting(false);\n    }\n  };\n\n  const drawBoundingBoxes = (objects) => {\n    if (!canvasRef.current || !imagePreview) return;\n\n    const img = new Image();\n    img.onload = () => {\n      const canvas = canvasRef.current;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      const ctx = canvas.getContext('2d');\n\n      // Draw image\n      ctx.drawImage(img, 0, 0);\n\n      // Draw bounding boxes\n      objects.forEach((obj) => {\n        if (!obj.rectangle) return;\n\n        const { x, y, w, h } = obj.rectangle;\n        \n        // Color based on confidence\n        const hue = Math.max(0, Math.min(120, obj.confidence * 120));\n        const color = `hsl(${hue}, 100%, 50%)`;\n        \n        ctx.strokeStyle = color;\n        ctx.lineWidth = 3;\n        ctx.strokeRect(x, y, w, h);\n\n        // Label background\n        ctx.fillStyle = color;\n        ctx.font = 'bold 14px Arial';\n        const label = `${obj.name} (${(obj.confidence * 100).toFixed(0)}%)`;\n        const textMetrics = ctx.measureText(label);\n        const textWidth = textMetrics.width;\n        \n        ctx.fillRect(x, y - 28, textWidth + 8, 24);\n        \n        // Label text\n        ctx.fillStyle = 'white';\n        ctx.fillText(label, x + 4, y - 10);\n      });\n    };\n    img.src = imagePreview;\n  };\n\n  const generateQuestion = () => {\n    if (!detection || !selectedObject) {\n      setError('‚ùå Selecciona un objeto primero.');\n      return;\n    }\n\n    const filteredObjects = detection.objects\n      .filter(obj => obj.confidence >= confidenceThreshold);\n\n    let question = '';\n    let options = [];\n    let correctAnswerIndex = -1;\n    let explanation = '';\n\n    if (questionType === 'identification') {\n      question = `¬øQu√© objeto aparece en esta imagen?`;\n      \n      // Primero: incluir el objeto seleccionado\n      const uniqueObjects = [selectedObject.name];\n      const seen = new Set([selectedObject.name]);\n      \n      // Luego: agregar otros objetos √∫nicos hasta tener 4\n      for (const obj of filteredObjects) {\n        if (!seen.has(obj.name) && uniqueObjects.length < 4) {\n          uniqueObjects.push(obj.name);\n          seen.add(obj.name);\n        }\n      }\n      \n      // Si tenemos menos de 4 opciones, completar con objetos no filtrados\n      if (uniqueObjects.length < 4) {\n        for (const obj of detection.objects) {\n          if (!seen.has(obj.name) && uniqueObjects.length < 4) {\n            uniqueObjects.push(obj.name);\n            seen.add(obj.name);\n          }\n        }\n      }\n      \n      // Si a√∫n tenemos menos de 4, duplicar algunos (fallback)\n      while (uniqueObjects.length < 4) {\n        uniqueObjects.push('Ninguno de los anteriores');\n      }\n\n      options = uniqueObjects;\n      correctAnswerIndex = 0; // Por defecto, primera opci√≥n\n\n      explanation = `Se detectaron ${detection.stats.totalObjects} objeto(s) en total.`;\n    } else {\n      const count = detection.objectCounts[selectedObject.name] || 0;\n      question = `¬øCu√°nto${count !== 1 ? 's' : ''} ${selectedObject.name} hay en la imagen?`;\n      options = ['0', '1', '2', '3', '4+'];\n      correctAnswerIndex = count > 4 ? 4 : count;\n\n      explanation = `Se detect√≥(ron) ${count} ${selectedObject.name}(s) en la imagen.`;\n    }\n\n    // Validar que tenemos exactamente 4 opciones\n    if (options.length !== 4) {\n      if (options.length < 4) {\n        while (options.length < 4) {\n          options.push('');\n        }\n      } else {\n        options = options.slice(0, 4);\n      }\n    }\n\n    // Llenar el draft de pregunta para edici√≥n\n    setQuestionDraft({\n      text: question,\n      options: options,\n      correctIndex: correctAnswerIndex,\n      explanation: explanation\n    });\n\n    setStep('preview');\n    \n    if (isVoiceModeEnabled) {\n      speak(`Pregunta generada. ${question}. Las opciones son: ${options.filter(o => o).join(', ')}. Edita antes de guardar.`, { force: true });\n    }\n  };\n\n  const confirmQuestion = () => {\n    // Validar que tenemos pregunta y opciones v√°lidas\n    if (!questionDraft.text.trim()) {\n      setError('‚ùå La pregunta no puede estar vac√≠a.');\n      return;\n    }\n\n    const validOptions = questionDraft.options.filter(opt => opt.trim());\n    if (validOptions.length < 2) {\n      setError('‚ùå Necesitas al menos 2 opciones v√°lidas.');\n      return;\n    }\n\n    if (!questionDraft.options[questionDraft.correctIndex]?.trim()) {\n      setError('‚ùå La opci√≥n correcta no puede estar vac√≠a.');\n      return;\n    }\n\n    const questionData = {\n      text: questionDraft.text.trim(),\n      options: questionDraft.options.map(opt => opt.trim()),\n      correctAnswerIndex: questionDraft.correctIndex,\n      category: 'Detecci√≥n de Objetos',\n      explanation: questionDraft.explanation || '',\n      imageBase64: imagePreview,\n      questionType: `detectionObjects_${questionType}`,\n      difficulty: 'media',\n      imageAnalysis: {\n        detectedObjects: detection.objects,\n        objectCounts: detection.objectCounts,\n        totalObjects: detection.stats.totalObjects,\n        service: 'Azure Computer Vision',\n        timestamp: new Date().toISOString()\n      }\n    };\n\n    // Llamar al callback para guardar la pregunta\n    onQuestionCreated?.(questionData);\n    \n    // Mostrar mensaje de √©xito y contar\n    setQuestionsCreated(prev => prev + 1);\n    setJustSavedQuestion(true);\n    setSuccessMessage(`‚úÖ Pregunta ${questionsCreated + 1} guardada`);\n    \n    if (isVoiceModeEnabled) {\n      speak(`Pregunta ${questionsCreated + 1} guardada. Puedes crear otra pregunta con esta imagen.`, { force: true });\n    }\n\n    // Limpiar estado despu√©s de 2 segundos\n    setTimeout(() => {\n      setJustSavedQuestion(false);\n      setSuccessMessage('');\n    }, 2000);\n    \n    // Volver a vista de resultados para permitir crear otra pregunta\n    setStep('results');\n    setSelectedObject(null);\n    setQuestionType('identification');\n    setQuestionDraft({\n      text: '',\n      options: ['', '', '', ''],\n      correctIndex: 0,\n      explanation: ''\n    });\n  };\n\n  // Filtered objects\n  const filteredObjects = detection?.objects.filter(\n    obj => obj.confidence >= confidenceThreshold\n  ) || [];\n\n  const handleCancel = () => {\n    if (questionsCreated > 0) {\n      if (isVoiceModeEnabled) {\n        speak(`Se guardaron ${questionsCreated} pregunta${questionsCreated !== 1 ? 's' : ''}. Volviendo al panel de preguntas.`, { force: true });\n      }\n    }\n    onCancel?.();\n  };\n\n  return (\n    <div className=\"object-detection-creator\">\n      {/* Step 1: Upload */}\n      {step === 'upload' && (\n        <div className=\"od-section\">\n          <div className=\"od-header\">\n            <h2>üéØ Crear Pregunta con Detecci√≥n de Objetos</h2>\n            <p>Sube una imagen y el sistema detectar√° autom√°ticamente los objetos presentes</p>\n          </div>\n\n          <div className=\"od-upload-zone\">\n            <label className=\"od-upload-label\">\n              {imagePreview ? (\n                <div className=\"od-preview-thumb\">\n                  <img src={imagePreview} alt=\"Preview\" />\n                  <div className=\"od-preview-overlay\">‚úì Imagen lista</div>\n                </div>\n              ) : (\n                <div className=\"od-upload-empty\">\n                  <span className=\"od-upload-icon\">üñºÔ∏è</span>\n                  <span className=\"od-upload-text\">Haz clic o arrastra una imagen</span>\n                  <span className=\"od-upload-hint\">JPG, PNG o WebP (m√°ximo 4MB)</span>\n                </div>\n              )}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept={ALLOWED_TYPES.join(',')}\n                onChange={handleFileChange}\n                className=\"od-file-input\"\n              />\n            </label>\n          </div>\n\n          {imagePreview && (\n            <Button\n              disabled={detecting}\n              onClick={detectObjects}\n              className=\"od-button-primary od-button-full\"\n            >\n              {detecting ? (\n                <>\n                  <Spinner size=\"small\" />\n                  <span>Detectando objetos...</span>\n                </>\n              ) : (\n                '‚òÅÔ∏è Detectar Objetos'\n              )}\n            </Button>\n          )}\n\n          {error && <Alert intent=\"error\">{error}</Alert>}\n          {successMessage && <Alert intent=\"success\">{successMessage}</Alert>}\n\n          <Button variant=\"secondary\" onClick={handleCancel} className=\"od-button-full\">\n            Cancelar\n          </Button>\n        </div>\n      )}\n\n      {/* Step 2: Results and Selection */}\n      {step === 'results' && detection && (\n        <div className=\"od-section\">\n          <div className=\"od-header\">\n            <h2>üìä Objetos Detectados</h2>\n            <p>Se encontraron {detection.stats.totalObjects} objeto(s)</p>\n          </div>\n\n          <div className=\"od-canvas-container\">\n            <canvas\n              ref={canvasRef}\n              className=\"od-canvas\"\n            />\n            <div className=\"od-canvas-legend\">\n              <span>üü¢ Verde: Alta confianza (80-100%)</span>\n              <span>üü° Amarillo: Confianza media (50-80%)</span>\n              <span>üî¥ Rojo: Confianza baja (0-50%)</span>\n            </div>\n          </div>\n\n          <div className=\"od-controls\">\n            <div className=\"od-confidence-slider\">\n              <label>Confianza m√≠nima: {(confidenceThreshold * 100).toFixed(0)}%</label>\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.05\"\n                value={confidenceThreshold}\n                onChange={(e) => setConfidenceThreshold(parseFloat(e.target.value))}\n                className=\"od-slider\"\n              />\n              <div className=\"od-slider-labels\">\n                <span>Baja</span>\n                <span>Media</span>\n                <span>Alta</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"od-objects-list\">\n            <h3>Selecciona un objeto:</h3>\n            <div className=\"od-objects-grid\">\n              {filteredObjects.map((obj, idx) => (\n                <button\n                  key={idx}\n                  onClick={() => setSelectedObject(obj)}\n                  onMouseEnter={() => setHoveredObject(obj.id)}\n                  onMouseLeave={() => setHoveredObject(null)}\n                  className={`od-object-card ${\n                    selectedObject?.id === obj.id ? 'od-selected' : ''\n                  } ${hoveredObject === obj.id ? 'od-hovered' : ''}`}\n                >\n                  <div className=\"od-object-name\">{obj.name}</div>\n                  <div className=\"od-object-confidence\">\n                    <div className=\"od-confidence-bar\">\n                      <div \n                        className=\"od-confidence-fill\"\n                        style={{ width: `${obj.confidence * 100}%` }}\n                      />\n                    </div>\n                    <span>{(obj.confidence * 100).toFixed(0)}%</span>\n                  </div>\n                </button>\n              ))}\n            </div>\n\n            {filteredObjects.length === 0 && (\n              <div className=\"od-no-objects\">\n                <p>No hay objetos con la confianza m√≠nima requerida</p>\n                <button \n                  className=\"od-button-secondary\"\n                  onClick={() => setConfidenceThreshold(0.3)}\n                >\n                  Bajar umbral de confianza\n                </button>\n              </div>\n            )}\n          </div>\n\n          <div className=\"od-stats\">\n            <div className=\"od-stat-card\">\n              <span className=\"od-stat-label\">Total de objetos</span>\n              <span className=\"od-stat-value\">{detection.stats.totalObjects}</span>\n            </div>\n            <div className=\"od-stat-card\">\n              <span className=\"od-stat-label\">Tipos √∫nicos</span>\n              <span className=\"od-stat-value\">{detection.stats.totalTypes}</span>\n            </div>\n            <div className=\"od-stat-card\">\n              <span className=\"od-stat-label\">Confianza promedio</span>\n              <span className=\"od-stat-value\">{(detection.stats.averageConfidence * 100).toFixed(0)}%</span>\n            </div>\n          </div>\n\n          {selectedObject && (\n            <div className=\"od-question-type\">\n              <h3>Tipo de pregunta:</h3>\n              <div className=\"od-question-options\">\n                <label className=\"od-radio-option\">\n                  <input\n                    type=\"radio\"\n                    value=\"identification\"\n                    checked={questionType === 'identification'}\n                    onChange={(e) => setQuestionType(e.target.value)}\n                  />\n                  <span>üéØ ¬øQu√© objeto aparece?</span>\n                </label>\n                <label className=\"od-radio-option\">\n                  <input\n                    type=\"radio\"\n                    value=\"counting\"\n                    checked={questionType === 'counting'}\n                    onChange={(e) => setQuestionType(e.target.value)}\n                  />\n                  <span>üî¢ ¬øCu√°nto{detection.objectCounts[selectedObject.name] !== 1 ? 's' : ''} {selectedObject.name} hay?</span>\n                </label>\n              </div>\n            </div>\n          )}\n\n          {error && <Alert intent=\"error\">{error}</Alert>}\n\n          <div className=\"od-button-group\">\n            {selectedObject && (\n              <Button\n                onClick={generateQuestion}\n                className=\"od-button-primary\"\n              >\n                ‚úÖ Generar Pregunta\n              </Button>\n            )}\n            <Button variant=\"secondary\" onClick={() => setStep('upload')} className=\"od-button-secondary\">\n              ‚Üê Volver\n            </Button>\n            {questionsCreated > 0 && (\n              <Button variant=\"ghost\" onClick={handleCancel} className=\"od-button-secondary\">\n                Finalizar ({questionsCreated} pregunta{questionsCreated !== 1 ? 's' : ''})\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Step 3: Preview and Editing */}\n      {step === 'preview' && detection && (\n        <div className=\"od-section\">\n          <div className=\"od-header\">\n            <h2>üëÅÔ∏è Editar Pregunta</h2>\n            <p>Revisa y edita la pregunta antes de guardarla</p>\n          </div>\n\n          <div className=\"od-preview-card\">\n            <img src={imagePreview} alt=\"Question\" className=\"od-preview-image\" />\n            \n            <div className=\"od-preview-question\">\n              <h3>üìù Pregunta:</h3>\n              <input\n                type=\"text\"\n                value={questionDraft.text}\n                onChange={(e) => setQuestionDraft(prev => ({ ...prev, text: e.target.value }))}\n                className=\"od-input\"\n                placeholder=\"Escribe tu pregunta\"\n              />\n            </div>\n\n            <div className=\"od-preview-options\">\n              <h3>üìã Opciones de Respuesta:</h3>\n              <div className=\"od-options-list\">\n                {questionDraft.options.map((opt, idx) => (\n                  <div key={idx} className={`od-option-editor ${idx === questionDraft.correctIndex ? 'od-selected-correct' : ''}`}>\n                    <label className=\"od-radio-option\">\n                      <input\n                        type=\"radio\"\n                        name=\"correctAnswer\"\n                        checked={idx === questionDraft.correctIndex}\n                        onChange={() => setQuestionDraft(prev => ({ ...prev, correctIndex: idx }))}\n                      />\n                      <span className=\"od-option-letter\">{String.fromCharCode(65 + idx)}.</span>\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={opt}\n                      onChange={(e) => {\n                        const newOptions = [...questionDraft.options];\n                        newOptions[idx] = e.target.value;\n                        setQuestionDraft(prev => ({ ...prev, options: newOptions }));\n                      }}\n                      className=\"od-option-input\"\n                      placeholder={`Opci√≥n ${idx + 1}`}\n                    />\n                    {idx === questionDraft.correctIndex && <span className=\"od-correct-badge\">‚úì Correcta</span>}\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"od-preview-explanation\">\n              <h3>üí° Explicaci√≥n:</h3>\n              <textarea\n                value={questionDraft.explanation}\n                onChange={(e) => setQuestionDraft(prev => ({ ...prev, explanation: e.target.value }))}\n                className=\"od-explanation-textarea\"\n                placeholder=\"Explicaci√≥n de la respuesta (opcional)\"\n                rows=\"3\"\n              />\n            </div>\n          </div>\n\n          {error && <Alert intent=\"error\">{error}</Alert>}\n\n          <div className=\"od-button-group\">\n            <Button\n              onClick={confirmQuestion}\n              className=\"od-button-primary\"\n            >\n              üíæ Guardar Pregunta\n            </Button>\n            <Button variant=\"secondary\" onClick={() => setStep('results')} className=\"od-button-secondary\">\n              ‚Üê Volver\n            </Button>\n            {questionsCreated > 0 && (\n              <Button variant=\"ghost\" onClick={handleCancel} className=\"od-button-secondary\">\n                Finalizar ({questionsCreated} pregunta{questionsCreated !== 1 ? 's' : ''})\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\n\nexport default function Modal({ open, title, onClose, children, className = '' }) {\n  useEffect(() => {\n    const handleEsc = (e) => {\n      if (e.key === 'Escape') onClose?.()\n    }\n    if (open) document.addEventListener('keydown', handleEsc)\n    // Prevent body scroll when modal is open\n    const originalOverflow = document.body.style.overflow\n    if (open) document.body.style.overflow = 'hidden'\n    return () => {\n      document.removeEventListener('keydown', handleEsc)\n      document.body.style.overflow = originalOverflow\n    }\n  }, [open, onClose])\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div className=\"fixed inset-0 z-[3000] flex items-center justify-center px-4 py-8\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>\n          <button aria-label=\"Cerrar\" className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" onClick={onClose} />\n          <motion.div role=\"dialog\" aria-modal=\"true\" className={`relative w-full max-w-2xl max-h-[85vh] overflow-auto rounded-2xl border border-white/10 bg-bb-bg-primary/90 shadow-xl ${className}`} initial={{ scale: 0.98, y: 10, opacity: 0 }} animate={{ scale: 1, y: 0, opacity: 1 }} exit={{ scale: 0.98, y: 10, opacity: 0 }} transition={{ type: 'spring', stiffness: 200, damping: 22 }}>\n            <div className=\"sticky top-0 z-10 flex items-start justify-between gap-4 px-6 py-5 border-b border-white/10 bg-bb-bg-primary/90\">\n              {title ? <h2 className=\"text-xl md:text-2xl font-bold\">{title}</h2> : <span className=\"sr-only\">Modal</span>}\n              <button onClick={onClose} className=\"rounded-md p-2 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bb-primary\" aria-label=\"Cerrar\">‚úï</button>\n            </div>\n            <div className=\"px-6 py-5\">\n              {children}\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  )\n}\n\n","import React, { useState, useEffect } from 'react';\nimport { useVoice } from '../VoiceContext';\nimport { useAuth } from '../AuthContext';\nimport ManualQuestionForm from './ManualQuestionForm';\nimport OCRQuestionCapture from './OCRQuestionCapture';\nimport ImageAnalysisQuestionCreator from './ImageAnalysisQuestionCreator';\nimport ObjectDetectionQuestionCreator from './ObjectDetectionQuestionCreator';\nimport { fetchTopics, fetchDifficultyLevels } from '../services/api';\nimport Button from './ui/Button';\nimport Input from './ui/Input';\nimport Alert from './ui/Alert';\nimport Modal from './ui/Modal';\nimport Spinner from './ui/Spinner';\nimport LoadingOverlay from './ui/LoadingOverlay';\n\nconst AIQuestionGenerator = ({ onQuestionsGenerated, onClose }) => {\n  const { isVoiceModeEnabled, speak } = useVoice();\n  const { user } = useAuth();\n  const [topics, setTopics] = useState([]);\n  const [selectedTopic, setSelectedTopic] = useState('');\n  const [selectedDifficulty, setSelectedDifficulty] = useState('medium');\n  const [questionCount, setQuestionCount] = useState(null);\n  const [questionCountInput, setQuestionCountInput] = useState('');\n  const [useAI, setUseAI] = useState(false);\n  const [showManualForm, setShowManualForm] = useState(false);\n  const [showOCRForm, setShowOCRForm] = useState(false);\n  const [showImageAnalysisForm, setShowImageAnalysisForm] = useState(false);\n  const [showObjectDetectionForm, setShowObjectDetectionForm] = useState(false);\n  const [manualCount, setManualCount] = useState(null);\n  const [manualCountInput, setManualCountInput] = useState('');\n  const [manualStep, setManualStep] = useState(0);\n  const [manualQuestions, setManualQuestions] = useState([]);\n  const [manualTopic, setManualTopic] = useState('');\n  const [ocrQuestions, setOcrQuestions] = useState([]);\n  const [visionQuestions, setVisionQuestions] = useState([]);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  \n  const [error, setError] = useState('');\n  const [statusMessage, setStatusMessage] = useState('');\n  const [difficultyLevels, setDifficultyLevels] = useState([]);\n\n  useEffect(() => {\n    loadTopics();\n    loadDifficultyLevels();\n  }, []);\n\n  // Mantener inputs string sincronizados cuando el valor num√©rico cambie por stepper u otros\n  useEffect(() => { setQuestionCountInput(typeof questionCount === 'number' ? String(questionCount) : ''); }, [questionCount]);\n  useEffect(() => { setManualCountInput(typeof manualCount === 'number' ? String(manualCount) : ''); }, [manualCount]);\n\n  const loadTopics = async () => {\n    try {\n      const topics = await fetchTopics();\n      setTopics(topics);\n      if (topics.length > 0) {\n        setSelectedTopic(topics[0]);\n      }\n    } catch (error) {\n      setError('Error obteniendo temas. Por favor intenta de nuevo.');\n    }\n  };\n\n  const loadDifficultyLevels = async () => {\n    try {\n      const levels = await fetchDifficultyLevels();\n      setDifficultyLevels(levels);\n    } catch (error) {\n      setError('No se pudieron cargar los niveles de dificultad. Por favor, intenta de nuevo m√°s tarde.');\n    }\n  };\n\n  const generateQuestions = async () => {\n    if (!selectedTopic) {\n      setError('Por favor selecciona un tema v√°lido');\n      return;\n    }\n\n    if (!questionCount || questionCount < 1) {\n      setError('Por favor ingresa una cantidad v√°lida de preguntas (m√≠nimo 1)');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n    console.log(`ü§ñ Iniciando generaci√≥n de ${questionCount} preguntas sobre \"${selectedTopic}\" (dificultad: ${selectedDifficulty})...`);\n\n    try {\n      const apiBase = (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) || import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n      if (!apiBase) {\n        throw new Error('Error de configuraci√≥n: URL del API no definida');\n      }\n      \n      const token = user && user.getIdToken ? await user.getIdToken() : null;\n      console.log('üì° Enviando solicitud al backend...');\n      \n      const response = await fetch(`${apiBase}/ai/generate-questions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(token ? { Authorization: `Bearer ${token}` } : {})\n        },\n        body: JSON.stringify({\n          topic: selectedTopic,\n          difficulty: selectedDifficulty,\n          count: questionCount,\n          useAI: useAI\n        }),\n      });\n\n      console.log(`üì• Respuesta recibida con status ${response.status}`);\n      \n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || `Error del servidor: ${response.status}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data.success || !data.questions || data.questions.length === 0) {\n        throw new Error(data.error || 'Error desconocido al generar preguntas');\n      }\n\n      console.log(`‚úÖ Se generaron ${data.questions.length} preguntas exitosamente`);\n      \n      // Guardar preguntas en Firestore y esperar confirmaci√≥n exitosa\n      const questionsWithMeta = data.questions.map(q => ({\n        // Si las opciones existen, barajarlas y actualizar el √≠ndice de la respuesta correcta de forma robusta\n        ...(() => {\n          if (!Array.isArray(q.options) || typeof q.correctAnswerIndex !== 'number') return q;\n          // Asociar cada opci√≥n con su √≠ndice original\n          const optionsWithIndex = q.options.map((opt, idx) => ({ opt, origIdx: idx }));\n          // Barajar\n          for (let i = optionsWithIndex.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];\n          }\n          // Buscar la nueva posici√≥n de la opci√≥n que era la correcta\n          const newCorrectIndex = optionsWithIndex.findIndex(o => o.origIdx === q.correctAnswerIndex);\n          return {\n            ...q,\n            options: optionsWithIndex.map(o => o.opt),\n            correctAnswerIndex: newCorrectIndex\n          };\n        })(),\n        createdBy: user?.uid || 'anon',\n        createdAt: Date.now(),\n        category: selectedTopic,\n        difficulty: selectedDifficulty\n      }));\n      \n      console.log('üíæ Guardando preguntas en Firestore...');\n      const bulkToken = user && user.getIdToken ? await user.getIdToken() : null;\n      const saveResponse = await fetch(`${apiBase}/questions/bulk`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(bulkToken ? { Authorization: `Bearer ${bulkToken}` } : {})\n        },\n        body: JSON.stringify({ questions: questionsWithMeta })\n      });\n      \n      const saveResult = await saveResponse.json();\n      if (!saveResult.success) {\n        throw new Error(saveResult.error || 'Error al guardar las preguntas en la base de datos');\n      }\n\n      console.log('‚úÖ Preguntas guardadas exitosamente');\n      \n      // Solo despu√©s de guardar exitosamente, notificar al componente padre\n      onQuestionsGenerated(data.questions);\n      \n    } catch (error) {\n      console.error('‚ùå Error:', error.message);\n      setError(error.message || 'Error al generar preguntas. Por favor, intenta nuevamente.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Mantener vac√≠o por defecto; no autocompletar cantidad\n\n  return (\n    <Modal open={true} title=\"ü§ñ Generador de Preguntas\" onClose={onClose}>\n      {isVoiceModeEnabled && (!showManualForm && !showOCRForm && !showImageAnalysisForm && !showObjectDetectionForm) && (\n        <div className=\"flex justify-end mb-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            type=\"button\"\n            onClick={async () => {\n              const parts = [];\n              if (!showManualForm && !useAI) {\n                parts.push('Est√°s en el generador de preguntas.');\n                parts.push('Bot√≥n Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.');\n                parts.push('Bot√≥n Escribir preguntas: te permite escribir preguntas manualmente.');\n                parts.push('Selecciona una opci√≥n para continuar.');\n              } else if (useAI && !showManualForm) {\n                parts.push('Formulario para generar preguntas con inteligencia artificial.');\n                parts.push('Campo Tema: selecciona el tema de las preguntas.');\n                parts.push('Campo Dificultad: elige la dificultad.');\n                parts.push('Campo Cantidad: indica cu√°ntas preguntas quieres generar.');\n                parts.push('Bot√≥n Crear preguntas: genera las preguntas.');\n                parts.push('Bot√≥n Atr√°s: vuelve a la pantalla anterior.');\n              }\n              await speak(parts.join(' '), { action: 'page_guide', questionId: 'ai_question_generator', force: true });\n            }}\n            aria-label=\"Explicar la p√°gina\"\n            onFocus={() => speak('Explicar p√°gina: describe la funci√≥n de cada bot√≥n y campo en esta vista.', { force: true })}\n            onMouseEnter={() => speak('Explicar p√°gina: describe la funci√≥n de cada bot√≥n y campo en esta vista.', { force: true })}\n          >\n            üõà Explicar p√°gina\n          </Button>\n        </div>\n      )}\n      {loading && <LoadingOverlay text=\"Generando‚Ä¶\" mobileOnly />}\n      {error && <Alert intent=\"error\">{error}</Alert>}\n      {statusMessage && <Alert intent=\"success\">{statusMessage}</Alert>}\n      {!showManualForm && !useAI && !showOCRForm && !showImageAnalysisForm && !showObjectDetectionForm && (\n        <div className=\"flex flex-col gap-3\">\n          <Button\n            onClick={() => {\n              setUseAI(true);\n              setShowManualForm(false);\n              setShowOCRForm(false);\n              setShowImageAnalysisForm(false);\n              setShowObjectDetectionForm(false);\n            }}\n            size=\"lg\"\n            onFocus={() => isVoiceModeEnabled && speak('Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Crear con IA: genera preguntas autom√°ticamente usando inteligencia artificial.', { force: true })}\n          >\n            ü§ñ Crear con IA\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => {\n              setShowManualForm(true);\n              setUseAI(false);\n              setShowOCRForm(false);\n              setShowImageAnalysisForm(false);\n              setShowObjectDetectionForm(false);\n              setManualStep(0);\n              setManualQuestions([]);\n            }}\n            onFocus={() => isVoiceModeEnabled && speak('Escribir preguntas: te permite escribir preguntas manualmente.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Escribir preguntas: te permite escribir preguntas manualmente.', { force: true })}\n          >\n            ‚úèÔ∏è Escribir preguntas\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => { setShowOCRForm(true); setUseAI(false); setShowImageAnalysisForm(false); setShowObjectDetectionForm(false); }}\n            onFocus={() => isVoiceModeEnabled && speak('Capturar pregunta: extrae preguntas de im√°genes usando OCR.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Capturar pregunta: extrae preguntas de im√°genes usando OCR.', { force: true })}\n          >\n            üì∏ Capturar pregunta\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => {\n              setShowImageAnalysisForm(true);\n              setUseAI(false);\n              setShowManualForm(false);\n              setShowOCRForm(false);\n              setShowObjectDetectionForm(false);\n            }}\n            onFocus={() => isVoiceModeEnabled && speak('Analizar imagen: genera preguntas autom√°ticamente usando Azure Computer Vision.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Analizar imagen: genera preguntas autom√°ticamente usando Azure Computer Vision.', { force: true })}\n          >\n            üñºÔ∏è Analizar imagen\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"lg\"\n            onClick={() => {\n              setShowObjectDetectionForm(true);\n              setUseAI(false);\n              setShowManualForm(false);\n              setShowOCRForm(false);\n              setShowImageAnalysisForm(false);\n            }}\n            onFocus={() => isVoiceModeEnabled && speak('Detectar objetos: crea preguntas interactivas identificando objetos espec√≠ficos en im√°genes.', { force: true })}\n            onMouseEnter={() => isVoiceModeEnabled && speak('Detectar objetos: crea preguntas interactivas identificando objetos espec√≠ficos en im√°genes.', { force: true })}\n          >\n            üéØ Detectar objetos\n          </Button>\n        </div>\n      )}\n      {!showManualForm && useAI && !showOCRForm && (\n        <form\n          className=\"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4\"\n          onSubmit={async (e) => {\n            e.preventDefault();\n            await generateQuestions();\n          }}\n        >\n          <div>\n            <label htmlFor=\"topic\" className=\"block mb-1 text-sm text-white/80\">Tema</label>\n            <select\n              id=\"topic\"\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n              value={selectedTopic}\n              onChange={(e) => setSelectedTopic(e.target.value)}\n              disabled={topics.length === 0}\n            >\n              {topics.length === 0 ? (\n                <option value=\"\">No hay temas</option>\n              ) : (\n                topics.map(topic => (\n                  <option key={topic} value={topic}>{topic}</option>\n                ))\n              )}\n            </select>\n          </div>\n          <div>\n            <label htmlFor=\"difficulty\" className=\"block mb-1 text-sm text-white/80\">Dificultad</label>\n            <select\n              id=\"difficulty\"\n              className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n              value={selectedDifficulty}\n              onChange={(e) => setSelectedDifficulty(e.target.value)}\n            >\n              <option value=\"easy\">F√°cil</option>\n              <option value=\"medium\">Media</option>\n              <option value=\"hard\">Dif√≠cil</option>\n            </select>\n          </div>\n          <div>\n            <label htmlFor=\"numQuestions\" className=\"block mb-1 text-sm text-white/80\">Cantidad</label>\n              <div>\n                <Input\n                id=\"numQuestions\"\n                type=\"text\"\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n                value={questionCountInput}\n                onChange={(e) => {\n                  const digits = e.target.value.replace(/\\D+/g, '')\n                  setQuestionCountInput(digits)\n                  const num = digits ? parseInt(digits, 10) : NaN\n                  if (!Number.isNaN(num)) setQuestionCount(num); else setQuestionCount(null)\n                }}\n                onBlur={() => {\n                  const num = parseInt(questionCountInput || '', 10)\n                  if (Number.isNaN(num) || num < 1) {\n                    setQuestionCount(null)\n                    setQuestionCountInput('')\n                    return\n                  }\n                  const normalized = Math.max(1, num)\n                  setQuestionCount(normalized)\n                  setQuestionCountInput(String(normalized))\n                }}\n                required\n                placeholder=\"Cantidad\"\n                className=\"w-28 text-center\"\n              />\n              {(questionCountInput === '' || questionCount === null) && (\n                <div className={`mt-1 text-xs ${questionCountInput === '' ? 'text-white/60' : 'text-red-300'}`}>\n                  {questionCountInput === '' ? 'Ingresa un n√∫mero (>= 1)' : 'Valor inv√°lido'}\n                </div>\n              )}\n              </div>\n          </div>\n          {error && <Alert intent=\"error\" className=\"sm:col-span-3\">{error}</Alert>}\n          <div className=\"sm:col-span-3 mt-2 flex flex-wrap gap-3 justify-end items-center\">\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={() => setUseAI(false)}\n              disabled={loading}\n              onFocus={() => isVoiceModeEnabled && speak('Atr√°s: vuelve a la pantalla anterior.', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Atr√°s: vuelve a la pantalla anterior.', { force: true })}\n            >\n              Atr√°s\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={loading || !selectedTopic || questionCount === null}\n              title={!selectedTopic ? 'Selecciona un tema' : questionCount === null ? 'Ingresa la cantidad de preguntas' : 'Crear preguntas'}\n              onFocus={() => isVoiceModeEnabled && speak('Crear preguntas: genera las preguntas con inteligencia artificial.', { force: true })}\n              onMouseEnter={() => isVoiceModeEnabled && speak('Crear preguntas: genera las preguntas con inteligencia artificial.', { force: true })}\n            >\n              {loading ? (<><Spinner size={16} className=\"mr-2\" />Creando‚Ä¶</>) : 'Crear preguntas'}\n            </Button>\n          </div>\n        </form>\n      )}\n      {showManualForm && (\n        <div className=\"mt-2\">\n          {manualStep === 0 ? (\n            <form\n              className=\"grid grid-cols-1 gap-4\"\n              onSubmit={e => { e.preventDefault(); setManualStep(1); setManualQuestions([]); setManualTopic(selectedTopic); }}\n            >\n              <div>\n                <label className=\"block mb-1 text-sm text-white/80\">Tema</label>\n                <select\n                  value={selectedTopic}\n                  onChange={e => setSelectedTopic(e.target.value)}\n                  className=\"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none\"\n                >\n                  {topics.map(t => <option key={t} value={t}>{t}</option>)}\n                </select>\n              </div>\n              <div>\n                <label className=\"block mb-1 text-sm text-white/80\">¬øCu√°ntas preguntas?</label>\n                <div>\n                  <Input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    pattern=\"[0-9]*\"\n                    value={manualCountInput}\n                    onChange={e => {\n                      const digits = e.target.value.replace(/\\D+/g, '')\n                      setManualCountInput(digits)\n                      const num = digits ? parseInt(digits, 10) : NaN\n                      if (!Number.isNaN(num)) setManualCount(num); else setManualCount(null)\n                    }}\n                    onBlur={() => {\n                      const num = parseInt(manualCountInput || '', 10)\n                      if (Number.isNaN(num) || num < 1) {\n                        setManualCount(null)\n                        setManualCountInput('')\n                        return\n                      }\n                      const normalized = Math.max(1, num)\n                      setManualCount(normalized)\n                      setManualCountInput(String(normalized))\n                    }}\n                    required\n                    placeholder=\"Cantidad\"\n                    className=\"w-28 text-center\"\n                  />\n                  {(manualCountInput === '' || manualCount === null) && (\n                    <div className={`mt-1 text-xs ${manualCountInput === '' ? 'text-white/60' : 'text-red-300'}`}>\n                      {manualCountInput === '' ? 'Ingresa un n√∫mero (>= 1)' : 'Valor inv√°lido'}\n                    </div>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"secondary\"\n                  onClick={() => setShowManualForm(false)}\n                  onFocus={() => isVoiceModeEnabled && speak('Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.', { force: true })}\n                  onMouseEnter={() => isVoiceModeEnabled && speak('Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.', { force: true })}\n                >\n                  Volver\n                </Button>\n                <Button\n                  type=\"submit\"\n                  onFocus={() => isVoiceModeEnabled && speak('Empezar: inicia la creaci√≥n manual de preguntas.', { force: true })}\n                  onMouseEnter={() => isVoiceModeEnabled && speak('Empezar: inicia la creaci√≥n manual de preguntas.', { force: true })}\n                >\n                  Empezar\n                </Button>\n              </div>\n            </form>\n          ) : (\n            <div>\n              <div className=\"text-center mb-3 font-bold\">¬°Vamos! Pregunta {manualQuestions.length + 1} de {manualCount}</div>\n              <ManualQuestionForm\n                topics={[manualTopic]}\n                onQuestionCreated={async (q) => {\n                                    // q is the payload prepared by the child\n                                    try {\n                                      setLoading(true);\n                                      setError('');\n\n                                      const apiBase = (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) || import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n                                      if (!apiBase) {\n                                        throw new Error('Error de configuraci√≥n: URL del API no definida');\n                                      }\n                                      if (!user || !user.getIdToken) {\n                                        throw new Error('Debes iniciar sesi√≥n para crear preguntas');\n                                      }\n                                      const token = await user.getIdToken();\n\n                                      // Save single question\n                                      const response = await fetch(`${apiBase}/questions`, {\n                                        method: 'POST',\n                                        headers: {\n                                          'Content-Type': 'application/json',\n                                          Authorization: `Bearer ${token}`\n                                        },\n                                        body: JSON.stringify(q)\n                                      });\n\n                                      const data = await response.json();\n                                      if (!response.ok) {\n                                        throw new Error(data.error || 'Error al guardar la pregunta');\n                                      }\n\n                                      const saved = data.question || { ...q };\n                                      const next = [...manualQuestions, { ...saved, category: manualTopic }];\n\n                                      // If last question, bulk save (server may already store them individually, but keep compatibility)\n                                      if (next.length === manualCount) {\n                                        // Do a bulk save to keep existing API usage\n                                        const bulkResp = await fetch(`${apiBase}/questions/bulk`, {\n                                          method: 'POST',\n                                          headers: {\n                                            'Content-Type': 'application/json',\n                                            Authorization: `Bearer ${token}`\n                                          },\n                                          body: JSON.stringify({ questions: next })\n                                        });\n                                        const bulkData = await bulkResp.json();\n                                        if (!bulkResp.ok) {\n                                          throw new Error(bulkData.error || 'Error al guardar las preguntas en lote');\n                                        }\n\n                                        if (onQuestionsGenerated) {\n                                          onQuestionsGenerated(next);\n                                        }\n\n                                        setStatusMessage('¬°Todas las preguntas han sido guardadas exitosamente!');\n                                        setTimeout(() => {\n                                          setShowManualForm(false);\n                                          setStatusMessage('');\n                                        }, 1500);\n                                        return next;\n                                      } else {\n                                        setManualQuestions(next);\n                                        setManualStep(prev => prev + 1);\n                                        setStatusMessage(`¬°Pregunta ${next.length} de ${manualCount} guardada exitosamente!`);\n                                        setTimeout(() => setStatusMessage(''), 1500);\n                                        return saved;\n                                      }\n                                    } catch (error) {\n                                      setError('No se pudo guardar la pregunta: ' + (error.message || 'Por favor, intenta de nuevo.'));\n                                    } finally {\n                                      setLoading(false);\n                                    }\n                                  }}\n                                  onCancel={() => { setShowManualForm(false); }}\n                                />\n            </div>\n          )}\n        </div>\n      )}\n      {showOCRForm && (\n        <OCRQuestionCapture\n          topics={topics}\n          onQuestionExtracted={async (questionPayload) => {\n            setLoading(true);\n            setError('');\n            try {\n              const apiBase = (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) || import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n              const token = user && user.getIdToken ? await user.getIdToken() : null;\n              const response = await fetch(`${apiBase}/questions`, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  ...(token ? { Authorization: `Bearer ${token}` } : {})\n                },\n                body: JSON.stringify(questionPayload)\n              });\n\n              if (response.ok) {\n                const result = await response.json();\n                const savedQuestion = result.question || { ...questionPayload };\n                const updatedQuestions = [...ocrQuestions, savedQuestion];\n                setOcrQuestions(updatedQuestions);\n                \n                setStatusMessage(`‚úÖ Pregunta ${updatedQuestions.length} guardada exitosamente. Puedes agregar m√°s o finalizar.`);\n                setLoading(false);\n                \n                // Mantener modal abierto para agregar m√°s preguntas\n                // No cierra autom√°ticamente despu√©s de guardar\n              } else {\n                setError('No se pudo guardar la pregunta');\n                setLoading(false);\n              }\n            } catch (error) {\n              setError('Error al guardar la pregunta: ' + (error.message || 'Por favor, intenta de nuevo.'));\n              setLoading(false);\n            }\n          }}\n          onCancel={() => { \n            setShowOCRForm(false);\n            \n            // Si hay preguntas guardadas, notifica al parent\n            if (ocrQuestions.length > 0) {\n              setStatusMessage(`‚úÖ Se guardaron ${ocrQuestions.length} pregunta(s) de OCR`);\n              \n              setTimeout(() => {\n                onQuestionsGenerated(ocrQuestions);\n                setOcrQuestions([]);\n                setStatusMessage('');\n              }, 1500);\n            }\n          }}\n        />\n      )}\n      {showImageAnalysisForm && (\n        <ImageAnalysisQuestionCreator\n          topics={topics}\n          onQuestionCreated={async (questionPayload) => {\n            setLoading(true);\n            setError('');\n            try {\n              const apiBase =\n                (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) ||\n                import.meta.env.VITE_API_URL ||\n                'http://localhost:5000/api';\n              const token = user && user.getIdToken ? await user.getIdToken() : null;\n              const response = await fetch(`${apiBase}/questions`, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  ...(token ? { Authorization: `Bearer ${token}` } : {})\n                },\n                body: JSON.stringify(questionPayload)\n              });\n              const result = await response.json();\n              if (!response.ok) {\n                throw new Error(result.error || 'No se pudo guardar la pregunta');\n              }\n              const savedQuestion = result.question || { ...questionPayload };\n              const updated = [...visionQuestions, savedQuestion];\n              setVisionQuestions(updated);\n              setStatusMessage(`‚úÖ Pregunta ${updated.length} guardada desde an√°lisis de imagen`);\n              return savedQuestion;\n            } catch (err) {\n              setError('Error al guardar la pregunta: ' + (err.message || 'Intenta de nuevo.'));\n              throw err;\n            } finally {\n              setLoading(false);\n            }\n          }}\n          onCancel={() => {\n            setShowImageAnalysisForm(false);\n            if (visionQuestions.length > 0) {\n              setStatusMessage(`‚úÖ Se guardaron ${visionQuestions.length} pregunta(s) desde an√°lisis de imagen`);\n              setTimeout(() => {\n                onQuestionsGenerated(visionQuestions);\n                setVisionQuestions([]);\n                setStatusMessage('');\n              }, 1500);\n            }\n          }}\n        />\n      )}\n      {showObjectDetectionForm && (\n        <ObjectDetectionQuestionCreator\n          topics={topics}\n          onQuestionCreated={async (questionPayload) => {\n            setLoading(true);\n            setError('');\n            try {\n              const apiBase =\n                (typeof window !== 'undefined' && window.ENV?.VITE_API_URL) ||\n                import.meta.env.VITE_API_URL ||\n                'http://localhost:5000/api';\n              const token = user && user.getIdToken ? await user.getIdToken() : null;\n              const response = await fetch(`${apiBase}/questions`, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  ...(token ? { Authorization: `Bearer ${token}` } : {})\n                },\n                body: JSON.stringify(questionPayload)\n              });\n              const result = await response.json();\n              if (!response.ok) {\n                throw new Error(result.error || 'No se pudo guardar la pregunta');\n              }\n              const savedQuestion = result.question || { ...questionPayload };\n              const updated = [...visionQuestions, savedQuestion];\n              setVisionQuestions(updated);\n              setStatusMessage(`‚úÖ Pregunta guardada. Puedes crear otra o finalizar.`);\n              // NO cerrar el formulario - permitir crear m√∫ltiples preguntas\n              // setShowObjectDetectionForm(false); <- ELIMINADO\n              \n              setTimeout(() => {\n                setStatusMessage('');\n              }, 2000);\n              \n              return savedQuestion;\n            } catch (err) {\n              setError('Error al guardar la pregunta: ' + (err.message || 'Intenta de nuevo.'));\n              throw err;\n            } finally {\n              setLoading(false);\n            }\n          }}\n          onCancel={() => {\n            // Cuando el usuario cancela, finalizamos con todas las preguntas acumuladas\n            setShowObjectDetectionForm(false);\n            setTimeout(() => {\n              onQuestionsGenerated(visionQuestions);\n              setVisionQuestions([]);\n              setStatusMessage('');\n            }, 300);\n          }}\n        />\n      )}\n    </Modal>\n  );\n}\n\nexport default AIQuestionGenerator;"],"names":["ManualQuestionForm","topics","onQuestionCreated","onCancel","isVoiceModeEnabled","speak","useVoice","user","useAuth","formData","setFormData","useState","error","setError","loading","setLoading","successMessage","setSuccessMessage","handleOptionChange","idx","value","prev","opt","i","validateForm","useCallback","useEffect","validationError","handleSubmit","e","payload","result","savedText","err","jsxs","jsx","Button","parts","Alert","t","Input","MAX_IMAGE_SIZE","ALLOWED_TYPES","MAX_GAME_IMAGE_BYTES","INITIAL_OPTIONS","buildUniqueList","items","seen","item","key","capitalize","text","getBase64PayloadBytes","base64","loadImageElement","dataUrl","resolve","reject","img","downscaleBase64","maxBytes","maxDimension","image","scale","canvas","qualities","quality","output","ensureBase64UnderLimit","ImageAnalysisQuestionCreator","fileInputRef","useRef","apiBase","selectedTopic","setSelectedTopic","imageFile","setImageFile","imagePreview","setImagePreview","analysis","setAnalysis","questionSuggestions","setQuestionSuggestions","questionDraft","setQuestionDraft","analyzing","setAnalyzing","saving","setSaving","justSaved","setJustSaved","validateFile","file","readFileAsDataURL","reader","event","handleFileChange","preview","optimized","analyzeImage","token","response","data","autoPopulateDraft","caption","spoken","message","analysisResult","suggestions","imageBase64","primaryCaption","baseQuestion","tagNames","tag","objectNames","obj","suggestionOptions","mergedOptions","trimmedOptions","suggestedAnswer","suggestedIndex","validateQuestionDraft","handleSaveQuestion","resetFlow","Fragment","Spinner","Badge","c","cat","o","color","topic","option","ObjectDetectionQuestionCreator","canvasRef","detecting","setDetecting","detection","setDetection","confidenceThreshold","setConfidenceThreshold","selectedObject","setSelectedObject","questionType","setQuestionType","hoveredObject","setHoveredObject","step","setStep","questionsCreated","setQuestionsCreated","justSavedQuestion","setJustSavedQuestion","detectObjects","drawBoundingBoxes","objectCount","topObjects","objects","ctx","x","y","w","h","label","textWidth","generateQuestion","filteredObjects","question","options","correctAnswerIndex","explanation","uniqueObjects","count","confirmQuestion","questionData","handleCancel","newOptions","Modal","open","title","onClose","children","className","handleEsc","originalOverflow","AnimatePresence","motion","AIQuestionGenerator","onQuestionsGenerated","setTopics","selectedDifficulty","setSelectedDifficulty","questionCount","setQuestionCount","questionCountInput","setQuestionCountInput","useAI","setUseAI","showManualForm","setShowManualForm","showOCRForm","setShowOCRForm","showImageAnalysisForm","setShowImageAnalysisForm","showObjectDetectionForm","setShowObjectDetectionForm","manualCount","setManualCount","manualCountInput","setManualCountInput","manualStep","setManualStep","manualQuestions","setManualQuestions","manualTopic","setManualTopic","ocrQuestions","setOcrQuestions","visionQuestions","setVisionQuestions","statusMessage","setStatusMessage","difficultyLevels","setDifficultyLevels","loadTopics","loadDifficultyLevels","fetchTopics","levels","fetchDifficultyLevels","generateQuestions","questionsWithMeta","q","optionsWithIndex","j","newCorrectIndex","bulkToken","saveResult","LoadingOverlay","digits","num","normalized","saved","next","bulkResp","bulkData","OCRQuestionCapture","questionPayload","savedQuestion","updatedQuestions","updated"],"mappings":"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"}