import{a as q,u as G,r as c,j as e}from"./index-CGdjcbgg.js";import{B as g}from"./Button-BVl7jPIk.js";import{A as k}from"./Alert-CiOSpG0n.js";import{S as D}from"./LoadingOverlay-BPWbBUhW.js";const _=({topics:S,onQuestionExtracted:E,onCancel:F})=>{const{isVoiceModeEnabled:t,speak:n}=q(),{user:J}=G(),[v,y]=c.useState(null),[N,z]=c.useState(S[0]||""),[x,w]=c.useState(null),[A,C]=c.useState(null),[m,h]=c.useState(!1),[M,o]=c.useState(""),[O,b]=c.useState(""),[l,f]=c.useState(null),[H,K]=c.useState({pregunta:"",opciones:{a:"",b:"",c:"",d:""}}),[j,P]=c.useState(0),[u,R]=c.useState([]),Q=c.useRef(null),$="http://localhost:5000/api",L=a=>{const r=a.target.files?.[0];if(!r)return;if(!["image/jpeg","image/png","image/jpg"].includes(r.type)){o("Por favor selecciona una imagen (PNG, JPG, JPEG)");return}if(r.size>10*1024*1024){o("La imagen es demasiado grande. M√°ximo 10MB");return}w(r),o("");const s=new FileReader;s.onload=d=>{C(d.target.result)},s.readAsDataURL(r),t&&n(`Imagen seleccionada: ${r.name}. Presiona procesar para extraer la pregunta.`,{force:!0})},B=async()=>{if(!x){o("Por favor selecciona o captura una imagen");return}h(!0),o(""),b("");try{const a=new FileReader;a.onload=async r=>{const s=r.target.result;try{const i=await(await fetch(`${$}/ocr/process-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:s,mimeType:x.type||"image/jpeg",language:"es"})})).json();if(i.success){const p=i.pregunta&&!i.pregunta.includes("no detectada"),V=Object.values(i.opciones||{}).filter(T=>T&&!T.includes("no detectada"));!p||V.length===0?(f({pregunta:i.pregunta||"",opciones:i.opciones||{a:"",b:"",c:"",d:""}}),b("‚ö†Ô∏è Detecci√≥n parcial. Por favor completa los campos vac√≠os manualmente."),t&&n("Extracci√≥n parcial. Por favor completa la pregunta y las opciones manualmente.",{force:!0})):(f({pregunta:i.pregunta,opciones:i.opciones}),b("‚úÖ Pregunta extra√≠da correctamente"),t&&n(`Pregunta detectada: ${i.pregunta}`,{force:!0}))}else o(i.error||"Error procesando la imagen")}catch(d){o(`Error al procesar la imagen: ${d.message}`)}finally{h(!1)}},a.readAsDataURL(x)}catch(a){o(`Error: ${a.message}`),h(!1)}},U=async()=>{const a=l.pregunta?.trim(),r=l.opciones,s=[r.a?.trim()||"",r.b?.trim()||"",r.c?.trim()||"",r.d?.trim()||""].filter(p=>p),d=s.length>=2;if(!a){o("Por favor escribe la pregunta");return}if(!d){o("Por favor completa al menos 2 opciones de respuesta");return}if(!N){o("Por favor selecciona un tema");return}if(j<0||j>=s.length){o("Por favor selecciona cu√°l opci√≥n es correcta");return}h(!0),o("");const i={text:a,options:s,correctAnswerIndex:j,category:N,explanation:""};try{E&&(await E(i),b("‚úÖ Pregunta guardada exitosamente"),R([...u,i]),setTimeout(()=>{w(null),C(null),f(null),y(null),P(0),b("")},2e3))}catch(p){o(`Error al guardar la pregunta: ${p.message}`)}finally{h(!1)}},I=()=>{w(null),C(null),f(null),y(null),P(0),stopCamera(),o(""),b("")};return t&&!v&&!x&&c.useEffect(()=>{n("Formulario de captura de pregunta. Selecciona una imagen o toma una foto.",{force:!0})},[]),e.jsxs("div",{className:"grid gap-4 p-4",children:[t&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(g,{variant:"outline",size:"sm",type:"button",onClick:async()=>{await n("Captura de pregunta. Puedes subir una imagen o tomar una foto desde la c√°mara. La aplicaci√≥n extraer√° autom√°ticamente el texto y las opciones.",{force:!0})},"aria-label":"Explicar la p√°gina",children:"üõà Explicar p√°gina"})}),M&&e.jsx(k,{intent:"error",children:M}),O&&e.jsx(k,{intent:"success",children:O}),u.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-white",children:["‚úÖ ",u.length," pregunta",u.length!==1?"s":""," guardada",u.length!==1?"s":""]}),e.jsx(g,{variant:"outline",size:"sm",onClick:F,className:"text-xs",children:"Finalizar"})]}),!v&&!x&&!l&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Crear pregunta"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsx(g,{onClick:()=>y("upload"),size:"lg",onFocus:()=>t&&n("Subir imagen",{force:!0}),onMouseEnter:()=>t&&n("Subir imagen",{force:!0}),children:"üì± Subir imagen"})})]}),v==="upload"&&!l&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Subir imagen"}),e.jsx("input",{ref:Q,type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:L,className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white"})]}),x&&!l&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Vista previa"}),A&&e.jsx("img",{src:A,alt:"Preview",className:"w-full max-h-96 rounded-xl object-contain border-2 border-white/10"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{onClick:B,disabled:m,size:"lg",onFocus:()=>t&&n("Procesar imagen",{force:!0}),onMouseEnter:()=>t&&n("Procesar imagen",{force:!0}),children:m?e.jsx(D,{size:"sm"}):"‚ö° Procesar"}),e.jsx(g,{variant:"secondary",onClick:I,disabled:m,onFocus:()=>t&&n("Seleccionar otra imagen",{force:!0}),onMouseEnter:()=>t&&n("Seleccionar otra imagen",{force:!0}),children:"Cambiar imagen"})]})]}),l&&e.jsxs("div",{className:"grid gap-4 p-4 bg-white/5 rounded-xl border-2 border-bb-primary/30",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Pregunta extra√≠da"}),!l.pregunta||l.pregunta.includes("Pregunta no detectada")?e.jsx("div",{className:"p-3 bg-orange-500/10 border border-orange-400/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-300",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Importante:"})," OCR no detect√≥ la pregunta correctamente. Por favor completa los campos manualmente."]})}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Tema"}),e.jsx("select",{value:N,onChange:a=>z(a.target.value),className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:S.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Pregunta *"}),e.jsx("textarea",{defaultValue:l.pregunta||"",placeholder:"Escribe la pregunta aqu√≠...",className:"p-3 rounded-xl bg-white/5 border border-white/10 text-white break-words focus:outline-none focus:ring-2 focus:ring-bb-primary/30 focus:border-bb-primary resize-none",rows:"3",onChange:a=>{f(r=>({...r,pregunta:a.target.value}))}})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Opciones de respuesta *"}),e.jsx("p",{className:"text-xs text-white/60",children:"Al menos 2 opciones son requeridas"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((a,r)=>{const s=l.opciones[a],d=!s||s.trim()===""||s.includes("no detectada");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-bold text-bb-primary min-w-[2rem]",children:[a.toUpperCase(),")"]}),e.jsx("input",{type:"text",defaultValue:s&&!s.includes("no detectada")?s:"",placeholder:`Opci√≥n ${a.toUpperCase()} (opcional)`,className:`p-2 rounded-lg bg-white/5 border text-white flex-1 break-words focus:outline-none focus:ring-2 ${d?"border-orange-400/50 focus:ring-orange-400/30":"border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary"}`,onChange:i=>{f(p=>({...p,opciones:{...p.opciones,[a]:i.target.value}}))}})]},a)})}),e.jsx("p",{className:"text-xs text-orange-300",children:"‚ö†Ô∏è Los campos en naranja no fueron detectados. Ed√≠talos manualmente."})]}),e.jsxs("div",{className:"grid gap-3 p-3 bg-bb-primary/10 rounded-lg border border-bb-primary/30",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"¬øCu√°l es la respuesta correcta? *"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((a,r)=>{const s=l.opciones[a],d=!s||s.trim()===""||s.includes("no detectada");return d?null:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"correctOption",checked:j===r,onChange:()=>P(r),disabled:m||d,className:"h-4 w-4 cursor-pointer"}),e.jsxs("span",{className:"text-sm",children:[e.jsxs("strong",{children:[a.toUpperCase(),")"]})," ",s]}),j===r&&e.jsx("span",{className:"ml-auto text-bb-primary font-bold",children:"‚úì Correcta"})]},a)})})]}),e.jsx("p",{className:"text-sm text-white/60",children:"‚ÑπÔ∏è Puedes editar la pregunta manualmente. Es importante que completes todos los campos correctamente."}),u.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40",children:[e.jsxs("p",{className:"text-sm font-semibold text-white mb-2",children:["‚úÖ ",u.length," pregunta",u.length!==1?"s":""," guardada",u.length!==1?"s":""," - Puedes guardar esta y agregar m√°s"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"text-xs text-bb-primary/80",children:"üí° Confirma y luego agrega otra"})})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{onClick:U,size:"lg",disabled:m,onFocus:()=>t&&n("Confirmar y guardar",{force:!0}),onMouseEnter:()=>t&&n("Confirmar y guardar",{force:!0}),children:m?"‚è≥ Guardando‚Ä¶":"‚úì Confirmar"}),e.jsx(g,{variant:"secondary",onClick:I,disabled:m,onFocus:()=>t&&n("Capturar otra imagen",{force:!0}),onMouseEnter:()=>t&&n("Capturar otra imagen",{force:!0}),children:"üì∑ Otra imagen"}),e.jsx(g,{variant:"secondary",onClick:F,disabled:m,onFocus:()=>t&&n("Atr√°s",{force:!0}),onMouseEnter:()=>t&&n("Atr√°s",{force:!0}),children:"Atr√°s"})]})})]})]})};export{_ as O};
//# sourceMappingURL=OCRQuestionCapture-BoRzf-2s.js.map
