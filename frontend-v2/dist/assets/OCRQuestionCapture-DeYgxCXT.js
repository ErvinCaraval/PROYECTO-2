import{a as V,r as i,j as e}from"./index-Co_jp48e.js";import{B as l}from"./Button-BLaDiuLl.js";import{A as E}from"./Alert-BF2rtmmZ.js";import{S as D}from"./LoadingOverlay-CyIx_YA8.js";const X=({topics:z,onQuestionExtracted:A,onCancel:y})=>{const{isVoiceModeEnabled:m,speak:g}=V(),F=i.useRef(null),O="http://localhost:5000/api",[f,j]=i.useState(null),[w,$]=i.useState(z[0]||""),[u,S]=i.useState(null),[R,C]=i.useState(null),[c,x]=i.useState(!1),[T,o]=i.useState(""),[k,p]=i.useState(""),[n,h]=i.useState(null),[v,P]=i.useState(0),[d,G]=i.useState([]),Q=a=>["image/jpeg","image/png","image/jpg"].includes(a.type)?a.size>10485760?"Imagen demasiado grande. M√°ximo 10MB.":null:"Formato inv√°lido. Solo PNG, JPG o JPEG.",B=()=>{const a=n.pregunta?.trim(),r=n.opciones,t=["a","b","c","d"].map(s=>r[s]?.trim()||"").filter(s=>s&&!s.includes("no detectada"));return a?t.length<2?"M√≠nimo 2 opciones v√°lidas.":w?v>=t.length?"Selecciona respuesta correcta.":null:"Selecciona un tema.":"Escribe la pregunta."},J=a=>{const r=a.target.files?.[0];if(!r)return;const t=Q(r);if(t){o(t);return}S(r),o("");const s=new FileReader;s.onload=b=>C(b.target.result),s.readAsDataURL(r),m&&g(`Imagen seleccionada: ${r.name}. Presiona procesar.`,{force:!0})},L=async()=>{if(!u||!O){o("Selecciona una imagen v√°lida o configura el API.");return}x(!0),o(""),p("");try{const a=new FileReader;a.onload=async r=>{try{const s=await(await fetch(`${O}/ocr/process-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:r.target.result,mimeType:u.type||"image/jpeg",language:"es"})})).json();if(s.success){const b=s.pregunta&&!s.pregunta.includes("no detectada"),N=Object.values(s.opciones||{}).filter(M=>M&&!M.includes("no detectada"));!b||N.length===0?(p("‚ö†Ô∏è Detecci√≥n parcial. Completa los campos.",{force:!0}),m&&g("Extracci√≥n parcial. Completa manualmente.",{force:!0})):(p("‚úÖ Pregunta extra√≠da correctamente"),m&&g(`Pregunta detectada: ${s.pregunta}`,{force:!0})),h({pregunta:s.pregunta||"",opciones:s.opciones||{a:"",b:"",c:"",d:""}})}else o(s.error||"Error procesando imagen.")}catch(t){o(`Error: ${t.message}`)}finally{x(!1)}},a.readAsDataURL(u)}catch(a){o(`Error: ${a.message}`),x(!1)}},U=async()=>{const a=B();if(a){o(a);return}x(!0),o("");const r=["a","b","c","d"].map(s=>n.opciones[s]?.trim()||"").filter(s=>s&&!s.includes("no detectada")),t={text:n.pregunta.trim(),options:r,correctAnswerIndex:v,category:w,explanation:""};try{A&&(await A(t),G([...d,t]),p("‚úÖ Pregunta guardada exitosamente"),m&&g("Pregunta guardada. Puedes agregar m√°s.",{force:!0}),setTimeout(()=>{S(null),C(null),h(null),j(null),P(0),p("")},2e3))}catch(s){o(`Error al guardar: ${s.message}`)}finally{x(!1)}},I=()=>{S(null),C(null),h(null),j(null),P(0),o(""),p("")};return i.useEffect(()=>{m&&!f&&!u&&g("Captura de pregunta. Sube una imagen para comenzar.",{force:!0})},[m,f,u]),e.jsxs("div",{className:"grid gap-4 p-4",children:[m&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{await g("Sube una imagen. La aplicaci√≥n extrae autom√°ticamente texto y opciones. Edita si necesario y guarda.",{force:!0})},children:"üõà Explicar"})}),T&&e.jsx(E,{intent:"error",children:T}),k&&e.jsx(E,{intent:"success",children:k}),d.length>0&&!n&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-green-500/20 to-green-500/10 rounded-lg border border-green-400/30",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-white",children:["‚úÖ ",d.length," pregunta",d.length!==1?"s":""," guardada",d.length!==1?"s":""]}),e.jsx("p",{className:"text-xs text-green-300 mt-1",children:"üí° Agregar m√°s o finalizar"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>j("upload"),children:"üì∑ Otra imagen"}),e.jsx(l,{variant:"secondary",size:"sm",onClick:y,children:"‚úì Finalizar"})]})]}),!f&&!u&&!n&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Crear pregunta desde imagen"}),e.jsx(l,{onClick:()=>j("upload"),size:"lg",children:"üì± Subir imagen"})]}),f==="upload"&&!n&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Subir imagen con texto"}),e.jsx("input",{ref:F,type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:J,className:"block w-full rounded-xl border-2 border-dashed border-white/20 bg-white/5 px-4 py-6 text-white cursor-pointer hover:border-white/40 hover:bg-white/10 transition"}),e.jsx("p",{className:"text-xs text-white/50",children:"PNG, JPG o JPEG. M√°ximo 10MB."})]}),u&&!n&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Vista previa"}),R&&e.jsx("img",{src:R,alt:"Preview",className:"w-full max-h-96 rounded-xl object-contain border-2 border-white/10"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(l,{onClick:L,disabled:c,size:"lg",children:c?e.jsx(D,{size:"sm"}):"‚ö° Procesar"}),e.jsx(l,{variant:"secondary",onClick:I,disabled:c,children:"Cambiar imagen"})]})]}),n&&e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-bb-primary/20 to-bb-primary/10 rounded-xl border-2 border-bb-primary/40",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"üìù Editar Pregunta"}),e.jsx("p",{className:"text-xs text-white/70",children:"Verifica y completa todos los campos"})]}),!n.pregunta||n.pregunta.includes("no detectada")&&e.jsxs(E,{intent:"warning",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Completar manualmente:"})," OCR no detect√≥ la pregunta correctamente."]}),e.jsxs("div",{className:"grid gap-2.5",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"Tema"}),e.jsx("select",{value:w,onChange:a=>$(a.target.value),className:"w-full px-4 py-3 rounded-xl border-2 border-white/10 bg-white/5 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 transition",children:z.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"grid gap-2.5",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"Pregunta"}),e.jsx("textarea",{value:n.pregunta||"",onChange:a=>h(r=>({...r,pregunta:a.target.value})),placeholder:"Escribe la pregunta...",className:"w-full p-4 rounded-xl bg-white/5 border-2 border-white/10 text-white focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 resize-none transition",rows:"4"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"Opciones de respuesta"}),e.jsx("span",{className:"text-xs text-white/60",children:"M√≠nimo 2"})]}),e.jsx("div",{className:"grid gap-3 p-4 bg-white/5 rounded-lg border border-white/10",children:["a","b","c","d"].map((a,r)=>{const t=n.opciones[a],s=!t||t.trim()===""||t.includes("no detectada");return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-bold text-bb-primary text-lg w-8",children:[a.toUpperCase(),")"]}),e.jsx("input",{type:"text",value:t&&!t.includes("no detectada")?t:"",onChange:b=>h(N=>({...N,opciones:{...N.opciones,[a]:b.target.value}})),className:`flex-1 px-3 py-2 rounded-lg bg-white/5 border text-white text-sm focus:outline-none focus:ring-2 transition ${s?"border-orange-400/50 focus:ring-orange-400/30":"border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary"}`,placeholder:s?"Nueva opci√≥n":""}),e.jsx("input",{type:"radio",name:"correctOption",checked:v===r,onChange:()=>P(r),disabled:s||c,className:"h-5 w-5 cursor-pointer accent-bb-primary"})]},a)})}),["a","b","c","d"].some(a=>{const r=n.opciones[a];return!r||r.trim()===""||r.includes("no detectada")})&&e.jsx("p",{className:"text-xs text-orange-300",children:"‚ö†Ô∏è Campos en naranja necesitan edici√≥n."})]}),e.jsxs("div",{className:"p-4 bg-bb-primary/15 rounded-lg border border-bb-primary/40",children:[e.jsx("p",{className:"text-sm font-semibold text-white mb-2",children:"‚úì Respuesta Correcta:"}),e.jsx("p",{className:"text-sm text-white/80",children:(()=>{const r=["a","b","c","d"][v],t=n.opciones[r];return t&&!t.includes("no detectada")?`${r.toUpperCase()}) ${t}`:"‚ö†Ô∏è Selecciona una v√°lida"})()})]}),e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-400/30 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-300",children:"‚ÑπÔ∏è Revisa todo antes de guardar. Puedes editar cualquier campo."})}),d.length>0&&e.jsx("div",{className:"p-3 bg-green-500/10 border border-green-400/30 rounded-lg",children:e.jsxs("p",{className:"text-sm font-semibold text-green-300",children:["‚úÖ ",d.length," guardada",d.length!==1?"s":""]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:flex gap-2 pt-2",children:[e.jsx(l,{onClick:U,disabled:c,className:"flex-1 sm:flex-initial",children:c?"‚è≥ Guardando‚Ä¶":"‚úîÔ∏è Guardar"}),e.jsx(l,{variant:"secondary",onClick:I,disabled:c,className:"flex-1 sm:flex-initial",children:"üì∑ Otra"}),d.length>0?e.jsx(l,{variant:"secondary",onClick:y,disabled:c,className:"flex-1 sm:flex-initial",children:"‚úì Finalizar"}):e.jsx(l,{variant:"secondary",onClick:y,disabled:c,className:"flex-1 sm:flex-initial",children:"‚Üê Atr√°s"})]})]})]})};export{X as O};
//# sourceMappingURL=OCRQuestionCapture-DeYgxCXT.js.map
