import{a as ie,u as ce,r as s,j as e}from"./index-CMoEGUiI.js";import{B as m}from"./Button-B_8-NTTl.js";import{I as se}from"./Input-BPPQmrKT.js";import{A as H}from"./Alert-CTWu5Bwd.js";import{S as de,L as pe}from"./LoadingOverlay-DZ4WNgLb.js";import{a as me,b as ge}from"./api-DoyG0mL_.js";import{A as fe}from"./Skeleton-CFeuzcza.js";import{m as ue}from"./socket-JaDOxgwZ.js";const xe=({topics:w,onQuestionCreated:z,onCancel:d})=>{const{isVoiceModeEnabled:r,speak:t}=ie(),{user:F}=ce(),[f,x]=s.useState({question:"",options:["","","",""],correctIndex:0,selectedTopic:w[0]||""}),[q,$]=s.useState(""),[j,P]=s.useState(!1),[B,N]=s.useState(""),D=(i,l)=>{x(g=>({...g,options:g.options.map((A,c)=>c===i?l:A)}))},T=s.useCallback(()=>f.question.trim()?f.options.some(i=>!i.trim())?"Todas las opciones son requeridas":"":"La pregunta es requerida",[f]);s.useEffect(()=>{const i=T();$(i)},[f,F,T]);const J=async i=>{i.preventDefault();const l=T();if(l){$(l);return}P(!0),$(""),N("");try{const g={text:f.question,options:f.options,correctAnswerIndex:f.correctIndex,category:f.selectedTopic,explanation:""};if(N("Guardando..."),z){const A=await Promise.resolve(z(g)),c=A&&A.text?A.text:g.text;N(`Pregunta creada: "${c}"`)}else N("Â¡Pregunta preparada!")}catch(g){console.error("Error al preparar la pregunta:",g),$(g.message||"Error al guardar la pregunta")}finally{P(!1)}};return e.jsxs("form",{className:"grid gap-4",onSubmit:J,children:[r&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(m,{variant:"outline",size:"sm",type:"button",onClick:async()=>{const i=[];i.push("Formulario para escribir preguntas manualmente."),i.push("Campo Tema: selecciona el tema de la pregunta."),i.push("Campo Pregunta: escribe el texto de la pregunta."),i.push("Opciones: escribe las posibles respuestas. Marca cuÃ¡l es la correcta con el botÃ³n de opciÃ³n."),i.push("BotÃ³n AtrÃ¡s: vuelve al generador de preguntas."),i.push("BotÃ³n Guardar: guarda la pregunta actual."),await t(i.join(" "),{action:"page_guide",questionId:"manual_question_form",force:!0})},"aria-label":"Explicar la pÃ¡gina",children:"ðŸ›ˆ Explicar pÃ¡gina"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Escribe tu pregunta"}),q&&e.jsx(H,{intent:"error",children:q}),B&&e.jsx(H,{intent:"success",children:B}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",htmlFor:"topic-select",children:"Tema"}),e.jsx("select",{id:"topic-select",value:f.selectedTopic,onChange:i=>x(l=>({...l,selectedTopic:i.target.value})),disabled:j,className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:w.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",htmlFor:"question-input",children:"Pregunta"}),e.jsx(se,{id:"question-input",type:"text",value:f.question,onChange:i=>x(l=>({...l,question:i.target.value})),disabled:j,required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Opciones"}),e.jsx("div",{className:"grid gap-3",children:f.options.map((i,l)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{type:"text",value:i,onChange:g=>D(l,g.target.value),disabled:j,required:!0,placeholder:`OpciÃ³n ${l+1}`,className:"flex-1"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"radio",name:"correctOption",checked:f.correctIndex===l,onChange:()=>x(g=>({...g,correctIndex:l})),disabled:j,className:"h-4 w-4"}),e.jsx("span",{children:"Correcta"})]})]},l))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(m,{type:"button",variant:"secondary",onClick:d,disabled:j,onFocus:()=>r&&t("AtrÃ¡s: vuelve al generador de preguntas.",{force:!0}),onMouseEnter:()=>r&&t("AtrÃ¡s: vuelve al generador de preguntas.",{force:!0}),children:"AtrÃ¡s"}),e.jsx(m,{type:"submit",disabled:j,onFocus:()=>r&&t("Guardar: guarda la pregunta actual.",{force:!0}),onMouseEnter:()=>r&&t("Guardar: guarda la pregunta actual.",{force:!0}),children:j?"Guardandoâ€¦":"Guardar"})]})]})},he=({topics:w,onQuestionExtracted:z,onCancel:d})=>{const{isVoiceModeEnabled:r,speak:t}=ie(),{user:F}=ce(),[f,x]=s.useState(null),[q,$]=s.useState(w[0]||""),[j,P]=s.useState(null),[B,N]=s.useState(null),[D,T]=s.useState(null),[J,i]=s.useState(null),[l,g]=s.useState(!1),[A,c]=s.useState(""),[U,I]=s.useState(""),[v,R]=s.useState(null),[ee,ne]=s.useState({pregunta:"",opciones:{a:"",b:"",c:"",d:""}}),[L,K]=s.useState(0),[O,X]=s.useState([]),ae=s.useRef(null),V=s.useRef(null),le="http://localhost:5000/api",Y=n=>{const p=n.target.files?.[0];if(!p)return;if(!["image/jpeg","image/png","image/jpg"].includes(p.type)){c("Por favor selecciona una imagen (PNG, JPG, JPEG)");return}if(p.size>10*1024*1024){c("La imagen es demasiado grande. MÃ¡ximo 10MB");return}P(p),c("");const u=new FileReader;u.onload=y=>{N(y.target.result)},u.readAsDataURL(p),r&&t(`Imagen seleccionada: ${p.name}. Presiona procesar para extraer la pregunta.`,{force:!0})},C=async()=>{try{c("");const n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}},audio:!1});V.current&&(V.current.srcObject=n,T(n),r&&t("CÃ¡mara iniciada. Apunta a la pregunta y presiona tomar foto.",{force:!0}))}catch(n){c("No se pudo acceder a la cÃ¡mara. Verifica los permisos."),console.error("Camera error:",n)}},G=()=>{D&&(D.getTracks().forEach(n=>n.stop()),T(null))},h=()=>{if(!V.current)return;const n=document.createElement("canvas");n.width=V.current.videoWidth,n.height=V.current.videoHeight,n.getContext("2d").drawImage(V.current,0,0),n.toBlob(u=>{if(u){P(u);const y=new FileReader;y.onload=a=>{N(a.target.result)},y.readAsDataURL(u),G(),x(null),r&&t("Foto capturada. Presiona procesar para extraer la pregunta.",{force:!0})}},"image/jpeg",.9)},re=async()=>{if(!j){c("Por favor selecciona o captura una imagen");return}g(!0),c(""),I("");try{const n=new FileReader;n.onload=async p=>{const u=p.target.result;try{const a=await(await fetch(`${le}/ocr/process-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageBase64:u,mimeType:j.type||"image/jpeg",language:"es"})})).json();if(a.success){const o=a.pregunta&&!a.pregunta.includes("no detectada"),E=Object.values(a.opciones||{}).filter(S=>S&&!S.includes("no detectada"));!o||E.length===0?(R({pregunta:a.pregunta||"",opciones:a.opciones||{a:"",b:"",c:"",d:""}}),I("âš ï¸ DetecciÃ³n parcial. Por favor completa los campos vacÃ­os manualmente."),r&&t("ExtracciÃ³n parcial. Por favor completa la pregunta y las opciones manualmente.",{force:!0})):(R({pregunta:a.pregunta,opciones:a.opciones}),I("âœ… Pregunta extraÃ­da correctamente"),r&&t(`Pregunta detectada: ${a.pregunta}`,{force:!0}))}else c(a.error||"Error procesando la imagen")}catch(y){c(`Error al procesar la imagen: ${y.message}`)}finally{g(!1)}},n.readAsDataURL(j)}catch(n){c(`Error: ${n.message}`),g(!1)}},Q=async()=>{const n=v.pregunta?.trim(),p=v.opciones,u=[p.a?.trim()||"",p.b?.trim()||"",p.c?.trim()||"",p.d?.trim()||""].filter(o=>o),y=u.length>=2;if(!n){c("Por favor escribe la pregunta");return}if(!y){c("Por favor completa al menos 2 opciones de respuesta");return}if(!q){c("Por favor selecciona un tema");return}if(L<0||L>=u.length){c("Por favor selecciona cuÃ¡l opciÃ³n es correcta");return}g(!0),c("");const a={text:n,options:u,correctAnswerIndex:L,category:q,explanation:""};try{z&&(await z(a),I("âœ… Pregunta guardada exitosamente"),X([...O,a]),setTimeout(()=>{P(null),N(null),R(null),x(null),K(0),I("")},2e3))}catch(o){c(`Error al guardar la pregunta: ${o.message}`)}finally{g(!1)}},oe=()=>{P(null),N(null),R(null),x(null),K(0),G(),c(""),I("")};return r&&!f&&!j&&s.useEffect(()=>{t("Formulario de captura de pregunta. Selecciona una imagen o toma una foto.",{force:!0})},[]),e.jsxs("div",{className:"grid gap-4 p-4",children:[r&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(m,{variant:"outline",size:"sm",type:"button",onClick:async()=>{await t("Captura de pregunta. Puedes subir una imagen o tomar una foto desde la cÃ¡mara. La aplicaciÃ³n extraerÃ¡ automÃ¡ticamente el texto y las opciones.",{force:!0})},"aria-label":"Explicar la pÃ¡gina",children:"ðŸ›ˆ Explicar pÃ¡gina"})}),A&&e.jsx(H,{intent:"error",children:A}),U&&e.jsx(H,{intent:"success",children:U}),O.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-white",children:["âœ… ",O.length," pregunta",O.length!==1?"s":""," guardada",O.length!==1?"s":""]}),e.jsx(m,{variant:"outline",size:"sm",onClick:d,className:"text-xs",children:"Finalizar"})]}),!f&&!j&&!v&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Crear pregunta"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(m,{onClick:()=>x("upload"),size:"lg",onFocus:()=>r&&t("Subir imagen",{force:!0}),onMouseEnter:()=>r&&t("Subir imagen",{force:!0}),children:"ðŸ“± Subir imagen"}),e.jsx(m,{variant:"secondary",size:"lg",onClick:()=>{x("camera"),C()},onFocus:()=>r&&t("Tomar foto",{force:!0}),onMouseEnter:()=>r&&t("Tomar foto",{force:!0}),children:"ðŸ“· Tomar foto"}),e.jsx(m,{variant:"secondary",size:"lg",onClick:()=>{x("manual"),R({pregunta:"",opciones:{a:"",b:"",c:"",d:""}})},onFocus:()=>r&&t("Escribir manualmente",{force:!0}),onMouseEnter:()=>r&&t("Escribir manualmente",{force:!0}),children:"âœï¸ Escribir"})]})]}),f==="upload"&&!v&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Subir imagen"}),e.jsx("input",{ref:ae,type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:Y,className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white"})]}),f==="camera"&&!v&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tomar foto"}),e.jsx("video",{ref:V,autoPlay:!0,playsInline:!0,className:"w-full rounded-xl border-2 border-white/10 bg-black",style:{maxHeight:"500px",objectFit:"cover"}}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:h,size:"lg",onFocus:()=>r&&t("Capturar foto",{force:!0}),onMouseEnter:()=>r&&t("Capturar foto",{force:!0}),children:"ðŸ“¸ Capturar"}),e.jsx(m,{variant:"secondary",onClick:()=>{G(),x(null)},onFocus:()=>r&&t("Cancelar",{force:!0}),onMouseEnter:()=>r&&t("Cancelar",{force:!0}),children:"Cancelar"})]})]}),j&&!v&&e.jsxs("div",{className:"grid gap-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Vista previa"}),B&&e.jsx("img",{src:B,alt:"Preview",className:"w-full max-h-96 rounded-xl object-contain border-2 border-white/10"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:re,disabled:l,size:"lg",onFocus:()=>r&&t("Procesar imagen",{force:!0}),onMouseEnter:()=>r&&t("Procesar imagen",{force:!0}),children:l?e.jsx(de,{size:"sm"}):"âš¡ Procesar"}),e.jsx(m,{variant:"secondary",onClick:oe,disabled:l,onFocus:()=>r&&t("Seleccionar otra imagen",{force:!0}),onMouseEnter:()=>r&&t("Seleccionar otra imagen",{force:!0}),children:"Cambiar imagen"})]})]}),v&&e.jsxs("div",{className:"grid gap-4 p-4 bg-white/5 rounded-xl border-2 border-bb-primary/30",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Pregunta extraÃ­da"}),!v.pregunta||v.pregunta.includes("Pregunta no detectada")?e.jsx("div",{className:"p-3 bg-orange-500/10 border border-orange-400/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-300",children:["âš ï¸ ",e.jsx("strong",{children:"Importante:"})," OCR no detectÃ³ la pregunta correctamente. Por favor completa los campos manualmente."]})}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Tema"}),e.jsx("select",{value:q,onChange:n=>$(n.target.value),className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:w.map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Pregunta *"}),e.jsx("textarea",{defaultValue:v.pregunta||"",placeholder:"Escribe la pregunta aquÃ­...",className:"p-3 rounded-xl bg-white/5 border border-white/10 text-white break-words focus:outline-none focus:ring-2 focus:ring-bb-primary/30 focus:border-bb-primary resize-none",rows:"3",onChange:n=>{R(p=>({...p,pregunta:n.target.value}))}})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm text-white/80",children:"Opciones de respuesta *"}),e.jsx("p",{className:"text-xs text-white/60",children:"Al menos 2 opciones son requeridas"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((n,p)=>{const u=v.opciones[n],y=!u||u.trim()===""||u.includes("no detectada");return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-bold text-bb-primary min-w-[2rem]",children:[n.toUpperCase(),")"]}),e.jsx("input",{type:"text",defaultValue:u&&!u.includes("no detectada")?u:"",placeholder:`OpciÃ³n ${n.toUpperCase()} (opcional)`,className:`p-2 rounded-lg bg-white/5 border text-white flex-1 break-words focus:outline-none focus:ring-2 ${y?"border-orange-400/50 focus:ring-orange-400/30":"border-white/10 focus:ring-bb-primary/30 focus:border-bb-primary"}`,onChange:a=>{R(o=>({...o,opciones:{...o.opciones,[n]:a.target.value}}))}})]},n)})}),e.jsx("p",{className:"text-xs text-orange-300",children:"âš ï¸ Los campos en naranja no fueron detectados. EdÃ­talos manualmente."})]}),e.jsxs("div",{className:"grid gap-3 p-3 bg-bb-primary/10 rounded-lg border border-bb-primary/30",children:[e.jsx("label",{className:"text-sm font-semibold text-white",children:"Â¿CuÃ¡l es la respuesta correcta? *"}),e.jsx("div",{className:"grid gap-2",children:["a","b","c","d"].map((n,p)=>{const u=v.opciones[n],y=!u||u.trim()===""||u.includes("no detectada");return y?null:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"correctOption",checked:L===p,onChange:()=>K(p),disabled:l||y,className:"h-4 w-4 cursor-pointer"}),e.jsxs("span",{className:"text-sm",children:[e.jsxs("strong",{children:[n.toUpperCase(),")"]})," ",u]}),L===p&&e.jsx("span",{className:"ml-auto text-bb-primary font-bold",children:"âœ“ Correcta"})]},n)})})]}),e.jsx("p",{className:"text-sm text-white/60",children:"â„¹ï¸ Puedes editar la pregunta manualmente. Es importante que completes todos los campos correctamente."}),O.length>0&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-bb-primary/20 to-bb-primary/10 rounded-lg border border-bb-primary/40",children:[e.jsxs("p",{className:"text-sm font-semibold text-white mb-2",children:["âœ… ",O.length," pregunta",O.length!==1?"s":""," guardada",O.length!==1?"s":""," - Puedes guardar esta y agregar mÃ¡s"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"text-xs text-bb-primary/80",children:"ðŸ’¡ Confirma y luego agrega otra"})})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:Q,size:"lg",disabled:l,onFocus:()=>r&&t("Confirmar y guardar",{force:!0}),onMouseEnter:()=>r&&t("Confirmar y guardar",{force:!0}),children:l?"â³ Guardandoâ€¦":"âœ“ Confirmar"}),e.jsx(m,{variant:"secondary",onClick:oe,disabled:l,onFocus:()=>r&&t("Capturar otra imagen",{force:!0}),onMouseEnter:()=>r&&t("Capturar otra imagen",{force:!0}),children:"ðŸ“· Otra imagen"}),e.jsx(m,{variant:"secondary",onClick:d,disabled:l,onFocus:()=>r&&t("AtrÃ¡s",{force:!0}),onMouseEnter:()=>r&&t("AtrÃ¡s",{force:!0}),children:"AtrÃ¡s"})]})})]})]})};function be({open:w,title:z,onClose:d,children:r,className:t=""}){return s.useEffect(()=>{const F=x=>{x.key==="Escape"&&d?.()};w&&document.addEventListener("keydown",F);const f=document.body.style.overflow;return w&&(document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",F),document.body.style.overflow=f}},[w,d]),e.jsx(fe,{children:w&&e.jsxs(ue.div,{className:"fixed inset-0 z-[3000] flex items-center justify-center px-4 py-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{"aria-label":"Cerrar",className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:d}),e.jsxs(ue.div,{role:"dialog","aria-modal":"true",className:`relative w-full max-w-2xl max-h-[85vh] overflow-auto rounded-2xl border border-white/10 bg-bb-bg-primary/90 shadow-xl ${t}`,initial:{scale:.98,y:10,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.98,y:10,opacity:0},transition:{type:"spring",stiffness:200,damping:22},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-start justify-between gap-4 px-6 py-5 border-b border-white/10 bg-bb-bg-primary/90",children:[z?e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:z}):e.jsx("span",{className:"sr-only",children:"Modal"}),e.jsx("button",{onClick:d,className:"rounded-md p-2 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bb-primary","aria-label":"Cerrar",children:"âœ•"})]}),e.jsx("div",{className:"px-6 py-5",children:r})]})]})})}const ke=({onQuestionsGenerated:w,onClose:z})=>{const{isVoiceModeEnabled:d,speak:r}=ie(),{user:t}=ce(),[F,f]=s.useState([]),[x,q]=s.useState(""),[$,j]=s.useState("medium"),[P,B]=s.useState(null),[N,D]=s.useState(""),[T,J]=s.useState(!1),[i,l]=s.useState(!1),[g,A]=s.useState(!1),[c,U]=s.useState(null),[I,v]=s.useState(""),[R,ee]=s.useState(0),[ne,L]=s.useState([]),[K,O]=s.useState(""),[X,ae]=s.useState([]),[V,le]=s.useState(""),[Y,C]=s.useState(!1),[G,h]=s.useState(""),[re,Q]=s.useState(""),[oe,n]=s.useState([]);s.useEffect(()=>{p(),u()},[]),s.useEffect(()=>{D(typeof P=="number"?String(P):"")},[P]),s.useEffect(()=>{v(typeof c=="number"?String(c):"")},[c]);const p=async()=>{try{const a=await me();f(a),a.length>0&&q(a[0])}catch{h("Error obteniendo temas. Por favor intenta de nuevo.")}},u=async()=>{try{const a=await ge();n(a)}catch{h("No se pudieron cargar los niveles de dificultad. Por favor, intenta de nuevo mÃ¡s tarde.")}},y=async()=>{if(!x){h("Por favor selecciona un tema vÃ¡lido");return}C(!0),h("");try{const a="http://localhost:5000/api",o=t&&t.getIdToken?await t.getIdToken():null,S=await(await fetch(`${a}/ai/generate-questions`,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({topic:x,difficulty:$,count:P,useAI:T})})).json();if(S.success){const Z=S.questions.map(b=>({...(()=>{if(!Array.isArray(b.options)||typeof b.correctAnswerIndex!="number")return b;const M=b.options.map((k,te)=>({opt:k,origIdx:te}));for(let k=M.length-1;k>0;k--){const te=Math.floor(Math.random()*(k+1));[M[k],M[te]]=[M[te],M[k]]}const W=M.findIndex(k=>k.origIdx===b.correctAnswerIndex);return{...b,options:M.map(k=>k.opt),correctAnswerIndex:W}})(),createdBy:t?.uid||"anon",createdAt:Date.now(),category:x,difficulty:$}));let _=!1;try{const b=t&&t.getIdToken?await t.getIdToken():null,W=await(await fetch(`${a}/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({questions:Z})})).json();W.success?_=!0:(h(k=>(k?k+" | ":"")+(W.error||"Error guardando preguntas en Firestore")),h("No se pudieron guardar las preguntas. "+(W.error||"Por favor, intenta de nuevo.")))}catch{h("OcurriÃ³ un error al guardar las preguntas. Por favor, verifica tu conexiÃ³n e intenta de nuevo.")}if(!_){C(!1);return}w(S.questions),C(!1)}else h(S.error||"Error generando preguntas"),h("No se pudieron generar las preguntas: "+(S.error||"Por favor, intenta de nuevo."))}catch{h("Error de conexiÃ³n. Por favor, verifica tu conexiÃ³n a internet e intenta nuevamente.")}finally{C(!1)}};return e.jsxs(be,{open:!0,title:"ðŸ¤– Generador de Preguntas",onClose:z,children:[d&&!i&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx(m,{variant:"outline",size:"sm",type:"button",onClick:async()=>{const a=[];!i&&!T?(a.push("EstÃ¡s en el generador de preguntas."),a.push("BotÃ³n Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial."),a.push("BotÃ³n Escribir preguntas: te permite escribir preguntas manualmente."),a.push("Selecciona una opciÃ³n para continuar.")):T&&!i&&(a.push("Formulario para generar preguntas con inteligencia artificial."),a.push("Campo Tema: selecciona el tema de las preguntas."),a.push("Campo Dificultad: elige la dificultad."),a.push("Campo Cantidad: indica cuÃ¡ntas preguntas quieres generar."),a.push("BotÃ³n Crear preguntas: genera las preguntas."),a.push("BotÃ³n AtrÃ¡s: vuelve a la pantalla anterior.")),await r(a.join(" "),{action:"page_guide",questionId:"ai_question_generator",force:!0})},"aria-label":"Explicar la pÃ¡gina",onFocus:()=>r("Explicar pÃ¡gina: describe la funciÃ³n de cada botÃ³n y campo en esta vista.",{force:!0}),onMouseEnter:()=>r("Explicar pÃ¡gina: describe la funciÃ³n de cada botÃ³n y campo en esta vista.",{force:!0}),children:"ðŸ›ˆ Explicar pÃ¡gina"})}),Y&&e.jsx(pe,{text:"Generandoâ€¦",mobileOnly:!0}),G&&e.jsx(H,{intent:"error",children:G}),re&&e.jsx(H,{intent:"success",children:re}),!i&&!T&&!g&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(m,{onClick:()=>J(!0),size:"lg",onFocus:()=>d&&r("Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial.",{force:!0}),onMouseEnter:()=>d&&r("Crear con IA: genera preguntas automÃ¡ticamente usando inteligencia artificial.",{force:!0}),children:"ðŸ¤– Crear con IA"}),e.jsx(m,{variant:"secondary",size:"lg",onClick:()=>{l(!0),J(!1),ee(0),L([])},onFocus:()=>d&&r("Escribir preguntas: te permite escribir preguntas manualmente.",{force:!0}),onMouseEnter:()=>d&&r("Escribir preguntas: te permite escribir preguntas manualmente.",{force:!0}),children:"âœï¸ Escribir preguntas"}),e.jsx(m,{variant:"secondary",size:"lg",onClick:()=>{A(!0),J(!1)},onFocus:()=>d&&r("Capturar pregunta: extrae preguntas de imÃ¡genes usando OCR.",{force:!0}),onMouseEnter:()=>d&&r("Capturar pregunta: extrae preguntas de imÃ¡genes usando OCR.",{force:!0}),children:"ðŸ“¸ Capturar pregunta"})]}),!i&&T&&!g&&e.jsxs("form",{className:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4",onSubmit:async a=>{a.preventDefault(),C(!0),h("");try{await y(),h("")}catch{h("Error al generar preguntas. Por favor, intÃ©ntalo de nuevo.")}finally{C(!1)}},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"topic",className:"block mb-1 text-sm text-white/80",children:"Tema"}),e.jsx("select",{id:"topic",className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",value:x,onChange:a=>q(a.target.value),disabled:F.length===0,children:F.length===0?e.jsx("option",{value:"",children:"No hay temas"}):F.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"difficulty",className:"block mb-1 text-sm text-white/80",children:"Dificultad"}),e.jsxs("select",{id:"difficulty",className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",value:$,onChange:a=>j(a.target.value),children:[e.jsx("option",{value:"easy",children:"FÃ¡cil"}),e.jsx("option",{value:"medium",children:"Media"}),e.jsx("option",{value:"hard",children:"DifÃ­cil"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"numQuestions",className:"block mb-1 text-sm text-white/80",children:"Cantidad"}),e.jsxs("div",{children:[e.jsx(se,{id:"numQuestions",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:N,onChange:a=>{const o=a.target.value.replace(/\D+/g,"");D(o);const E=o?parseInt(o,10):NaN;Number.isNaN(E)?B(null):B(E)},onBlur:()=>{const a=parseInt(N||"",10);if(Number.isNaN(a)||a<1){B(null),D("");return}const o=Math.max(1,a);B(o),D(String(o))},required:!0,placeholder:"Cantidad",className:"w-28 text-center"}),(N===""||P===null)&&e.jsx("div",{className:`mt-1 text-xs ${N===""?"text-white/60":"text-red-300"}`,children:N===""?"Ingresa un nÃºmero (>= 1)":"Valor invÃ¡lido"})]})]}),G&&e.jsx(H,{intent:"error",className:"sm:col-span-3",children:G}),e.jsxs("div",{className:"sm:col-span-3 mt-2 flex flex-wrap gap-3 justify-end items-center",children:[e.jsx(m,{type:"button",variant:"secondary",onClick:()=>J(!1),disabled:Y,onFocus:()=>d&&r("AtrÃ¡s: vuelve a la pantalla anterior.",{force:!0}),onMouseEnter:()=>d&&r("AtrÃ¡s: vuelve a la pantalla anterior.",{force:!0}),children:"AtrÃ¡s"}),e.jsx(m,{type:"submit",disabled:Y,onFocus:()=>d&&r("Crear preguntas: genera las preguntas con inteligencia artificial.",{force:!0}),onMouseEnter:()=>d&&r("Crear preguntas: genera las preguntas con inteligencia artificial.",{force:!0}),children:Y?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:16,className:"mr-2"}),"Creandoâ€¦"]}):"Crear preguntas"})]})]}),i&&e.jsx("div",{className:"mt-2",children:R===0?e.jsxs("form",{className:"grid grid-cols-1 gap-4",onSubmit:a=>{a.preventDefault(),ee(1),L([]),O(x)},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",children:"Tema"}),e.jsx("select",{value:x,onChange:a=>q(a.target.value),className:"block w-full rounded-xl border-2 border-white/10 bg-white/5 px-4 py-3 text-white backdrop-blur-md focus:border-bb-primary focus:ring-2 focus:ring-bb-primary/30 focus:outline-none",children:F.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",children:"Â¿CuÃ¡ntas preguntas?"}),e.jsxs("div",{children:[e.jsx(se,{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:I,onChange:a=>{const o=a.target.value.replace(/\D+/g,"");v(o);const E=o?parseInt(o,10):NaN;Number.isNaN(E)?U(null):U(E)},onBlur:()=>{const a=parseInt(I||"",10);if(Number.isNaN(a)||a<1){U(null),v("");return}const o=Math.max(1,a);U(o),v(String(o))},required:!0,placeholder:"Cantidad",className:"w-28 text-center"}),(I===""||c===null)&&e.jsx("div",{className:`mt-1 text-xs ${I===""?"text-white/60":"text-red-300"}`,children:I===""?"Ingresa un nÃºmero (>= 1)":"Valor invÃ¡lido"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(m,{type:"button",variant:"secondary",onClick:()=>l(!1),onFocus:()=>d&&r("Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.",{force:!0}),onMouseEnter:()=>d&&r("Volver: cierra el formulario de preguntas manuales y regresa a la pantalla anterior.",{force:!0}),children:"Volver"}),e.jsx(m,{type:"submit",onFocus:()=>d&&r("Empezar: inicia la creaciÃ³n manual de preguntas.",{force:!0}),onMouseEnter:()=>d&&r("Empezar: inicia la creaciÃ³n manual de preguntas.",{force:!0}),children:"Empezar"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-3 font-bold",children:["Â¡Vamos! Pregunta ",ne.length+1," de ",c]}),e.jsx(xe,{topics:[K],onQuestionCreated:async a=>{try{C(!0),h("");const o="http://localhost:5000/api";if(!t||!t.getIdToken)throw new Error("Debes iniciar sesiÃ³n para crear preguntas");const E=await t.getIdToken(),S=await fetch(`${o}/questions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify(a)}),Z=await S.json();if(!S.ok)throw new Error(Z.error||"Error al guardar la pregunta");const _=Z.question||{...a},b=[...ne,{..._,category:K}];if(b.length===c){const M=await fetch(`${o}/questions/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({questions:b})}),W=await M.json();if(!M.ok)throw new Error(W.error||"Error al guardar las preguntas en lote");return w&&w(b),Q("Â¡Todas las preguntas han sido guardadas exitosamente!"),setTimeout(()=>{l(!1),Q("")},1500),b}else return L(b),ee(M=>M+1),Q(`Â¡Pregunta ${b.length} de ${c} guardada exitosamente!`),setTimeout(()=>Q(""),1500),_}catch(o){h("No se pudo guardar la pregunta: "+(o.message||"Por favor, intenta de nuevo."))}finally{C(!1)}},onCancel:()=>{l(!1)}})]})}),g&&e.jsx(he,{topics:F,onQuestionExtracted:async a=>{C(!0),h("");try{const o="http://localhost:5000/api",E=t&&t.getIdToken?await t.getIdToken():null,S=await fetch(`${o}/questions`,{method:"POST",headers:{"Content-Type":"application/json",...E?{Authorization:`Bearer ${E}`}:{}},body:JSON.stringify(a)});if(S.ok){const _=(await S.json()).question||{...a},b=[...X,_];ae(b),Q(`âœ… Pregunta ${b.length} guardada exitosamente. Puedes agregar mÃ¡s o finalizar.`),C(!1)}else h("No se pudo guardar la pregunta"),C(!1)}catch(o){h("Error al guardar la pregunta: "+(o.message||"Por favor, intenta de nuevo.")),C(!1)}},onCancel:()=>{A(!1),X.length>0&&(Q(`âœ… Se guardaron ${X.length} pregunta(s) de OCR`),setTimeout(()=>{w(X),ae([]),Q("")},1500))}})]})};export{ke as default};
//# sourceMappingURL=AIQuestionGenerator-Bg7jIi-F.js.map
