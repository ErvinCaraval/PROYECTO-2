import{r as s,b as L,j as e,s as P,e as B}from"./index-CGdjcbgg.js";import{B as h}from"./Button-BVl7jPIk.js";import{I as O}from"./Input-BhfJptjA.js";import{A as g}from"./Alert-CiOSpG0n.js";import{F as V,o as $,g as C}from"./imageOptimizer-C3HtjjgU.js";function W(){const[l,S]=s.useState(""),[f,r]=s.useState(""),[v,d]=s.useState(""),[n,j]=s.useState(!1),[b,i]=s.useState(""),[w,m]=s.useState(null),[N,u]=s.useState(null),[y,p]=s.useState("email"),E=L(),k=async a=>{try{i("Optimizando imagen...");const t=await $(a,240,240,.5),c=C(a),o=C(t),x=Math.round((1-o/c)*100);console.log(`‚úì Imagen optimizada: ${c}KB ‚Üí ${o}KB (${x}% reducci√≥n)`),m(t),u(t),i("")}catch(t){console.error("Error optimizando imagen, usando original:",t),m(a),u(a),i("")}},z=()=>{m(null),u(null),r(""),d("")},F=a=>{if(a.preventDefault(),!l){r("Por favor, ingresa tu email");return}r(""),p("capture")},T=async()=>{if(!w){r("Por favor, captura una foto primero");return}if(!l){r("Email requerido"),p("email");return}j(!0),i("Enviando imagen..."),r(""),d("");try{const a="http://localhost:5000/api";i("Verificando rostro...");const t=await fetch(`${a}/face/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:w,email:l})}),c=t.headers.get("content-type");if(!c||!c.includes("application/json")){const x=await t.text();throw console.error("Respuesta no es JSON:",x.substring(0,200)),new Error(`El servidor devolvi√≥ un error. Verifica que el backend est√© corriendo en ${a}`)}const o=await t.json();if(!t.ok)throw new Error(o.error||"Error en el login facial");if(o.success&&o.verified)if(o.customToken)i("Autenticando..."),await P(B,o.customToken),d("¬°Login facial exitoso! Redirigiendo..."),setTimeout(()=>{E("/dashboard")},1e3);else throw new Error("No se recibi√≥ token de autenticaci√≥n");else throw new Error(o.error||"Las caras no coinciden. Acceso denegado.")}catch(a){r(a.message||"Error al verificar la cara. Por favor, intenta de nuevo."),console.error("Error en login facial:",a)}finally{j(!1),i("")}},I=()=>{p("email"),m(null),u(null),r(""),d("")};return e.jsx("div",{className:"container min-h-screen px-4 py-10",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold",children:"üîê Login Facial"}),e.jsx("p",{className:"text-white/70 mt-2",children:"Inicia sesi√≥n usando reconocimiento facial"})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-xl p-6",children:[f&&e.jsx(g,{intent:"error",className:"mb-4",children:f}),v&&e.jsx(g,{intent:"success",className:"mb-4",children:v}),b&&e.jsxs(g,{intent:"info",className:"mb-4",children:["‚è≥ ",b]}),y==="email"?e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm text-white/80",htmlFor:"email",children:"Correo electr√≥nico"}),e.jsx(O,{id:"email",type:"email",placeholder:"t√∫@correo.com",value:l,onChange:a=>S(a.target.value),required:!0,disabled:n})]}),e.jsx(h,{type:"submit",size:"lg",disabled:n,className:"w-full",children:"Continuar con Login Facial"})]}):e.jsx("div",{className:"space-y-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative bg-black rounded-lg overflow-hidden",children:e.jsx("img",{src:N,alt:"Foto capturada",className:"w-full h-auto max-h-[480px] mx-auto"})}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(h,{onClick:z,variant:"outline",disabled:n,size:"lg",children:"üîÑ Tomar Otra Foto"}),e.jsx(h,{onClick:T,disabled:n,size:"lg",children:n?"‚è≥ Verificando...":"‚úÖ Verificar y Login"})]})]}):e.jsx(V,{onCapture:k,onCancel:I,disabled:n,buttonText:"üì∑ Capturar Foto",showCancel:!0})}),e.jsx("div",{className:"mt-6 text-center space-y-2",children:y==="email"&&e.jsx(h,{onClick:()=>E("/login"),variant:"ghost",size:"sm",children:"‚Üê Volver a Login Normal"})})]})]})})}export{W as default};
//# sourceMappingURL=FaceLogin-BISBjPjc.js.map
