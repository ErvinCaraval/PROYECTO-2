{"version":3,"file":"api-DoyG0mL_.js","sources":["../../src/services/api.js"],"sourcesContent":["// Cache para almacenar las respuestas de la API\nlet topicsCache = null;\nlet difficultyLevelsCache = null;\nlet cacheTimeout = 5 * 60 * 1000; // 5 minutos\n\nexport const clearCache = () => {\n  topicsCache = null;\n  difficultyLevelsCache = null;\n};\n\nexport const fetchWithRetry = async (url, options = {}, retries = 3) => {\n  let lastError;\n  \n  for (let i = 0; i < retries; i++) {\n    try {\n      const response = await fetch(url, options);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      lastError = error;\n      if (i < retries - 1) {\n        // Esperar un tiempo exponencial antes de reintentar\n        await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));\n      }\n    }\n  }\n  \n  throw lastError;\n};\n\nexport const fetchTopics = async () => {\n  if (topicsCache && (Date.now() - topicsCache.timestamp) < cacheTimeout) {\n    return topicsCache.data;\n  }\n\n  const apiBase = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n  try {\n    const data = await fetchWithRetry(`${apiBase}/ai/topics`);\n    if (data.success && Array.isArray(data.topics)) {\n      topicsCache = {\n        data: data.topics,\n        timestamp: Date.now()\n      };\n      return data.topics;\n    }\n    throw new Error('Formato de respuesta inválido');\n  } catch (error) {\n    console.error('Error fetching topics:', error);\n    // Si hay cache antiguo, lo usamos como fallback\n    if (topicsCache?.data) {\n      return topicsCache.data;\n    }\n    throw error;\n  }\n};\n\nexport const fetchDifficultyLevels = async () => {\n  if (difficultyLevelsCache && (Date.now() - difficultyLevelsCache.timestamp) < cacheTimeout) {\n    return difficultyLevelsCache.data;\n  }\n\n  const apiBase = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n  try {\n    const data = await fetchWithRetry(`${apiBase}/ai/difficulty-levels`);\n    if (data.success) {\n      difficultyLevelsCache = {\n        data: data.levels,\n        timestamp: Date.now()\n      };\n      return data.levels;\n    }\n    throw new Error('Formato de respuesta inválido');\n  } catch (error) {\n    console.error('Error fetching difficulty levels:', error);\n    if (difficultyLevelsCache?.data) {\n      return difficultyLevelsCache.data;\n    }\n    throw error;\n  }\n};"],"names":["topicsCache","difficultyLevelsCache","cacheTimeout","fetchWithRetry","url","options","retries","lastError","i","response","error","resolve","fetchTopics","apiBase","data","fetchDifficultyLevels"],"mappings":"AACA,IAAIA,EAAc,KACdC,EAAwB,KACxBC,EAAe,IAAS,IAOrB,MAAMC,EAAiB,MAAOC,EAAKC,EAAU,CAAA,EAAIC,EAAU,IAAM,CACtE,IAAIC,EAEJ,QAASC,EAAI,EAAGA,EAAIF,EAASE,IAC3B,GAAI,CACF,MAAMC,EAAW,MAAM,MAAML,EAAKC,CAAO,EACzC,GAAI,CAACI,EAAS,GACZ,MAAM,IAAI,MAAM,uBAAuBA,EAAS,MAAM,EAAE,EAG1D,OADa,MAAMA,EAAS,KAAA,CAE9B,OAASC,EAAO,CACdH,EAAYG,EACRF,EAAIF,EAAU,GAEhB,MAAM,IAAI,QAAQK,GAAW,WAAWA,EAAS,KAAK,IAAI,EAAGH,CAAC,EAAI,GAAI,CAAC,CAE3E,CAGF,MAAMD,CACR,EAEaK,EAAc,SAAY,CACrC,GAAIZ,GAAgB,KAAK,IAAA,EAAQA,EAAY,UAAaE,EACxD,OAAOF,EAAY,KAGrB,MAAMa,EAAU,4BAChB,GAAI,CACF,MAAMC,EAAO,MAAMX,EAAe,GAAGU,CAAO,YAAY,EACxD,GAAIC,EAAK,SAAW,MAAM,QAAQA,EAAK,MAAM,EAC3C,OAAAd,EAAc,CACZ,KAAMc,EAAK,OACX,UAAW,KAAK,IAAA,CAAI,EAEfA,EAAK,OAEd,MAAM,IAAI,MAAM,+BAA+B,CACjD,OAASJ,EAAO,CAGd,GAFA,QAAQ,MAAM,yBAA0BA,CAAK,EAEzCV,GAAa,KACf,OAAOA,EAAY,KAErB,MAAMU,CACR,CACF,EAEaK,EAAwB,SAAY,CAC/C,GAAId,GAA0B,KAAK,IAAA,EAAQA,EAAsB,UAAaC,EAC5E,OAAOD,EAAsB,KAG/B,MAAMY,EAAU,4BAChB,GAAI,CACF,MAAMC,EAAO,MAAMX,EAAe,GAAGU,CAAO,uBAAuB,EACnE,GAAIC,EAAK,QACP,OAAAb,EAAwB,CACtB,KAAMa,EAAK,OACX,UAAW,KAAK,IAAA,CAAI,EAEfA,EAAK,OAEd,MAAM,IAAI,MAAM,+BAA+B,CACjD,OAASJ,EAAO,CAEd,GADA,QAAQ,MAAM,oCAAqCA,CAAK,EACpDT,GAAuB,KACzB,OAAOA,EAAsB,KAE/B,MAAMS,CACR,CACF"}