{"version":3,"file":"backendAuthService-DBtrjOL4.js","sources":["../../src/services/backendAuthService.js"],"sourcesContent":["/**\n * Backend Authentication Service\n * This service communicates with the backend API for authentication\n * instead of connecting directly to Firebase from the frontend\n */\n\nimport { signInWithCustomToken, signOut as firebaseSignOut } from 'firebase/auth';\nimport { auth } from './firebase';\n\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\n\nclass BackendAuthService {\n  /**\n   * Register a new user via backend\n   * @param {string} email\n   * @param {string} password\n   * @param {string} displayName\n   * @param {boolean} visualDifficulty\n   * @returns {Promise<{uid, email, displayName, visualDifficulty, token}>}\n   */\n  async register(email, password, displayName, visualDifficulty = false) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/register`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          email,\n          password,\n          displayName,\n          visualDifficulty\n        })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Registration failed');\n      }\n\n      const data = await response.json();\n\n      // Sign in with the custom token returned from backend\n      await signInWithCustomToken(auth, data.token);\n\n      return data;\n    } catch (error) {\n      console.error('Registration error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Login user via Backend (NOT direct Firebase)\n   * Backend validates credentials and returns custom token\n   * @param {string} email\n   * @param {string} password\n   * @returns {Promise<{uid, email, displayName, visualDifficulty}>}\n   */\n  async login(email, password) {\n    try {\n      // âœ… IMPORTANT: Login goes through backend first!\n      const response = await fetch(`${API_BASE_URL}/auth/verify-credentials`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email, password })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Login failed');\n      }\n\n      const data = await response.json();\n\n      // Sign in with custom token returned from backend\n      await signInWithCustomToken(auth, data.token);\n\n      return data;\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get current user's ID token\n   * @returns {Promise<string>}\n   */\n  async getIdToken() {\n    if (!auth.currentUser) {\n      throw new Error('No user logged in');\n    }\n    return await auth.currentUser.getIdToken();\n  }\n\n  /**\n   * Verify token with backend\n   * @param {string} idToken\n   * @returns {Promise<{uid, email, displayName, visualDifficulty}>}\n   */\n  async verifyToken(idToken) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/verify-token`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ idToken })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Token verification failed');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Token verification error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Send password reset email via backend\n   * @param {string} email\n   * @returns {Promise<{message}>}\n   */\n  async sendPasswordResetEmail(email) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/password-reset`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Password reset failed');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Password reset error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Update user profile via backend\n   * @param {string} idToken\n   * @param {Object} updates\n   * @returns {Promise<{uid, email, displayName, visualDifficulty}>}\n   */\n  async updateProfile(idToken, updates) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/profile`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${idToken}`\n        },\n        body: JSON.stringify(updates)\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Profile update failed');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Profile update error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get current user profile via backend\n   * @param {string} idToken\n   * @returns {Promise<{uid, email, displayName, visualDifficulty, stats}>}\n   */\n  async getProfile(idToken) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/profile`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${idToken}`\n        }\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Get profile failed');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Get profile error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Sign out current user\n   * @returns {Promise<void>}\n   */\n  async logout() {\n    try {\n      await firebaseSignOut(auth);\n    } catch (error) {\n      console.error('Logout error:', error);\n      throw error;\n    }\n  }\n}\n\nexport default new BackendAuthService();\n"],"names":["API_BASE_URL","BackendAuthService","email","password","displayName","visualDifficulty","response","error","data","signInWithCustomToken","auth","idToken","updates","firebaseSignOut","backendAuthService"],"mappings":"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"}