import{r as d,j as e}from"./index-B7SNj0r6.js";import{C as E,b as A,a as S}from"./Card-D8_v8k4n.js";import{B as p}from"./Button-BAFGbEtv.js";import{I as f}from"./Input-D9M14c8m.js";import{A as z}from"./Alert-CmJLF0tw.js";import{L}from"./LoadingOverlay-QL4gMhH3.js";import{O as R}from"./OCRQuestionCapture-DKZ53baR.js";import"./clsx-B-dksMZM.js";import"./index-B9PUOGrg.js";class T{constructor(){const a=typeof window<"u"&&window.ENV?.VITE_API_URL||"https://backend-v1-latest.onrender.com/api";this.baseUrl=a.replace("/api","")}async getAuthHeaders(){const a=localStorage.getItem("authToken");return{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}}}async getAllQuestions(){try{const a=await this.getAuthHeaders(),s=await fetch(`${this.baseUrl}/api/questions`,{headers:a});if(!s.ok)throw new Error(`Failed to fetch questions: ${s.status}`);return await s.json()}catch(a){throw console.error("Error fetching questions:",a),a}}async createQuestion(a){try{const s=await this.getAuthHeaders(),r=await fetch(`${this.baseUrl}/api/questions`,{method:"POST",headers:s,body:JSON.stringify(a)});if(!r.ok)throw new Error(`Failed to create question: ${r.status}`);return await r.json()}catch(s){throw console.error("Error creating question:",s),s}}async updateQuestion(a,s){try{const r=await this.getAuthHeaders(),n=await fetch(`${this.baseUrl}/api/questions/${a}`,{method:"PUT",headers:r,body:JSON.stringify(s)});if(!n.ok)throw new Error(`Failed to update question: ${n.status}`);return await n.json()}catch(r){throw console.error("Error updating question:",r),r}}async deleteQuestion(a){try{const s=await this.getAuthHeaders(),r=await fetch(`${this.baseUrl}/api/questions/${a}`,{method:"DELETE",headers:s});if(!r.ok)throw new Error(`Failed to delete question: ${r.status}`);return await r.json()}catch(s){throw console.error("Error deleting question:",s),s}}async getAccessibilityStats(){try{const a=await this.getAuthHeaders(),s=await fetch(`${this.baseUrl}/api/admin/accessibility-stats`,{headers:a});if(!s.ok)throw new Error(`Failed to fetch accessibility stats: ${s.status}`);return await s.json()}catch(a){return console.error("Error fetching accessibility stats:",a),{}}}async getAccessibilitySettings(){try{const a=await this.getAuthHeaders(),s=await fetch(`${this.baseUrl}/api/admin/accessibility-settings`,{headers:a});if(!s.ok)throw new Error(`Failed to fetch accessibility settings: ${s.status}`);return await s.json()}catch(a){return console.error("Error fetching accessibility settings:",a),{}}}async updateAccessibilitySettings(a){try{const s=await this.getAuthHeaders(),r=await fetch(`${this.baseUrl}/api/admin/accessibility-settings`,{method:"PUT",headers:s,body:JSON.stringify(a)});if(!r.ok)throw new Error(`Failed to update accessibility settings: ${r.status}`);return await r.json()}catch(s){throw console.error("Error updating accessibility settings:",s),s}}async getUsersWithVoiceMode(){try{const a=await this.getAuthHeaders(),s=await fetch(`${this.baseUrl}/api/admin/voice-mode-users`,{headers:a});if(!s.ok)throw new Error(`Failed to fetch voice mode users: ${s.status}`);return await s.json()}catch(a){return console.error("Error fetching voice mode users:",a),[]}}async getAccessibilityReport(a,s){try{const r=await this.getAuthHeaders(),n=new URLSearchParams;a&&n.append("startDate",a),s&&n.append("endDate",s);const h=await fetch(`${this.baseUrl}/api/admin/accessibility-report?${n}`,{headers:r});if(!h.ok)throw new Error(`Failed to fetch accessibility report: ${h.status}`);return await h.json()}catch(r){return console.error("Error fetching accessibility report:",r),{}}}}const u=new T,C={text:"",options:["","","",""],correctAnswerIndex:0,category:"",explanation:""};function Y(){const[k,a]=d.useState([]),[s,r]=d.useState(C),[n,h]=d.useState(null),[F,$]=d.useState(!0),[m,Q]=d.useState({}),[o,U]=d.useState({}),[V,g]=d.useState(!1),[j,c]=d.useState(""),[x,w]=d.useState(!1),v=async()=>{$(!0);try{const t=await u.getAllQuestions();a(Array.isArray(t)?t:[])}catch(t){console.error("Error fetching questions:",t),c("Error cargando preguntas")}finally{$(!1)}};d.useEffect(()=>{v(),I()},[]);const O=t=>{r(t),w(!1),c("Pregunta extraída del OCR. Edita según sea necesario.")},I=async()=>{g(!0);try{const t=await u.getAccessibilityStats(),i=await u.getAccessibilitySettings();Q(t),U(i)}catch(t){console.error("Error fetching accessibility data:",t),c("Error cargando datos de accesibilidad")}finally{g(!1)}},b=async t=>{g(!0);try{const i=await u.updateAccessibilitySettings(t);U(i),c("Configuración de accesibilidad actualizada correctamente")}catch(i){console.error("Error updating accessibility settings:",i),c("Error actualizando configuración de accesibilidad")}finally{g(!1)}},N=t=>{const{name:i,value:l}=t.target;r(y=>({...y,[i]:l}))},M=(t,i)=>{r(l=>{const y=[...l.options];return y[t]=i,{...l,options:y}})},H=async t=>{t.preventDefault();try{n?(await u.updateQuestion(n,s),c("Pregunta actualizada correctamente")):(await u.createQuestion(s),c("Pregunta creada correctamente")),r(C),h(null),v()}catch(i){console.error("Error saving question:",i),c("Error guardando pregunta")}},P=t=>{r(t),h(t.id)},q=async t=>{try{await u.deleteQuestion(t),c("Pregunta eliminada correctamente"),v()}catch(i){console.error("Error deleting question:",i),c("Error eliminando pregunta")}};return e.jsxs("div",{className:"container min-h-screen px-4 py-8 space-y-6",children:[V&&e.jsx(L,{}),e.jsxs(E,{children:[e.jsx(A,{children:e.jsx("h2",{className:"text-2xl font-bold",children:"Panel de Accesibilidad"})}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Estadísticas de Accesibilidad"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-lg border border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:m.totalUsersWithVoiceMode||0}),e.jsx("div",{className:"text-sm text-white/70",children:"Usuarios con modo de voz"})]}),e.jsxs("div",{className:"p-4 bg-green-500/10 rounded-lg border border-green-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:m.totalVoiceInteractions||0}),e.jsx("div",{className:"text-sm text-white/70",children:"Interacciones de voz"})]}),e.jsxs("div",{className:"p-4 bg-purple-500/10 rounded-lg border border-purple-500/20",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-400",children:[m.voiceModeAdoptionRate||0,"%"]}),e.jsx("div",{className:"text-sm text-white/70",children:"Tasa de adopción"})]}),e.jsxs("div",{className:"p-4 bg-orange-500/10 rounded-lg border border-orange-500/20",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-400",children:[m.averageVoiceSessionDuration||0,"s"]}),e.jsx("div",{className:"text-sm text-white/70",children:"Duración promedio"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Configuración Global de Accesibilidad"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"voiceModeEnabled",checked:o.voiceModeEnabled||!1,onChange:t=>b({voiceModeEnabled:t.target.checked}),className:"h-4 w-4 text-blue-600 bg-white/10 border-white/20 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("label",{htmlFor:"voiceModeEnabled",className:"text-sm text-white/80",children:"Habilitar modo de voz globalmente"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-white/80",children:"Velocidad de voz por defecto"}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:o.defaultVoiceSettings?.rate||1,onChange:t=>b({defaultVoiceSettings:{...o.defaultVoiceSettings,rate:parseFloat(t.target.value)}}),className:"w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider"}),e.jsxs("div",{className:"text-xs text-white/60 mt-1",children:[o.defaultVoiceSettings?.rate||1,"x"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-white/80",children:"Volumen por defecto"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:o.defaultVoiceSettings?.volume||1,onChange:t=>b({defaultVoiceSettings:{...o.defaultVoiceSettings,volume:parseFloat(t.target.value)}}),className:"w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider"}),e.jsxs("div",{className:"text-xs text-white/60 mt-1",children:[Math.round((o.defaultVoiceSettings?.volume||1)*100),"%"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Funcionalidades de Accesibilidad"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.features&&Object.entries(o.features).map(([t,i])=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:t,checked:i,onChange:l=>b({features:{...o.features,[t]:l.target.checked}}),className:"h-4 w-4 text-blue-600 bg-white/10 border-white/20 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("label",{htmlFor:t,className:"text-sm text-white/80 capitalize",children:t.replace(/([A-Z])/g," $1").toLowerCase()})]},t))})]})]})]}),e.jsxs(E,{children:[e.jsx(A,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Admin Panel"}),e.jsx(p,{type:"button",variant:x?"primary":"secondary",onClick:()=>w(!x),children:x?"Modo Manual":"Modo OCR"})]})}),e.jsx(S,{children:x?e.jsx(R,{topics:["General","Arte","Ciencia","Historia","Deportes"],onQuestionExtracted:O,onCancel:()=>w(!1)}):e.jsxs("form",{onSubmit:H,className:"grid gap-3",children:[e.jsx(f,{name:"text",value:s.text,onChange:N,placeholder:"Question text",required:!0}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsx(f,{name:"category",value:s.category,onChange:N,placeholder:"Category",required:!0}),e.jsx(f,{name:"explanation",value:s.explanation,onChange:N,placeholder:"Explanation",required:!0}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Correcta"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:s.options.map((t,i)=>e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"radio",name:"correctAnswerIndex",checked:s.correctAnswerIndex===i,onChange:()=>r(l=>({...l,correctAnswerIndex:i})),className:"h-4 w-4"}),e.jsx("span",{children:i+1})]},i))})]})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:s.options.map((t,i)=>e.jsx(f,{value:t,onChange:l=>M(i,l.target.value),placeholder:`Option ${i+1}`,required:!0},i))}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[n&&e.jsx(p,{type:"button",variant:"secondary",onClick:()=>{r(C),h(null)},children:"Cancel"}),e.jsxs(p,{type:"submit",children:[n?"Update":"Add"," Question"]})]})]})})]}),e.jsxs(E,{children:[e.jsx(A,{className:"pb-2",children:e.jsx("h3",{className:"text-xl font-semibold",children:"Questions"})}),e.jsx(S,{children:F?e.jsxs("div",{className:"flex items-center gap-3 text-white/80",children:[e.jsx("div",{className:"loading-spinner"})," Loading…"]}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left",children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"py-2 pr-3",children:"Text"}),e.jsx("th",{className:"py-2 pr-3",children:"Category"}),e.jsx("th",{className:"py-2 pr-3",children:"Options"}),e.jsx("th",{className:"py-2 pr-3",children:"Correct"}),e.jsx("th",{className:"py-2 pr-3",children:"Explanation"}),e.jsx("th",{className:"py-2",children:"Actions"})]})}),e.jsx("tbody",{children:k.map(t=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"py-2 pr-3 align-top",children:t.text}),e.jsx("td",{className:"py-2 pr-3 align-top",children:t.category}),e.jsx("td",{className:"py-2 pr-3 align-top",children:t.options.join(", ")}),e.jsx("td",{className:"py-2 pr-3 align-top",children:t.options[t.correctAnswerIndex]}),e.jsx("td",{className:"py-2 pr-3 align-top",children:t.explanation}),e.jsxs("td",{className:"py-2 flex gap-2",children:[e.jsx(p,{variant:"secondary",onClick:()=>P(t),children:"Edit"}),e.jsx(p,{variant:"outline",onClick:()=>q(t.id),children:"Delete"})]})]},t.id))})]})})})]}),j&&e.jsx(z,{intent:j.includes("Error")?"error":"success",children:j})]})}export{Y as default};
//# sourceMappingURL=AdminPage-BbRdWzR3.js.map
