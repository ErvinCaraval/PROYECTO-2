const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AIQuestionGenerator-_3woylwk.js","assets/index-BOaVjrce.js","assets/index-DzcX8ugu.css","assets/Button-D2tu_0bI.js","assets/Input-Cm1bFLR1.js","assets/Alert-BchDzBqE.js","assets/api-BirJDgAi.js","assets/Skeleton-Onp4HXDJ.js","assets/socket-CnHv-2vf.js","assets/LoadingOverlay-rVvsqzvW.js"])))=>i.map(i=>d[i]);
import{j as e,a as R,r as o,u as q,b as ee,R as ae,_ as te}from"./index-BOaVjrce.js";import{m as U,g as ie}from"./socket-CnHv-2vf.js";import{B as l}from"./Button-D2tu_0bI.js";import{I as se}from"./Input-Cm1bFLR1.js";import{A as re}from"./Alert-BchDzBqE.js";import{C as T,b as A,a as z}from"./Card-Bn8pnOgw.js";import{S as V,a as ne,A as oe}from"./Skeleton-Onp4HXDJ.js";import{L as le}from"./LoadingOverlay-rVvsqzvW.js";function _({title:i,subtitle:f,actions:u,children:p,className:s="",...E}){return e.jsxs("section",{className:`relative rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-md ${s}`,...E,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 px-6 py-5",children:[e.jsxs("div",{children:[i&&e.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:i}),f&&e.jsx("p",{className:"mt-1 text-white/70",children:f})]}),u]}),e.jsx("div",{className:"px-6 pb-6",children:p})]})}const O={primary:"bg-bb-primary/20 text-bb-primary ring-bb-primary/30",amber:"bg-amber-400/15 text-amber-300 ring-amber-400/30",emerald:"bg-emerald-400/15 text-emerald-300 ring-emerald-400/30",violet:"bg-violet-400/15 text-violet-300 ring-violet-400/30",slate:"bg-white/10 text-white/80 ring-white/20"};function ce({children:i,variant:f="slate",className:u=""}){const p=O[f]??O.slate;return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ring-1 ring-inset ${p} ${u}`,children:i})}const de=({onComplete:i})=>{const{speak:f,isVoiceModeEnabled:u,enableVoiceMode:p}=R(),[s,E]=o.useState(0),[g,w]=o.useState(!1),[M,S]=o.useState(!1),x=[{title:"Â¡Bienvenido a BrainBlitz!",message:"Te voy a guiar por la aplicaciÃ³n usando voz. Escucha atentamente y sigue las instrucciones.",action:"Escucha"},{title:"NavegaciÃ³n Principal",message:"En la parte superior verÃ¡s el menÃº de navegaciÃ³n. Puedes ir a Inicio, Jugar, Perfil y mÃ¡s opciones.",action:"Continuar"},{title:"Crear una Partida",message:"Para crear una partida, haz clic en el botÃ³n 'Crear Partida' o 'Jugar'. Te llevarÃ¡ a la configuraciÃ³n del juego.",action:"Continuar"},{title:"Unirse a una Partida",message:"Para unirte a una partida existente, haz clic en 'Unirse a Partida' e ingresa el cÃ³digo de 6 dÃ­gitos.",action:"Continuar"},{title:"Durante el Juego",message:"Las preguntas se leerÃ¡n automÃ¡ticamente. Puedes responder haciendo clic en las opciones o usando tu voz.",action:"Continuar"},{title:"ConfiguraciÃ³n de Voz",message:"En tu perfil puedes ajustar la velocidad, volumen y tipo de voz segÃºn tus preferencias.",action:"Continuar"},{title:"Â¡Listo para Jugar!",message:"Ya conoces lo bÃ¡sico. Â¡Disfruta jugando BrainBlitz! Si necesitas ayuda, siempre puedes volver a este tutorial.",action:"Finalizar"}],h=x[s];o.useEffect(()=>{u&&h&&b()},[s,u]);const b=async()=>{if(u){w(!0);try{await f(`${h.title}. ${h.message}`)}catch($){console.error("Error speaking step:",$)}finally{w(!1)}}},I=()=>{s<x.length-1?E(s+1):i()},C=()=>{s>0&&E(s-1)},k=()=>{i()},G=()=>{b()},P=()=>{S(!0),u||p()};return M?e.jsxs(T,{className:"max-w-2xl mx-auto",children:[e.jsxs(A,{children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:"ðŸŽ¤ GuÃ­a de Voz"}),e.jsxs("div",{className:"text-center text-sm text-white/70",children:["Paso ",s+1," de ",x.length]})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:h.title}),e.jsx("p",{className:"text-white/80 mb-4",children:h.message}),g&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-400",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full"}),e.jsx("span",{children:"Hablando..."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(l,{onClick:C,disabled:s===0,variant:"secondary",children:"â¬…ï¸ Anterior"}),e.jsx(l,{onClick:G,disabled:g,variant:"outline",children:"ðŸ”„ Repetir"}),e.jsx(l,{onClick:I,variant:"primary",children:s===x.length-1?"âœ… Finalizar":"âž¡ï¸ Siguiente"})]}),e.jsx("div",{className:"text-center",children:e.jsx(l,{onClick:k,variant:"secondary",size:"sm",children:"â­ï¸ Saltar guÃ­a"})}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(s+1)/x.length*100}%`}})})]})]}):e.jsxs(T,{className:"max-w-2xl mx-auto",children:[e.jsx(A,{children:e.jsx("h2",{className:"text-2xl font-bold text-center",children:"ðŸŽ¤ GuÃ­a de Voz"})}),e.jsxs(z,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-lg",children:"Detectamos que tienes dificultades visuales. Â¿Te gustarÃ­a que te guÃ­e por la aplicaciÃ³n usando voz?"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(l,{onClick:P,variant:"primary",size:"lg",children:"ðŸ”Š SÃ­, guÃ­ame con voz"}),e.jsx(l,{onClick:k,variant:"secondary",size:"lg",children:"â­ï¸ Saltar guÃ­a"})]})]})]})},ue=ae.lazy(()=>te(()=>import("./AIQuestionGenerator-_3woylwk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function ye(){const{user:i,logout:f}=q(),{userHasVisualDifficulty:u,isVoiceModeEnabled:p,speak:s,enableVoiceMode:E}=R(),g=ee(),[w,M]=o.useState(""),[S,x]=o.useState([]),[h,b]=o.useState(!1),[I,C]=o.useState(!1),[k,G]=o.useState(""),[P,$]=o.useState([]),[F,j]=o.useState(""),[B,c]=o.useState(""),[L,D]=o.useState(!1);o.useEffect(()=>{J()},[]),o.useEffect(()=>{u&&!p&&D(!0)},[u,p]);const J=async()=>{try{const t=await(await fetch("http://localhost:5000/api/games")).json(),m=Array.isArray(t)?t:[];x(m)}catch(a){console.error("Error fetching games:",a),x([])}},Q=async()=>{const a=await ie();if(a.connected)return a;const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?15e3:8e3;return await new Promise((m,d)=>{const v=setTimeout(()=>{a.off("connect",y),a.off("connect_error",N),d(new Error("Timeout de conexiÃ³n"))},t),y=()=>{clearTimeout(v),a.off("connect_error",N),m()},N=Z=>{clearTimeout(v),a.off("connect",y),d(Z)};a.once("connect",y),a.once("connect_error",N),a.connect()}),a},H=async()=>{if(!k){c("Por favor selecciona un tema antes de crear la partida."),setTimeout(()=>c(""),4e3);return}if(!P.length){c("Primero genera preguntas con IA antes de crear la partida."),C(!0),setTimeout(()=>c(""),4e3);return}const a=P.map(t=>({...t,category:k}));b(!0);let n;try{const t=await Q();t.off("gameCreated"),t.off("error");const d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?3e4:15e3;n=setTimeout(()=>{b(!1),c("Tiempo de espera al crear la partida. Verifica tu conexiÃ³n e intÃ©ntalo de nuevo."),setTimeout(()=>c(""),5e3)},d);let v=null;i&&i.getIdToken&&(v=await i.getIdToken()),t.emit("createGame",{hostId:i.uid,displayName:i.displayName||i.email,isPublic:!0,token:v,topic:k,questions:a,count:a.length}),t.once("gameCreated",({gameId:y,questions:N})=>{clearTimeout(n),b(!1),j(`Â¡Tu partida fue creada con ${(N==null?void 0:N.length)||0} preguntas! Invita a tus amigos y disfruta. ðŸš€`),setTimeout(()=>j(""),5e3),t.connected?setTimeout(()=>g(`/lobby/${y}`),800):(t.connect(),t.once("connect",()=>{setTimeout(()=>g(`/lobby/${y}`),500)}))}),t.once("error",({error:y})=>{clearTimeout(n),b(!1),c("OcurriÃ³ un error al crear la partida: "+y),setTimeout(()=>c(""),5e3)})}catch(t){clearTimeout(n),b(!1),console.error("Error creating game:",t);const m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let d="No se pudo conectar con el servidor. ";m?d+="En dispositivos mÃ³viles, verifica que tengas una conexiÃ³n estable y que no estÃ©s en modo ahorro de datos.":d+="Intenta de nuevo.",c(d),setTimeout(()=>c(""),8e3)}},Y=()=>{if(!w.trim()){c("Por favor ingresa un cÃ³digo de partida."),setTimeout(()=>c(""),4e3);return}g(`/lobby/${w}`)},K=a=>{j("Â¡Te uniste a la partida! Cargando sala..."),setTimeout(()=>j(""),4e3),setTimeout(()=>g(`/lobby/${a}`),1200)},W=a=>{var n;$(a),a&&a.length>0&&a[0].category&&G(a[0].category),j(`Â¡Listo! Se generaron ${a.length} preguntas para el tema "${((n=a[0])==null?void 0:n.category)||""}". ðŸŽ‰`),setTimeout(()=>j(""),5e3)},X=async a=>{try{const n="http://localhost:5000",t=await i.getIdToken();if(!(await fetch(`${n}/api/games/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("No se pudo eliminar la partida.");x(d=>d.filter(v=>v.id!==a)),j("Â¡Partida eliminada con Ã©xito!"),setTimeout(()=>j(""),5e3)}catch(n){console.error(n),c("Hubo un problema al intentar eliminar la partida. Por favor, intÃ©ntalo de nuevo."),setTimeout(()=>c(""),5e3)}},r=a=>{p&&s(a,{action:"text_read",questionId:"dashboard",metadata:{origin:"dashboard"}})};return e.jsxs("div",{className:"min-h-screen",children:[h&&e.jsx(le,{text:"Creando partidaâ€¦",mobileOnly:!0}),(F||B)&&e.jsx("div",{"aria-live":"polite",className:"top-6 z-[2000] fixed inset-x-0 flex justify-center px-4",children:e.jsx(re,{intent:B?"error":"success",className:"shadow-xl",children:B||F})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsx(de,{onComplete:()=>D(!1)})}),e.jsx("header",{className:"top-0 z-40 sticky bg-white/5 backdrop-blur-md border-white/10 border-b w-full py-2 mb-16",children:e.jsxs("div",{className:"flex md:flex-row flex-col md:justify-between md:items-center gap-4 px-4 py-5 container",children:[e.jsxs("h2",{className:"font-bold text-2xl md:text-3xl tracking-tight",children:["Â¡Bienvenido, ",(i==null?void 0:i.displayName)||(i==null?void 0:i.email),"!"]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(l,{variant:"secondary",onClick:()=>g("/profile"),"aria-label":"Ir a tu perfil",onFocus:()=>r("Ir a tu perfil, ajusta configuraciÃ³n y voz"),onMouseEnter:()=>r("Ir a tu perfil, ajusta configuraciÃ³n y voz"),children:"Perfil"}),e.jsx(l,{variant:"secondary",onClick:()=>g("/face-register"),"aria-label":"Registrar reconocimiento facial",onFocus:()=>r("Registrar tu cara para login facial"),onMouseEnter:()=>r("Registrar tu cara para login facial"),children:"ðŸ“¸ Registrar Cara"}),e.jsx(l,{variant:"outline",onClick:f,"aria-label":"Cerrar sesiÃ³n",onFocus:()=>r("Cerrar sesiÃ³n de tu cuenta"),onMouseEnter:()=>r("Cerrar sesiÃ³n de tu cuenta"),children:"Cerrar sesiÃ³n"}),e.jsx(l,{variant:"outline",onClick:async()=>{console.log("ðŸ›ˆ Explicar pÃ¡gina clicked"),console.log("isVoiceModeEnabled:",p),console.log("speak function:",typeof s);try{console.log("Testing simple voice..."),await s("Hola, esto es una prueba de voz.",{force:!0}),console.log("Simple test completed");const a=[];a.push("EstÃ¡s en el panel de control."),a.push("Arriba puedes ir a tu perfil o cerrar sesiÃ³n."),a.push("A la izquierda puedes crear una partida o generar preguntas con inteligencia artificial."),a.push("A la derecha puedes unirte a una partida con un cÃ³digo."),a.push("MÃ¡s abajo verÃ¡s las partidas pÃºblicas y podrÃ¡s unirte o eliminar si eres anfitriÃ³n."),console.log("Speaking full explanation..."),await s(a.join(" "),{action:"page_guide",questionId:"dashboard",force:!0}),console.log("Full explanation completed")}catch(a){console.error("Error in voice explanation:",a),alert("Error de voz: "+a.message)}},"aria-label":"Explicar la pÃ¡gina",children:"ðŸ›ˆ Explicar pÃ¡gina"})]})]})}),e.jsxs("main",{className:"px-4 py-8 md:py-10 container pt-8",children:[e.jsxs("div",{className:"gap-6 md:gap-8 grid grid-cols-1 md:grid-cols-2",children:[e.jsx(_,{title:"ðŸŽ® Crear nueva partida",subtitle:"Inicia una partida y invita a tus amigos",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(l,{onClick:H,disabled:h,title:"Primero genera preguntas con IA para que tu partida tenga contenido.",size:"lg",onFocus:()=>r("Crear partida nueva con el tema seleccionado"),onMouseEnter:()=>r("Crear partida nueva con el tema seleccionado"),children:h?"Creandoâ€¦":"Crear partida"}),e.jsx(l,{variant:"primary",size:"lg",onClick:()=>C(!0),title:"Genera preguntas personalizadas antes de crear tu partida.",onFocus:()=>r("Generar preguntas con inteligencia artificial"),onMouseEnter:()=>r("Generar preguntas con inteligencia artificial"),children:"ðŸ¤– Generar preguntas"}),e.jsxs("div",{className:"bg-indigo-500/10 px-4 py-3 border border-indigo-400/20 rounded-xl text-white/85 text-sm",children:[e.jsx("strong",{className:"text-indigo-300",children:"ðŸ’¡ Ayuda:"})," Antes de crear una partida, puedes generar preguntas automÃ¡ticamente o agregar preguntas manuales personalizadas. AsÃ­ tu juego tendrÃ¡ contenido Ãºnico, reciente y adaptado a tus necesidades."]})]})}),e.jsx(_,{title:"ðŸ”— Unirse a partida",subtitle:"Ingresa un cÃ³digo de 6 caracteres para unirte",children:e.jsxs("form",{className:"flex sm:flex-row flex-col items-stretch gap-3",onSubmit:a=>{a.preventDefault(),Y()},"aria-labelledby":"join-section-title",children:[e.jsx("label",{htmlFor:"gameCode",className:"sr-only",children:"CÃ³digo de partida"}),e.jsx(se,{id:"gameCode",type:"text",inputMode:"numeric",autoComplete:"one-time-code",placeholder:"CÃ³digo (6)",value:w,onChange:a=>M(a.target.value),maxLength:6,className:"font-semibold text-center tracking-widest",onFocus:()=>r("Campo para ingresar cÃ³digo de partida, seis caracteres")}),e.jsx(l,{type:"submit",variant:"secondary",onFocus:()=>r("Unirse a la partida con el cÃ³digo ingresado"),onMouseEnter:()=>r("Unirse a la partida con el cÃ³digo ingresado"),children:"Unirse"})]})})]}),e.jsx(_,{title:"ðŸŒ Partidas pÃºblicas",subtitle:"Ãšnete a partidas abiertas para todos",className:"mt-8",children:Array.isArray(S)?S.length===0?e.jsx("div",{className:"gap-4 sm:gap-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,n)=>e.jsxs(T,{children:[e.jsxs(A,{className:"flex justify-between items-center pb-3",children:[e.jsx(V,{className:"w-40 h-5"}),e.jsx(V,{className:"rounded-full w-16 h-6"})]}),e.jsxs(z,{className:"flex justify-between items-center gap-4",children:[e.jsx(ne,{lines:2}),e.jsx(V,{className:"rounded-xl w-24 h-10"})]})]},n))}):e.jsx(U.div,{className:"gap-4 sm:gap-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",initial:"hidden",animate:"show",variants:{hidden:{},show:{transition:{staggerChildren:.06}}},children:e.jsx(oe,{children:S.map((a,n)=>{var t,m,d;return e.jsx(U.div,{layout:!0,initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{type:"spring",stiffness:120,damping:18},children:e.jsxs(T,{className:"group hover:shadow-glow transition hover:-translate-y-0.5",children:[e.jsxs(A,{className:"flex justify-between items-center pb-3",children:[e.jsxs("h4",{className:"font-semibold text-xl",children:["Partida #",a.id]}),e.jsx(ce,{variant:n%2?"violet":"emerald",children:a.topic||"PÃºblica"})]}),e.jsxs(z,{className:"flex sm:flex-row flex-col justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-white/80 text-sm",children:[e.jsxs("p",{children:["Jugadores: ",((t=a.players)==null?void 0:t.length)||0]}),e.jsxs("p",{children:["AnfitriÃ³n: ",((d=(m=a.players)==null?void 0:m[0])==null?void 0:d.displayName)||"Desconocido"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:()=>K(a.id),"aria-label":`Unirse a la partida ${a.id}`,onFocus:()=>r(`Unirse a la partida pÃºblica ${a.id}`),onMouseEnter:()=>r(`Unirse a la partida pÃºblica ${a.id}`),children:"Unirse"}),e.jsx(l,{onClick:()=>X(a.id),variant:"danger","aria-label":`Eliminar la partida ${a.id}`,onFocus:()=>r(`Eliminar la partida ${a.id}`),onMouseEnter:()=>r(`Eliminar la partida ${a.id}`),children:"Eliminar"})]})]})]})},a.id)})})}):null})]}),I&&e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"px-4 py-6 container",children:e.jsx("div",{className:"loading-spinner","aria-live":"polite","aria-busy":"true",children:"Cargandoâ€¦"})}),children:e.jsx(ue,{onQuestionsGenerated:a=>{W(a),C(!1)},onClose:()=>C(!1)})})]})}export{ye as default};
//# sourceMappingURL=DashboardPage-Cjvxuh-K.js.map
