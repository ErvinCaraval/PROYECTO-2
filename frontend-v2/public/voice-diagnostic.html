<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico de Voz - BrainBlitz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico Completo de Voz - BrainBlitz</h1>
    
    <div class="container">
        <h2>üìä Informaci√≥n del Sistema</h2>
        <div id="systemInfo" class="status">
            Cargando informaci√≥n del sistema...
        </div>
    </div>

    <div class="container">
        <h2>üé§ Pruebas de Voz</h2>
        <button onclick="runDiagnostic()" id="diagnosticBtn">üîç Ejecutar Diagn√≥stico</button>
        <button onclick="testBasicVoice()" id="testBtn">üîä Probar Voz B√°sica</button>
        <button onclick="testSpanishVoice()" id="spanishBtn">üá™üá∏ Probar Voz Espa√±ola</button>
        <button onclick="clearLog()" id="clearBtn">üóëÔ∏è Limpiar Log</button>
    </div>

    <div class="container">
        <h2>üìù Log de Diagn√≥stico</h2>
        <div id="logOutput" class="log">
            Esperando diagn√≥stico...
        </div>
    </div>

    <div class="container">
        <h2>üîß Soluci√≥n de Problemas</h2>
        <div class="status">
            <h3>Si no escuchas nada:</h3>
            <ul>
                <li>Verifica que el volumen del sistema est√© activado</li>
                <li>Aseg√∫rate de que no hay bloqueos de audio en el navegador</li>
                <li>Prueba con un navegador diferente (Chrome funciona mejor)</li>
                <li>Verifica que no hay extensiones bloqueando el audio</li>
                <li>Revisa la consola del navegador (F12) para errores</li>
            </ul>
            
            <h3>Si hay errores:</h3>
            <ul>
                <li>Actualiza tu navegador a la √∫ltima versi√≥n</li>
                <li>Reinicia el navegador</li>
                <li>Verifica que JavaScript est√© habilitado</li>
                <li>Prueba en modo inc√≥gnito</li>
            </ul>
        </div>
    </div>

    <script>
        let logMessages = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);
            
            const logOutput = document.getElementById('logOutput');
            logOutput.innerHTML = logMessages.join('\n');
            logOutput.scrollTop = logOutput.scrollHeight;
            
            console.log(message);
        }

        function clearLog() {
            logMessages = [];
            document.getElementById('logOutput').innerHTML = 'Log limpiado...';
        }

        function updateSystemInfo() {
            const isSupported = 'speechSynthesis' in window;
            const isSpeaking = speechSynthesis.speaking;
            const isPaused = speechSynthesis.paused;
            const voices = speechSynthesis.getVoices();
            const spanishVoices = voices.filter(v => v.lang.includes('es'));

            document.getElementById('systemInfo').innerHTML = `
                <strong>Soporte de Web Speech API:</strong> ${isSupported ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>Estado actual:</strong> ${isSpeaking ? 'üîä Hablando' : isPaused ? '‚è∏Ô∏è Pausado' : 'üîá Silencioso'}<br>
                <strong>Voces disponibles:</strong> ${voices.length}<br>
                <strong>Voces en espa√±ol:</strong> ${spanishVoices.length}<br>
                <strong>Navegador:</strong> ${navigator.userAgent.split(' ')[0]}<br>
                <strong>Plataforma:</strong> ${navigator.platform}<br>
                <strong>Idioma:</strong> ${navigator.language}
            `;
        }

        function runDiagnostic() {
            log('üîç Iniciando diagn√≥stico completo del sistema de voz...', 'info');
            
            // 1. Verificar soporte del navegador
            log('üìä 1. VERIFICACI√ìN DEL NAVEGADOR:', 'info');
            log(`User Agent: ${navigator.userAgent}`, 'info');
            log(`Plataforma: ${navigator.platform}`, 'info');
            log(`Idioma: ${navigator.language}`, 'info');

            // 2. Verificar APIs de voz
            log('üé§ 2. VERIFICACI√ìN DE APIs DE VOZ:', 'info');
            const speechSynthesisSupported = 'speechSynthesis' in window;
            const speechSynthesisUtteranceSupported = 'SpeechSynthesisUtterance' in window;
            
            log(`speechSynthesis disponible: ${speechSynthesisSupported ? '‚úÖ' : '‚ùå'}`, speechSynthesisSupported ? 'success' : 'error');
            log(`SpeechSynthesisUtterance disponible: ${speechSynthesisUtteranceSupported ? '‚úÖ' : '‚ùå'}`, speechSynthesisUtteranceSupported ? 'success' : 'error');

            if (speechSynthesisSupported) {
                log(`Estado actual: Hablando=${speechSynthesis.speaking}, Pausado=${speechSynthesis.paused}, Pendiente=${speechSynthesis.pending}`, 'info');
            }

            // 3. Verificar voces disponibles
            log('üó£Ô∏è 3. VERIFICACI√ìN DE VOCES:', 'info');
            if (speechSynthesisSupported) {
                const voices = speechSynthesis.getVoices();
                log(`Total de voces: ${voices.length}`, voices.length > 0 ? 'success' : 'warning');
                
                if (voices.length > 0) {
                    log('Voces disponibles:', 'info');
                    voices.forEach((voice, index) => {
                        const voiceInfo = `${index + 1}. ${voice.name} (${voice.lang}) ${voice.gender ? `[${voice.gender}]` : ''} ${voice.default ? '[Por defecto]' : ''}`;
                        log(voiceInfo, 'info');
                    });
                    
                    const spanishVoices = voices.filter(v => v.lang.includes('es'));
                    log(`Voces en espa√±ol: ${spanishVoices.length}`, spanishVoices.length > 0 ? 'success' : 'warning');
                    
                    if (spanishVoices.length > 0) {
                        log('Voces espa√±olas:', 'info');
                        spanishVoices.forEach(voice => {
                            log(`  - ${voice.name} (${voice.lang})`, 'info');
                        });
                    }
                } else {
                    log('‚ùå No hay voces disponibles', 'error');
                }
            } else {
                log('‚ùå speechSynthesis no est√° disponible', 'error');
            }

            // 4. Verificar permisos de audio
            log('üîä 4. VERIFICACI√ìN DE PERMISOS DE AUDIO:', 'info');
            const audioContextSupported = 'AudioContext' in window || 'webkitAudioContext' in window;
            const mediaDevicesSupported = 'mediaDevices' in navigator;
            const getUserMediaSupported = 'getUserMedia' in navigator.mediaDevices;
            
            log(`AudioContext disponible: ${audioContextSupported ? '‚úÖ' : '‚ùå'}`, audioContextSupported ? 'success' : 'error');
            log(`MediaDevices disponible: ${mediaDevicesSupported ? '‚úÖ' : '‚ùå'}`, mediaDevicesSupported ? 'success' : 'error');
            log(`getUserMedia disponible: ${getUserMediaSupported ? '‚úÖ' : '‚ùå'}`, getUserMediaSupported ? 'success' : 'error');

            updateSystemInfo();
            log('‚úÖ Diagn√≥stico completado', 'success');
        }

        function testBasicVoice() {
            log('üß™ Probando voz b√°sica...', 'info');
            
            if (!('speechSynthesis' in window)) {
                log('‚ùå No se puede probar: speechSynthesis no disponible', 'error');
                return;
            }
            
            const testText = "Prueba de diagn√≥stico de voz";
            log(`Probando con texto: "${testText}"`, 'info');
            
            const utterance = new SpeechSynthesisUtterance(testText);
            utterance.lang = 'es-ES';
            utterance.rate = 1.0;
            utterance.volume = 1.0;
            utterance.pitch = 1.0;
            
            utterance.onstart = function() {
                log('‚úÖ Voz iniciada correctamente', 'success');
            };
            
            utterance.onend = function() {
                log('‚úÖ Voz terminada correctamente', 'success');
            };
            
            utterance.onerror = function(event) {
                log(`‚ùå Error en la voz: ${event.error}`, 'error');
            };
            
            log('Iniciando s√≠ntesis de voz...', 'info');
            speechSynthesis.speak(utterance);
        }

        function testSpanishVoice() {
            log('üá™üá∏ Probando con voz espa√±ola...', 'info');
            
            const voices = speechSynthesis.getVoices();
            const spanishVoices = voices.filter(v => v.lang.includes('es'));
            
            if (spanishVoices.length === 0) {
                log('‚ùå No hay voces en espa√±ol disponibles', 'error');
                return;
            }
            
            const testText = "Prueba con voz en espa√±ol";
            log(`Probando con voz: ${spanishVoices[0].name}`, 'info');
            log(`Texto: "${testText}"`, 'info');
            
            const utterance = new SpeechSynthesisUtterance(testText);
            utterance.voice = spanishVoices[0];
            utterance.lang = 'es-ES';
            
            utterance.onstart = function() {
                log('‚úÖ Voz espa√±ola iniciada', 'success');
            };
            
            utterance.onend = function() {
                log('‚úÖ Voz espa√±ola terminada', 'success');
            };
            
            utterance.onerror = function(event) {
                log(`‚ùå Error con voz espa√±ola: ${event.error}`, 'error');
            };
            
            speechSynthesis.speak(utterance);
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            log('P√°gina de diagn√≥stico cargada', 'info');
            updateSystemInfo();
            
            // Cargar voces cuando est√©n disponibles
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = function() {
                    log('Voces actualizadas', 'info');
                    updateSystemInfo();
                };
            }
            
            // Actualizar informaci√≥n cada 2 segundos
            setInterval(updateSystemInfo, 2000);
        });
    </script>
</body>
</html>
